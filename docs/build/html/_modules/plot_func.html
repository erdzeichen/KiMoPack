

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>plot_func &mdash; KiMoPack 6.5.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> KiMoPack
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Main_tasks.html">Main Tasks overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Opening.html">Opening of data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Shaping.html">Shaping of Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Plotting.html">Plotting functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Fitting.html">Fitting, Parameter optimization and Error estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Comparing.html">Comparative plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Saving.html">Data Export and Project Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Function Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plot_func.html">KiMoPack - Functions</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">KiMoPack</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>plot_func</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for plot_func</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="n">version</span> <span class="o">=</span> <span class="s2">&quot;6.5.3&quot;</span>
<span class="n">Copyright</span> <span class="o">=</span> <span class="s1">&#39;@Jens Uhlig&#39;</span>
<span class="k">if</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#Hide imports	</span>
	<span class="kn">import</span> <span class="nn">os</span>
	<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">walk</span>
	<span class="kn">import</span> <span class="nn">sys</span>
	<span class="kn">import</span> <span class="nn">pandas</span>
	<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
	<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">power</span><span class="p">,</span> <span class="n">log10</span><span class="p">,</span> <span class="n">shape</span>
	<span class="kn">import</span> <span class="nn">numbers</span>
	<span class="kn">import</span> <span class="nn">matplotlib</span>
	<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
	<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
	<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
	<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
	<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
	<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FuncFormatter</span>
	<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">BoundaryNorm</span>
	<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
	<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>
	<span class="kn">from</span> <span class="nn">matplotlib.offsetbox</span> <span class="kn">import</span> <span class="n">AnchoredText</span>	
	<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">AutoMinorLocator</span>
	<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
	<span class="kn">import</span> <span class="nn">re</span>
	<span class="kn">import</span> <span class="nn">scipy</span>
	<span class="kn">import</span> <span class="nn">scipy.constants</span>
	<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">inp</span>
	<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">savgol_filter</span>
	<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">decimate</span>
	<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erf</span>
	<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
	<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">binned_statistic</span>
	<span class="kn">import</span> <span class="nn">scipy.stats</span>	
	<span class="kn">import</span> <span class="nn">pathlib</span>
	<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
	<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">filedialog</span>
	<span class="kn">import</span> <span class="nn">tkinter</span>
	<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">tm</span> <span class="c1">#sorry i use time in my code</span>
	<span class="kn">import</span> <span class="nn">lmfit</span>
	<span class="kn">import</span> <span class="nn">h5py</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="kn">import</span> <span class="nn">PyQt5</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="kn">import</span> <span class="nn">PyQt4</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="kn">import</span> <span class="nn">qt</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Qt was not found&#39;</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>	
		<span class="kn">from</span> <span class="nn">pptx</span> <span class="kn">import</span> <span class="n">Presentation</span>
		<span class="kn">from</span> <span class="nn">pptx.util</span> <span class="kn">import</span> <span class="n">Inches</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We need python-pptx to create a powerpoint file. Not essential. Either use pip or for anaconda: conda install -c conda-forge python-pptx&#39;</span><span class="p">)</span>
	
	<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
	<span class="n">pandas</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">chained_assignment</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># I use this a lot and think I can ignore it</span>
	<span class="n">FWHM</span> <span class="o">=</span> <span class="mf">2.35482</span>
	<span class="n">shading</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>  <span class="c1"># gouraud</span>
	<span class="n">standard_map</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot_func version </span><span class="si">%s</span><span class="se">\n</span><span class="s1">was imported from path:</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">version</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The current working folder is:</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<div class="viewcode-block" id="changefonts"><a class="viewcode-back" href="../plot_func.html#plot_func.changefonts">[docs]</a><span class="k">def</span> <span class="nf">changefonts</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="n">SMALL_SIZE</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">MEDIUM_SIZE</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">LARGE_SIZE</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Small function that sets the matplotlib font sizes and fonts, written as conveniens to not need to remember all the </span>
<span class="sd">	codes and what is names what. Calling the function will change the matplotlib *rc* settings</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	------------</span>
<span class="sd">	</span>
<span class="sd">	weight : str, optional</span>
<span class="sd">		&#39;bold&#39; or  &#39;normal&#39;</span>
<span class="sd">	</span>
<span class="sd">	font : str, optional</span>
<span class="sd">		this is a meta switch that changes the family. known are:</span>
<span class="sd">		&#39;standard&#39;=&#39;DejaVu Sans&#39;\n</span>
<span class="sd">		&#39;arial&#39;=&#39;Arial&#39;\n</span>
<span class="sd">		&#39;helvetica&#39;= &#39;Helvetica&#39;\n</span>
<span class="sd">		&#39;garamond&#39;=&#39;Garamond&#39;\n</span>
<span class="sd">		&#39;verdana&#39;=&#39;Verdana&#39;\n</span>
<span class="sd">		&#39;bookman&#39;=&#39;Bookman&#39;\n</span>
<span class="sd">		&#39;times&#39;=&#39;Times New Roman&#39;</span>

<span class="sd">	SMALL_SIZE : int, optional</span>
<span class="sd">		(DEFAULT = 11)\n </span>
<span class="sd">		all written text, legend title and face size</span>

<span class="sd">	MEDIUM_SIZE : int, optional</span>
<span class="sd">		(DEFAULT = 13)\n </span>
<span class="sd">		tick size and tick numbers</span>

<span class="sd">	LARGE_SIZE : int, optional</span>
<span class="sd">		(DEFAULT = 18)\n </span>
<span class="sd">		axis titles, figure titles, axis labels</span>

<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="n">font_dict</span> <span class="o">=</span> <span class="p">{</span>
				<span class="s1">&#39;standard&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;DejaVu Sans&#39;</span><span class="p">},</span>
				<span class="s1">&#39;arial&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Arial&#39;</span><span class="p">},</span>
				<span class="s1">&#39;helvetica&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">},</span>
				<span class="s1">&#39;garamond&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Garamond&#39;</span><span class="p">},</span>
				<span class="s1">&#39;verdana&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Verdana&#39;</span><span class="p">},</span>
				<span class="s1">&#39;bookman&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Bookman&#39;</span><span class="p">},</span>
				<span class="s1">&#39;times&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">SMALL_SIZE</span><span class="p">,</span> <span class="s1">&#39;family&#39;</span><span class="p">:</span> <span class="s1">&#39;Times New Roman&#39;</span><span class="p">},</span>
	<span class="p">}</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font_dict</span><span class="p">[</span><span class="n">font</span><span class="p">])</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">LARGE_SIZE</span><span class="p">,</span> <span class="n">labelweight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>  <span class="c1"># fontsize of the axes title</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">LARGE_SIZE</span><span class="p">,</span> <span class="n">labelweight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>  <span class="c1"># fontsize of the x and y labels</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>	 <span class="c1"># linewidth of all axes</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">MEDIUM_SIZE</span><span class="p">)</span>	<span class="c1"># fontsize of the tick labels</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">MEDIUM_SIZE</span><span class="p">)</span>	<span class="c1"># fontsize of the tick labels</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>  <span class="c1"># legend fontsize</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">LARGE_SIZE</span><span class="p">)</span>	<span class="c1"># fontsize of the figure title</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>  <span class="c1"># fontsize of the figure title</span></div>
<span class="n">changefonts</span><span class="p">()</span> <span class="c1">#we need to apply the font settings</span>


<span class="k">def</span> <span class="nf">clean_double_string</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Stupid function that reads and changes!!! the file. It searchers for double lines and double dots and replaces them with single&#39;&#39;&#39;</span>
	<span class="kn">import</span> <span class="nn">re</span>
	<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
	<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="p">])),</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
		<span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
		<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
		<span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
		<span class="n">f</span><span class="o">.</span><span class="n">truncate</span><span class="p">()</span>
		
<span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">mainlist</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">entry</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">mainlist</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">nearest_neighbor_method3</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;returns nearest neighbour value to q&#39;&#39;&#39;</span> 
	<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">T</span>
	<span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">X</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">log_and</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Returns the logical and of all 2+ arguments.&quot;&quot;&quot;</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">result</span>
	
	
<div class="viewcode-block" id="s2_vs_smin2"><a class="viewcode-back" href="../plot_func.html#plot_func.s2_vs_smin2">[docs]</a><span class="k">def</span> <span class="nf">s2_vs_smin2</span><span class="p">(</span><span class="n">Spectral_points</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span> <span class="n">Time_points</span> <span class="o">=</span> <span class="mi">130</span><span class="p">,</span> <span class="n">number_of_species</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">fitted_kinetic_pars</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">target_quality</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;dfn is numerator and number of fitted parameters, dfd is denominator and number of degrees of freedom,</span>
<span class="sd">	F-test is deciding if a set of parameters gives a statistical significant difference. T-test is if a single parameter gives	 statistical difference. </span>
<span class="sd">	Null hypothesis, all parameter are zero, if significant, the coefficients improve the fit</span>
<span class="sd">	the f-statistics compares the number of </span>
<span class="sd">	&quot;fitted parameter&quot;=number of species*number of spectral points + number of kinetic parameter</span>
<span class="sd">	&quot;free points&quot;=number of species*number of spectral points*number of time points - fitted parameter</span>
<span class="sd">	within the target quality, meaning, what fraction do my variances need to have, so that I&#39;m 100% * target_quality sure that they are different from zero&#39;&#39;&#39;</span>
	<span class="n">data_points</span> <span class="o">=</span> <span class="n">Spectral_points</span><span class="o">*</span><span class="n">Time_points</span>
	<span class="n">fitted_parameter</span> <span class="o">=</span> <span class="n">Spectral_points</span><span class="o">*</span><span class="n">number_of_species</span><span class="o">+</span><span class="n">fitted_kinetic_pars</span>
	<span class="n">Free_points</span> <span class="o">=</span> <span class="n">data_points</span><span class="o">-</span><span class="n">fitted_parameter</span>
	<span class="n">f_stat</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="n">target_quality</span><span class="p">,</span> <span class="n">dfn</span> <span class="o">=</span> <span class="n">fitted_parameter</span><span class="p">,</span> <span class="n">dfd</span> <span class="o">=</span> <span class="n">Free_points</span><span class="p">)</span>
	<span class="c1">#print(&#39;fitted points:%g\n Free points:%g\n f-stats: %g&#39;%(fitted_parameter,Free_points,f_stat))</span>
	<span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">fitted_parameter</span><span class="o">*</span><span class="n">f_stat</span><span class="o">/</span><span class="n">Free_points</span><span class="p">)</span>	  </div>


<div class="viewcode-block" id="GUI_open"><a class="viewcode-back" href="../plot_func.html#plot_func.GUI_open">[docs]</a><span class="k">def</span> <span class="nf">GUI_open</span><span class="p">(</span><span class="n">project_list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename_part</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fileending</span> <span class="o">=</span> <span class="s1">&#39;hdf5&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> 
			<span class="n">index_is_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_indexes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">divide_times_by</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
			<span class="n">shift_times_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;	This Function </span>
<span class="sd">		1. opens a gui and allows the selection of multiple saved projects, which are returned as a list</span>
<span class="sd">		2. if given a list of project names opens them</span>
<span class="sd">		3. if given the word &#39;all&#39;, opens all files in a given folder </span>
<span class="sd">		The general behavior is selected by the first parameter (project_list)</span>
<span class="sd">		</span>
<span class="sd">		it is designed to open combined files that contain both the wavelength and the time. (e.g. SIA files as recorded by Pascher instruments software) or hdf5 projects saved by this software</span>
<span class="sd">		There are however a lot of additional options to open other ascii type files and adapt their format internally</span>
<span class="sd">		Important, as default the parameter &quot;fileending&quot; selects hdf5 files only, which are used as project files (see :meth:`plot_func.TA.Save_project`) </span>
<span class="sd">		for opening of other files the fileending parameter needs to be changed. </span>

<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		project_list : list (of str) or &#39;all&#39;, optional</span>
<span class="sd">			Give a list of filenames that will be opened and returned as a list of objects</span>
<span class="sd">			if the project list is &#39;all&#39; then all files in the folder specified in path. The parameter &quot;filename_part&quot; </span>
<span class="sd">			and &quot;fileending&quot; can be used to specify this selection </span>
<span class="sd">		path : str or path object (optional)</span>
<span class="sd">			if path is a string without the operation system dependent separator, it is treated as a relative path, </span>
<span class="sd">			e.g. data will look from the working directory in the sub director data. Otherwise this has to be a </span>
<span class="sd">			full path in either strong or path object form.</span>
<span class="sd">		filename_part : str, optional</span>
<span class="sd">			This parameter is only used for the option &#39;all&#39;, the (Default) None means do nothing. if a string is given then only  </span>
<span class="sd">			files that start with this string will be read. </span>
<span class="sd">		fileending : str, optional</span>
<span class="sd">			this string is used to select the filetype that is suppose to open. For the GUI, only these files will be shown,</span>
<span class="sd">			with the option &#39;all&#39; this selects the files that will be read in the folder, &#39;hdf5&#39; (Default) </span>
<span class="sd">		sep : str (optional)</span>
<span class="sd">			is the separator between different numbers, typical are tap &#39;\t&#39; (Default) ,one or </span>
<span class="sd">			multiple white spaces &#39;\s+&#39; or comma &#39;,&#39;.</span>
<span class="sd">		decimal : str (optional) </span>
<span class="sd">			sets the ascii symbol that is used for the decimal sign. In most countries this is &#39;.&#39;(Default) </span>
<span class="sd">			but it can be &#39;,&#39; in countries like Sweden or Germany</span>
<span class="sd">		index_is_energy : bool (optional)</span>
<span class="sd">			switches if the wavelength is given in nm (Default) or in eV (if True), currently everything </span>
<span class="sd">			is handled as wavelength in nm internally</span>
<span class="sd">		transpose : bool (optional)</span>
<span class="sd">			if this switch is False (Default) the wavelength are the columns and the rows the times.</span>
<span class="sd">		data_type: str (optional)</span>
<span class="sd">			data_type is the string that represents the intensity measurements. Usually this contains if absolute </span>
<span class="sd">			of differential data. This is used for the color intensity in the 2d plots and the y-axis for the 1d plots</span>
<span class="sd">			</span>
<span class="sd">		units: str (optional)</span>
<span class="sd">			this is used to identify the units on the energy axis and to label the slices, recognized is &#39;nm&#39;, &#39;eV&#39; and &#39;keV&#39; </span>
<span class="sd">			but if another unit like &#39;cm^-1&#39; is used it will state energy in &#39;cm^-1&#39;. Pleas observe that if you use the index_is_energy</span>
<span class="sd">			switch the program tries to convert this energy into wavelength. </span>
<span class="sd">		sort_indexes : bool (optional)</span>
<span class="sd">			For False (Default) I assume that the times and energies are already in a rising order. </span>
<span class="sd">			with this switch, both are sorted again. </span>
<span class="sd">		divide_times_by : bool or float (optional) </span>
<span class="sd">			here a number can be given that scales the time by an arbitary factor. This is actually dividing</span>
<span class="sd">			the times by this value. Alternatively there is the variable self.baseunit. The latter only affects </span>
<span class="sd">			what is written on the axis, while this value is actually used to scale the times. False (Default) </span>
<span class="sd">			ignores this</span>
<span class="sd">		shift_times_by : None, float (optional)</span>
<span class="sd">			This a value by which the time axis is shifted during import. This is a useful option of e.g. </span>
<span class="sd">			the recording software does not compensate for t0 and the data is always shifted. </span>
<span class="sd">			None (Default) ignores this setting</span>
<span class="sd">		external_time : None or str (optional)</span>
<span class="sd">			Here a filename extension (string) can be given that contains the time vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single </span>
<span class="sd">			type of separated data without header. It also assumes that this is the ending </span>
<span class="sd">			for the file. The filename itself is taken from the filename. </span>
<span class="sd">			e.g. if samp1.txt is the filename and external\_time=&#39;.tid&#39; the program searches </span>
<span class="sd">			samp1.tid for the times. The transpose setting is applied and sets where the times are </span>
<span class="sd">			to be inserted (row or column indexes)</span>
<span class="sd">		external_wave: None or str (optional) </span>
<span class="sd">			Here a filename extension (string) can be given that contains the wavelength vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single type </span>
<span class="sd">			of separated data without header. This is the ending for the file. The filename itself </span>
<span class="sd">			is taken from the filename. e.g. if samp1.txt is the filename and external\_wave=&#39;.wav&#39; </span>
<span class="sd">			then the program searches samp1.wav for the wavelength. The transpose setting is applied </span>
<span class="sd">			and sets where the wavelength are to be inserted (columns or row indexes)</span>
<span class="sd">		</span>
<span class="sd">		Returns</span>
<span class="sd">		--------------</span>
<span class="sd">		</span>
<span class="sd">		List of opened TA objects</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf</span>
<span class="sd">		&gt;&gt;&gt; project_list=pf.GUI_open() #start the GUI to open project Files</span>
<span class="sd">		&gt;&gt;&gt; project_list=pf.GUI_open(fileending=&#39;SIA&#39;) #start the GUI to open SIA Files</span>
<span class="sd">		</span>
<span class="sd">		Opening a list of files using the file names </span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; project_list=pf.GUI_open(project_list = [&#39;file1.SIA&#39;, &#39;file2.SIA&#39;])</span>
<span class="sd">		</span>
<span class="sd">		Opening all files in the folder &quot;all_data&quot; (relative to where the notebook is with the ending &quot;hdf5&quot; </span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; project_list=pf.GUI_open(&#39;all&#39;,path=&quot;all_data&quot;)</span>
<span class="sd">		</span>
<span class="sd">		Opening a list of files with external time vector (of the same name) so it looks for a data</span>
<span class="sd">		file &quot;file1.txt&quot; and a file with the time information &quot;file1.tid&quot;</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; project_list=pf.GUI_open(project_list = [&#39;file1.txt&#39;, &#39;file2.txt&#39;], external_time = &#39;tid&#39;)</span>
<span class="sd">		&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">project_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">root_window</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
		<span class="n">root_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
		<span class="n">root_window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">root_window</span><span class="o">.</span><span class="n">focus_force</span><span class="p">())</span>
		<span class="n">path_list</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">filetypes</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;TA project files&#39;</span><span class="p">,</span><span class="s1">&#39;*.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">fileending</span><span class="p">)])</span>									 
		<span class="k">if</span> <span class="n">project_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">project_list</span><span class="o">=</span><span class="p">[]</span>
	<span class="k">elif</span> <span class="n">project_list</span><span class="o">==</span><span class="s1">&#39;all&#39;</span><span class="p">:</span>
		<span class="n">scan_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">filename_part</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#we specified a specific name and want only the files with this name in it</span>
			<span class="n">path_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scan_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scan_path</span><span class="p">)</span> <span class="k">if</span>
									<span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">fileending</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename_part</span> <span class="ow">in</span> <span class="n">name</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span><span class="c1">#we have not specified a specific name and want all files in the folder</span>
			<span class="n">path_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">currentFile</span> <span class="k">for</span> <span class="n">currentFile</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">fileending</span><span class="p">)])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">project_list</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>	
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The use_gui switch is ment to bypass the gui, but you still need at least some files as a list&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">project_list</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span><span class="n">project_list</span><span class="o">=</span><span class="p">[</span><span class="n">project_list</span><span class="p">]</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">project_list</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">project_list</span><span class="o">=</span><span class="p">[</span><span class="n">project_list</span><span class="p">]</span>
			<span class="n">path_list</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">project_list</span><span class="p">:</span>
				<span class="n">ta</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">current_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
				<span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>
	<span class="n">return_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">entrance</span> <span class="ow">in</span> <span class="n">path_list</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">listen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">entrance</span><span class="p">)</span>
			<span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">filename</span><span class="o">=</span><span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">ta</span> <span class="o">=</span> <span class="n">TA</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span><span class="p">,</span> 
					<span class="n">index_is_energy</span> <span class="o">=</span> <span class="n">index_is_energy</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">sort_indexes</span> <span class="o">=</span> <span class="n">sort_indexes</span><span class="p">,</span> 
					<span class="n">divide_times_by</span> <span class="o">=</span> <span class="n">divide_times_by</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="n">shift_times_by</span><span class="p">,</span> <span class="n">external_time</span> <span class="o">=</span> <span class="n">external_time</span><span class="p">,</span> 
					<span class="n">external_wave</span> <span class="o">=</span> <span class="n">external_wave</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
																
			<span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Problem with entrance:</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">entrance</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">return_list</span></div>


<span class="k">def</span> <span class="nf">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Helper function using robust path determination.\n </span>
<span class="sd">	In any case if a valif file name is given it is attached to the total path\n</span>
<span class="sd">	The path can be string or windows/linux path or pure path or byte type paths.\n</span>
<span class="sd">	paths that do not exists (including parents) are created\n</span>
<span class="sd">	1. if path is given absolute, it is returned\n_colors</span>
<span class="sd">	2. if path is a string (relative) the current_path + path is returned.\n</span>
<span class="sd">	3. if current_path is not absolute or None, the current working directory is assumed as path.\n</span>
<span class="sd">	4. IF all is None, the current working directory is returned</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	path : str, purePath, absolute or relative, optional</span>
<span class="sd">		the final part of the path used</span>
<span class="sd">	</span>
<span class="sd">	current_path : None, str, purePath, absolute, optional</span>
<span class="sd">		path that sits before the &quot;path variable, is filled with current working directory if left None</span>
<span class="sd">	</span>
<span class="sd">	filename: None, str, optional</span>
<span class="sd">		attached after path and returned if not None</span>
<span class="sd">		</span>
<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="nb">bytes</span><span class="p">):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">path</span>
	<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_path</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
		<span class="n">current_path</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">current_path</span>
	<span class="k">if</span> <span class="n">current_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">current_path</span><span class="o">=</span><span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">current_path</span><span class="p">)</span>
		
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
		<span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filename</span>
	<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">filename</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">current_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
		<span class="k">elif</span> <span class="n">current_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
			<span class="n">directory</span><span class="o">=</span><span class="n">current_path</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;attention, current_path was given but not absolute, replaced by cwd&#39;</span><span class="p">)</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
	<span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
		<span class="n">directory</span> <span class="o">=</span> <span class="n">path</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">current_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">current_path</span><span class="o">.</span><span class="n">is_absolute</span><span class="p">():</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="n">current_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;attention, current_path was given but not absolute, replaced by cwd&#39;</span><span class="p">)</span>
			<span class="n">directory</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="n">directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span> <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">directory</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">directory</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>



<span class="k">def</span> <span class="nf">rebin</span><span class="p">(</span><span class="n">ori_df</span><span class="p">,</span><span class="n">new_x</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;interpolation of values to new index&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ori_df</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
		<span class="n">dum</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;dummy&#39;</span><span class="p">:</span><span class="n">new_x</span><span class="p">}</span>
		<span class="n">new_df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dum</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">new_x</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ori_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
			<span class="n">new_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span><span class="n">ori_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">ori_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
		<span class="n">new_df</span><span class="o">=</span><span class="n">new_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;dummy&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">new_df</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ori_df</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
		<span class="n">new_df</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span><span class="n">ori_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">ori_df</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">new_df</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">new_x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">savitzky_golay</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Ported from a previous function&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="n">deriv</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">rate</span><span class="p">)</span>


<div class="viewcode-block" id="Frame_golay"><a class="viewcode-back" href="../plot_func.html#plot_func.Frame_golay">[docs]</a><span class="k">def</span> <span class="nf">Frame_golay</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Convenience method that returns the Golay smoothed data for each column (DataFrame) or the series</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	df : pandas.DataFrame,pandas.Series</span>
<span class="sd">		the DataFrame that has to be interpolated</span>
<span class="sd">	</span>
<span class="sd">	window_size : int,optional</span>
<span class="sd">		5(Default) an integer that indicates how many units are to be interpolated</span>
<span class="sd">		</span>
<span class="sd">	order : int, optional</span>
<span class="sd">		2 (Default) an integer that indicates what orderpolynoninal is to be used to interpolate the points. </span>
<span class="sd">		order=1 effectively turns this into a floating average</span>
<span class="sd">		</span>
<span class="sd">	transpose : bool,optional </span>
<span class="sd">		in which orientation is the interpolation to be done. Default is in within the column (usually timepoints)</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	---------</span>
<span class="sd">	</span>
<span class="sd">	pandas.DataFrame or pandas.Series</span>
<span class="sd">		DataFrame or Series with the interpolation applied</span>
<span class="sd">	</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
		<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">T</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
			<span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">savitzky_golay</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
			<span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">T</span>
		<span class="k">return</span> <span class="n">df</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">savitzky_golay</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;must be series or DataFrame&#39;</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">find_nearest</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">con_str</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;returns the value in the array closest to value&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">con_str</span><span class="o">=</span><span class="kc">False</span><span class="p">)]</span>	


<span class="k">def</span> <span class="nf">find_nearest_index</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">con_str</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;returns the index in the array closest to value (the first one&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">con_str</span><span class="p">:</span>
		<span class="n">temp_array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">temp_array</span><span class="o">-</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="o">-</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">idx</span>


<span class="k">def</span> <span class="nf">rise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">begin</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;	 my own implementation of the instrument response function. </span>
<span class="sd">		 Based upon an error function from 0 to 1. </span>
<span class="sd">		 Sigma is the width (after which it has 50%) </span>
<span class="sd">		 and begin is 10% of height&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">sigma</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Gauss function&#39;&#39;&#39;</span>
	<span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">t</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">y</span><span class="o">/=</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">y</span>


<div class="viewcode-block" id="norm"><a class="viewcode-back" href="../plot_func.html#plot_func.norm">[docs]</a><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Min max norming of a dataframe&#39;&#39;&#39;</span>
	<span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span></div>


<span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">shift</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Shifts a dataframe along the columns, interpolate and then resample&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">name</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">nam</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
		<span class="n">ori_dat</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">nam</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
		<span class="n">ori_en</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">dtype</span> <span class="o">=</span> <span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">ori_en</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">ori_en</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="c1">#oh we have inverse order</span>
			<span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ori_en</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">ori_en</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span><span class="n">ori_dat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ori_en</span><span class="p">,</span><span class="n">ori_en</span><span class="o">+</span><span class="n">shift</span><span class="p">,</span><span class="n">ori_dat</span><span class="p">)</span>
		<span class="n">df</span><span class="p">[</span><span class="n">nam</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span>
	<span class="k">return</span> <span class="n">df</span>
	

<span class="k">def</span> <span class="nf">colm</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">standard_map</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;If a colour map is given, this is used.&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)):</span>
		<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span><span class="c1">#we got a color offset</span>
				<span class="n">mini</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">mini</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[</span> <span class="n">cmap</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mini</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">]</span>
			<span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">return</span> <span class="n">out</span>
		<span class="k">else</span><span class="p">:</span><span class="c1"># get me 13 colors</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
			<span class="k">return</span> <span class="n">ret</span>
	<span class="k">else</span><span class="p">:</span>  <span class="c1">#we assume it is a iterable thingy</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">ent</span><span class="p">,:]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ent</span><span class="p">),:]</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
			<span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ent</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">k</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;didn</span><span class="se">\&#39;</span><span class="s1">t find the right &#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">out</span>


<div class="viewcode-block" id="Summarize_scans"><a class="viewcode-back" href="../plot_func.html#plot_func.Summarize_scans">[docs]</a><span class="k">def</span> <span class="nf">Summarize_scans</span><span class="p">(</span><span class="n">list_of_scans</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path_to_scans</span> <span class="o">=</span> <span class="s1">&#39;Scans&#39;</span><span class="p">,</span> <span class="n">list_to_dump</span> <span class="o">=</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span> <span class="n">window1</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">window2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
					<span class="n">save_name</span> <span class="o">=</span> <span class="s1">&#39;combined.SIA&#39;</span><span class="p">,</span> <span class="n">fileending</span> <span class="o">=</span> <span class="s1">&#39;SIA&#39;</span><span class="p">,</span> <span class="n">filename_part</span> <span class="o">=</span> <span class="s1">&#39;Scan&#39;</span><span class="p">,</span> <span class="n">return_removed_list</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
					<span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">index_is_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">sort_indexes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
					<span class="n">divide_times_by</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
					<span class="n">return_ds_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Average single scans. Uses single scans of the data set and plots them as average after different conditions. Usually one defines one or two windows in which the intensity is integrated. This integrated number is then displayed for each scan in the list. There are different tools to select certain scans that are excluded from the summary. These are defined in the list_to_dump. This list can take either be a list with the number, or a string with the words &#39;single&#39; or &#39;range&#39; (see below) </span>
<span class="sd">	</span>

<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	list_of_scans : None, &#39;gui&#39; or list</span>
<span class="sd">		&#39;gui&#39; (choose scans via gui)\n</span>
<span class="sd">		None (Default) load scan files from the specified folder (path_to_scans) with the specified file-ending</span>
<span class="sd">		(file_ending), if filename_part is a string than only files with this string in the name are taken\n</span>
<span class="sd">		list of names (strings) loads this list of files</span>
<span class="sd">		list of integers (that will be directly attached to the filename_part) to form the file name</span>
<span class="sd">	</span>
<span class="sd">	path_to_scans : None, str or path object, optional</span>
<span class="sd">		specify relative or absolute path to the scan-files (Default:&#39;Scans&#39;)</span>
<span class="sd">	</span>
<span class="sd">	file_ending : str, optional</span>
<span class="sd">		specify the file extension of the single scan files. The Gui will only show this fileending</span>
<span class="sd">		(Default: &#39;.SIA&#39;)</span>

<span class="sd">	filename_part : str</span>
<span class="sd">		specify a part of the string included in all scan-files (Default: &#39;Scan&#39;)</span>
<span class="sd">		</span>
<span class="sd">	window1: None or list of 4 floats, optional</span>
<span class="sd">		window in time and wavelength over which each scan is averaged.\n </span>
<span class="sd">		window must have the shape [start time, end time, start wavelength, end wavelength]</span>
<span class="sd">		(Default: None)</span>
<span class="sd">	</span>
<span class="sd">	window2: list of 4 floats, optional</span>
<span class="sd">		window in time and wavelength over which each scan is averaged.\n </span>
<span class="sd">		window must have the shape [start time, end time, start wavelength, end wavelength]</span>
<span class="sd">		(Default: None) IF not given then only one window will be displayed</span>
<span class="sd">		</span>
<span class="sd">	list_to_dump : list, &#39;single&#39; or &#39;range&#39;, optional</span>
<span class="sd">		takes a list of scans to be excluded from the average, this list can be indexes (order) </span>
<span class="sd">		in which the scans come, or a list of names. if this is given as a list the option &quot;range&quot; </span>
<span class="sd">		is offered, which allows to add additional selection to the cut.\n </span>
<span class="sd">		**&#39;single&#39;** allows you (in a GUI) to click on single points in plotted window1 or two that </span>
<span class="sd">		is to be removed, useful for spike removal and makes only sense in conjunction with at least </span>
<span class="sd">		a defined window1, if none is defined window1 = [0.5,10,300,1200] will be set automatically. </span>
<span class="sd">		A right click removes the last selection a middle click applies it. An empty middle click </span>
<span class="sd">		(without selecting anything) finishes the gui\n</span>
<span class="sd">		**&#39;range&#39;** allows you (in a GUI) to click and define regions.\n</span>
<span class="sd">		first left click is the left side of the window, second left click the ride side of the window. </span>
<span class="sd">		Third left click the left side of the second window,... A right click removes the last set point.</span>
<span class="sd">		a middle click finishes and applies the selection\n </span>
<span class="sd">		An **empty middle click** (without selecting anything) finishes the gui\n</span>
<span class="sd">		useful for spike removal and definition of exclusion region (e.g. where the sample died) </span>
<span class="sd">		This makes only sense in conjunction with at least a defined window1 , </span>
<span class="sd">		if none is defined window1 = [0.5,10,300,1200] will be set automatically</span>

<span class="sd">	data_type: str (optional)</span>
<span class="sd">		data_type is the string that represents the intensity measurements. Usually this contains if absolute </span>
<span class="sd">		of differential data. This is used for the color intensity in the 2d plots and the y-axis for the 1d plots</span>
<span class="sd">		</span>
<span class="sd">	units: str (optional)</span>
<span class="sd">		this is used to identify the units on the energy axis and to label the slices, recognized is &#39;nm&#39;, &#39;eV&#39; and &#39;keV&#39; </span>
<span class="sd">		but if another unit like &#39;cm^-1&#39; is used it will state energy in &#39;cm^-1&#39;. Pleas observe that if you use the index_is_energy</span>
<span class="sd">		switch the program tries to convert this energy into wavelength. </span>

<span class="sd">	save_name : str, optional</span>
<span class="sd">		specify name for saving the combined scans (Default) &#39;combined.SIA&#39;)</span>
<span class="sd">	</span>
<span class="sd">	return_removed_list : bool, optional</span>
<span class="sd">		(Default) False, returns the list of removed scans instead of the averaged data set. (this list could then be given as &quot;list_to_dump&quot; to get the averaged datafile too. If a file name is given for saved file (which is Default) then the file is saved anyways.</span>
<span class="sd">	</span>
<span class="sd">	sep : str (optional)</span>
<span class="sd">		is the separator between different numbers, typical are tap (Backslash t) (Default) ,one or </span>
<span class="sd">		multiple white spaces &#39;backslash s+&#39; or comma &#39;,&#39;.</span>
<span class="sd">	</span>
<span class="sd">	decimal : str (optional) </span>
<span class="sd">		sets the ascii symbol that is used for the decimal sign. In most countries this is &#39;.&#39;(Default) </span>
<span class="sd">		but it can be &#39;,&#39; in countries like Sweden or Germany</span>
<span class="sd">	</span>
<span class="sd">	index_is_energy : bool (optional)</span>
<span class="sd">		switches if the wavelength is given in nm (Default) or in eV (if True), currently everything </span>
<span class="sd">		is handled as wavelength in nm internally</span>
<span class="sd">	</span>
<span class="sd">	transpose : bool (optional)</span>
<span class="sd">		if this switch is False (Default) the wavelength are the columns and the rows the times.</span>
<span class="sd">	</span>
<span class="sd">	sort_indexes : bool (optional)</span>
<span class="sd">		For False (Default) I assume that the times and energies are already in a rising order. </span>
<span class="sd">		with this switch, both are sorted again. </span>
<span class="sd">	</span>
<span class="sd">	divide_times_by : bool or float (optional) </span>
<span class="sd">		here a number can be given that scales the time by an arbitary factor. This is actually dividing</span>
<span class="sd">		the times by this value. Alternatively there is the variable self.baseunit. The latter only affects </span>
<span class="sd">		what is written on the axis, while this value is actually used to scale the times. False (Default) </span>
<span class="sd">		ignores this</span>
<span class="sd">	</span>
<span class="sd">	shift_times_by : None, float (optional)</span>
<span class="sd">		This a value by which the time axis is shifted during import. This is a useful option of e.g. </span>
<span class="sd">		the recording software does not compensate for t0 and the data is always shifted. </span>
<span class="sd">		None (Default) ignores this setting</span>
<span class="sd">	</span>
<span class="sd">	external_time : None or str (optional)</span>
<span class="sd">		Here a filename extension (string) can be given that contains the time vector. </span>
<span class="sd">		The file is assumed to be at the same path as the data and to contain a single </span>
<span class="sd">		type of separated data without header. It also assumes that this is the ending </span>
<span class="sd">		for the file. The filename itself is taken from the filename. </span>
<span class="sd">		e.g. if samp1.txt is the filename and external_time=&#39;.tid&#39; the program searches </span>
<span class="sd">		samp1.tid for the times. The transpose setting is applied and sets where the times are </span>
<span class="sd">		to be inserted (row or column indexes)</span>
<span class="sd">	</span>
<span class="sd">	external_wave: None or str (optional) </span>
<span class="sd">		Here a filename extension (string) can be given that contains the wavelength vector. </span>
<span class="sd">		The file is assumed to be at the same path as the data and to contain a single type </span>
<span class="sd">		of separated data without header. This is the ending for the file. The filename itself </span>
<span class="sd">		is taken from the filename. e.g. if samp1.txt is the filename and external_wave=&#39;.wav&#39; </span>
<span class="sd">		then the program searches samp1.wav for the wavelength. The transpose setting is applied </span>
<span class="sd">		and sets where the wavelength are to be inserted (columns or row indexes)</span>
<span class="sd">	</span>
<span class="sd">	return_ds_only: boolean,(optional)</span>
<span class="sd">		if False (Dafault) returns a TA object, otherwise just a DataFrame</span>
<span class="sd">	</span>
<span class="sd">	Returns</span>
<span class="sd">	---------</span>
<span class="sd">	</span>
<span class="sd">	TA object if return_ds_only is False(Default) averaged dataset (ds) of the selected scans or</span>
<span class="sd">	(if return_removed_list = True) the list of removed scans. </span>
<span class="sd">	</span>
<span class="sd">	Examples</span>
<span class="sd">	----------</span>
<span class="sd">	</span>
<span class="sd">	Use use a range to select the rejected scans, look on the scans by integrating the window 0.5ps to 1ps and 450nm to 470nm</span>
<span class="sd">	</span>
<span class="sd">	&gt;&gt;&gt; import plot_func as pf #import the module</span>
<span class="sd">	&gt;&gt;&gt; window1=[0.5,1,450,470] #define the window</span>
<span class="sd">	&gt;&gt;&gt; #use a &#39;GUI&#39; to select the files</span>
<span class="sd">	&gt;&gt;&gt; pf.Summarize_scans(list_of_scans=&#39;gui&#39;,window1=window1) </span>
<span class="sd">	&gt;&gt;&gt; #use all scans in the subfolder scans that have the word &#39;Scan&#39; in them and use the ending &#39;SIA&#39;</span>
<span class="sd">	&gt;&gt;&gt; pf.Summarize_scans(path_to_scans = &#39;Scans&#39;, filepart_name = &#39;Scan&#39;, window1=window1)</span>
<span class="sd">	&gt;&gt;&gt; #This does the same as these are standard</span>
<span class="sd">	&gt;&gt;&gt; pf.Summarize_scans(window1=window1)</span>

<span class="sd">	&#39;&#39;&#39;</span>


	<span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span>
	<span class="k">if</span> <span class="n">list_of_scans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">scan_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path_to_scans</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">filename_part</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#we specified a specific name and want only the files with this name in it</span>
			<span class="n">list_of_scans</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scan_path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">scan_path</span><span class="p">)</span> <span class="k">if</span>
									<span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">fileending</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename_part</span> <span class="ow">in</span> <span class="n">name</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span><span class="c1">#we have not specified a specific name and want all files in the folder</span>
			<span class="n">list_of_scans</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">currentFile</span> <span class="k">for</span> <span class="n">currentFile</span> <span class="ow">in</span> <span class="n">scan_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">fileending</span><span class="p">)])</span>
	<span class="k">elif</span> <span class="n">list_of_scans</span> <span class="o">==</span> <span class="s1">&#39;gui&#39;</span><span class="p">:</span>
		<span class="n">root_window</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
		<span class="n">root_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
		<span class="n">root_window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">root_window</span><span class="o">.</span><span class="n">focus_force</span><span class="p">())</span>
		<span class="n">path_list</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="n">multiple</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">filetypes</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Raw scan files&#39;</span><span class="p">,</span><span class="s2">&quot;*.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">fileending</span><span class="p">)])</span>
		<span class="n">list_of_scans</span> <span class="o">=</span> <span class="n">path_list</span>
	<span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">list_of_scans</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;We need something to iterate for the list&#39;</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_scans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">TA</span><span class="p">):</span><span class="c1">#we do not have opened file but most likely a list of names</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">list_of_projects</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">entrance</span> <span class="ow">in</span> <span class="n">list_of_scans</span><span class="p">:</span>
				<span class="n">listen</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">entrance</span><span class="p">)</span>
				<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">filename</span> <span class="o">=</span> <span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">list_of_projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TA</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span><span class="p">,</span> 
											<span class="n">index_is_energy</span> <span class="o">=</span> <span class="n">index_is_energy</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">,</span> 
											<span class="n">sort_indexes</span> <span class="o">=</span> <span class="n">sort_indexes</span><span class="p">,</span> <span class="n">divide_times_by</span> <span class="o">=</span> <span class="n">divide_times_by</span><span class="p">,</span> 
											<span class="n">shift_times_by</span> <span class="o">=</span> <span class="n">shift_times_by</span><span class="p">,</span> <span class="n">external_time</span> <span class="o">=</span> <span class="n">external_time</span><span class="p">,</span> 
											<span class="n">external_wave</span> <span class="o">=</span> <span class="n">external_wave</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

			<span class="n">ds</span> <span class="o">=</span> <span class="n">TA</span><span class="p">(</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span>  <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span><span class="p">,</span> 
					<span class="n">index_is_energy</span> <span class="o">=</span> <span class="n">index_is_energy</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">sort_indexes</span> <span class="o">=</span> <span class="n">sort_indexes</span><span class="p">,</span> 
					<span class="n">divide_times_by</span> <span class="o">=</span> <span class="n">divide_times_by</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="n">shift_times_by</span><span class="p">,</span> 
					<span class="n">external_time</span> <span class="o">=</span> <span class="n">external_time</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="n">external_wave</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span><span class="o">.</span><span class="n">ds</span>
			<span class="n">list_of_projects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_of_projects</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sorry did not understand the project_list entry, use GUI_open to create one&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">list_of_projects</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="n">list_of_scans_names</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">entrance</span> <span class="ow">in</span> <span class="n">list_of_scans</span><span class="p">:</span>
				<span class="n">list_of_projects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entrance</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
				<span class="n">list_of_scans_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entrance</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
			<span class="n">ds</span> <span class="o">=</span> <span class="n">list_of_scans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">list_of_scans</span> <span class="o">=</span> <span class="n">list_of_scans_names</span>
			<span class="n">list_of_projects</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_of_projects</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sorry did not understand the project_list entry, use GUI_open to create one&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">list_to_dump</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">list_to_dump</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;we will use a gui to select single scans to extract&#39;</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">list_to_dump</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;we will use a gui to select the first and last scan to remove&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">list_to_dump</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="c1">#we have only a single number/name in there</span>
				<span class="n">list_to_dump</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_to_dump</span><span class="p">]</span>
			<span class="n">filenames_to_dump</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">list_to_dump</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">filenames_to_dump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_scans</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="c1">#list_of_scans is a list of TA objects that have filename and if entry is an index of this list this goes well</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">filenames_to_dump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="c1"># we assume it is already a filename</span>
			<span class="n">list_to_dump</span> <span class="o">=</span> <span class="p">[]</span>
			<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames_to_dump</span><span class="p">:</span>
				<span class="n">list_to_dump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_of_scans</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span><span class="c1">#we make a maximum of 30 rounds</span>
		<span class="k">if</span> <span class="n">window1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">window1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">1200</span><span class="p">]</span>
		<span class="n">window1_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window1</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window1</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window1</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window1</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span>
		<span class="n">series1</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">list_of_projects</span><span class="p">[</span><span class="n">window1_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">window1_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">window1_index</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">window1_index</span><span class="p">[</span><span class="mi">3</span><span class="p">],:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
		<span class="n">series1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1">:</span><span class="si">%.3g</span><span class="s1"> ps at </span><span class="si">%.1f</span><span class="s1">:</span><span class="si">%.1f</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">window1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">window1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">window1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">window1</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">window2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">window2_index</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window2</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window2</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window2</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">window2</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span>
			<span class="n">series2</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">list_of_projects</span><span class="p">[</span><span class="n">window2_index</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">window2_index</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">window2_index</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">window2_index</span><span class="p">[</span><span class="mi">3</span><span class="p">],:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
			<span class="n">series2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1">:</span><span class="si">%.3g</span><span class="s1"> ps at </span><span class="si">%.1f</span><span class="s1">:</span><span class="si">%.1f</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">window2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">window2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">window2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">window2</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
			<span class="n">fig</span><span class="p">,(</span><span class="n">ax</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
			<span class="n">series1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">use_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
			<span class="n">series2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span><span class="n">use_index</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">15</span><span class="p">:</span>
				<span class="n">gol</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">gol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)),</span> <span class="n">y1</span><span class="o">=</span><span class="n">gol</span><span class="o">-</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="n">y2</span><span class="o">=</span><span class="n">gol</span><span class="o">+</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>	
				<span class="n">gol</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">series2</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">gol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
				<span class="n">ax2</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)),</span> <span class="n">y1</span><span class="o">=</span><span class="n">gol</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="n">y2</span><span class="o">=</span><span class="n">gol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>	
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
			<span class="n">series1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">15</span><span class="p">:</span>
				<span class="n">gol</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">series1</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">gol</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">use_index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)),</span> <span class="n">y1</span><span class="o">=</span><span class="n">gol</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span> <span class="n">y2</span><span class="o">=</span><span class="n">gol</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">series1</span><span class="o">.</span><span class="n">var</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">list_to_dump</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;click on the scans that should be dropped</span><span class="se">\n</span><span class="s1"> left click to chose, right click to delete last point, middle click finishes selection</span><span class="se">\n</span><span class="s1"> an empty middle click ends the process&#39;</span><span class="p">)</span>
			<span class="n">polypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">show_clicks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mouse_add</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mouse_pop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mouse_stop</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polypts</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span><span class="k">break</span>
			<span class="n">to_remove</span><span class="o">=</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">polypts</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]]</span>
			<span class="n">remove</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span>	
			<span class="n">remove</span><span class="p">[</span><span class="n">to_remove</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
			<span class="n">to_remove</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">remove</span><span class="p">[</span><span class="n">remove</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
			<span class="n">to_keep</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">remove</span><span class="p">[</span><span class="n">remove</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">list_to_dump</span> <span class="o">==</span> <span class="s1">&#39;range&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;click on the first and last scan to be removed, repeat as long as necessary</span><span class="se">\n</span><span class="s1"> an empty middle click ends the process&#39;</span><span class="p">)</span>
			<span class="n">polypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">show_clicks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mouse_add</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mouse_pop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mouse_stop</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polypts</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span><span class="k">break</span>
			<span class="n">polypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">polypts</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
			<span class="n">remove</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">polypts</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)):</span>
				<span class="n">remove</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">polypts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]:</span><span class="n">polypts</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span>
			<span class="n">to_remove</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">remove</span><span class="p">[</span><span class="n">remove</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
			<span class="n">to_keep</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">remove</span><span class="p">[</span><span class="n">remove</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">to_keep</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series1</span><span class="p">)))</span>
			<span class="n">to_keep</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">list_to_dump</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Something is weired&#39;</span><span class="p">)</span>
		<span class="n">list_of_projects</span><span class="o">=</span><span class="n">list_of_projects</span><span class="p">[:,:,</span><span class="n">to_keep</span><span class="p">]</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
	<span class="n">ds</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">list_of_projects</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">save_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">save_name</span><span class="p">))</span>
		<span class="n">ds</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">ta</span><span class="o">=</span><span class="n">TA</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;temp_combined.SIA&#39;</span><span class="p">))</span>
		<span class="n">ds</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
		<span class="n">ta</span><span class="o">=</span><span class="n">TA</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not remove temp_combined.SIA&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">return_ds_only</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ds</span>
	<span class="k">elif</span> <span class="n">return_removed_list</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">filenames_to_dump</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ta</span></div>
		

<span class="k">def</span> <span class="nf">sub_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drop_ignore</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">baseunit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">drop_scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">wavelength</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;This is the main function that creates all the slices of the data matrix</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	times : float or list/vector (of floats), optional</span>
<span class="sd">		For each entry in rel_time a spectrum is plotted. If time_width_percent=0 (Default) the </span>
<span class="sd">		nearest measured timepoint is chosen. For other values see &#39;time_width_percent&#39;</span>
<span class="sd">	</span>
<span class="sd">	time_width_percent : float</span>
<span class="sd">		&quot;rel_time&quot; and &quot;time_width_percent&quot; work together for creating spectral plots at </span>
<span class="sd">		specific timepoints. For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">		If however e.g. time_width_percent=10 the region between the timepoint closest </span>
<span class="sd">		to the  1.1 x timepoint and 0.9 x timepoint is averaged and shown </span>
<span class="sd">		(and the legend adjusted accordingly). This is particularly useful for the densly</span>
<span class="sd">		sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">		timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">		but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">		This averaging is only applied for the plotting function and not for the fits.</span>

<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	drop_ignore : Bool, True or False, optional</span>
<span class="sd">		If set to True the values in ignore_time_region are removed from the dataset instead of set to zero</span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>
<span class="sd">		</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">				</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	drop_scatter : Bool, True or False, optional</span>
<span class="sd">		If set to True the values in scattercut are removed from the dataset instead of set to zero</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd"> </span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">	</span>
<span class="sd">	wavelength : float or list (of floats), optional </span>
<span class="sd">		&#39;wavelength&#39; and &#39;wavelength_bin&#39; work together for the creation </span>
<span class="sd">		of kinetic plots. When plotting kinetic spectra one line will be plotted for each entrance</span>
<span class="sd">		in the list/vector rel_wave. During object generation the vector np.arange(300,1000,100) </span>
<span class="sd">		is set as standard. Another typical using style would be to define a list of interesting </span>
<span class="sd">		wavelength at which a kinetic development is to be plotted. At each selected wavelength </span>
<span class="sd">		the data between wavelength+ta.wavelength_bin and wavelength-ta.wavelength_bin is averaged </span>
<span class="sd">		for each timepoint returned </span>
<span class="sd">	</span>
<span class="sd">	wavelength_bin : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) None</span>
<span class="sd">		</span>
<span class="sd">	time_bin : None or int, optional</span>
<span class="sd">		is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">		This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">		it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">		affects the kinetics is &#39;time_width_percent&#39;</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">time_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
	<span class="n">energy_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;can not get wavelength and times back&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">bordercut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">bordercut</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">bordercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wave_nm_bin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">wavelength</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
		<span class="c1">#print(&#39;rebinning&#39;)</span>
		<span class="n">x</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">y</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_nm_bin</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wavelength_nm_bins bins are to small for the data&quot;</span><span class="p">)</span>
						
		<span class="n">rebin_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="n">wave_nm_bin</span><span class="p">)</span><span class="c1">#find the position where the difference is larger than the wave_nm_bin</span>
		<span class="k">if</span> <span class="n">rebin_max</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span><span class="n">rebin_max</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="c1"># we get 0 when all teh values are ok</span>
		<span class="k">if</span> <span class="n">rebin_max</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">wave_nm_bin</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wavelength_nm_bins bins are to small for the data&quot;</span><span class="p">)</span>
														
			<span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x</span><span class="p">[</span><span class="n">rebin_max</span><span class="p">],</span><span class="n">wave_nm_bin</span><span class="p">)</span>
			<span class="n">bin_means</span><span class="p">,</span><span class="n">bin_edges</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">rebin_max</span><span class="p">],</span> <span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">[:,:</span><span class="n">rebin_max</span><span class="p">],</span> <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
						   
			<span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
			<span class="n">ds</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bin_means</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">bins</span><span class="p">),</span><span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">rebin_max</span><span class="p">:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>
					   
		<span class="k">else</span><span class="p">:</span>
			<span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="n">wave_nm_bin</span><span class="p">,</span><span class="n">wave_nm_bin</span><span class="p">)</span>
			<span class="n">bin_means</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
			<span class="n">ds</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bin_means</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">time_bin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">time</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">y</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">time_bin</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">time_bin</span><span class="p">)</span>
		<span class="n">time_bins</span><span class="o">=</span><span class="n">time</span><span class="p">[::</span><span class="n">time_bin</span><span class="p">]</span>
		<span class="n">bin_means</span><span class="p">,</span><span class="n">bins</span> <span class="o">=</span> <span class="n">binned_statistic</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">statistic</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">time_bins</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>
		<span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bin_means</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">T</span>

	<span class="k">if</span> <span class="n">timelimits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span>	
	<span class="k">if</span> <span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">if</span> <span class="mi">0</span><span class="p">:</span><span class="c1">#old version using find_nearest</span>
			<span class="n">y</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
				<span class="n">lower</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">upper</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
				<span class="k">if</span> <span class="n">drop_ignore</span><span class="p">:</span>
					<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">ignore_time_region</span><span class="p">:</span>
						<span class="n">lower</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
						<span class="n">upper</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">entries</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
						<span class="k">if</span> <span class="n">drop_ignore</span><span class="p">:</span>
							<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">,:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">,:]</span><span class="o">=</span><span class="mi">0</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">drop_ignore</span><span class="p">:</span>
					<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">=</span><span class="mi">0</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">ignore_time_region</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">drop_ignore</span><span class="p">:</span>
							<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">entries</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">entries</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">=</span><span class="mi">0</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		
	<span class="k">if</span> <span class="n">scattercut</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">x</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">lower</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">upper</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">drop_scatter</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">scattercut</span><span class="p">:</span>
					<span class="n">lower</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="n">upper</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">entries</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
					<span class="k">if</span> <span class="n">drop_scatter</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">lower</span><span class="p">:</span><span class="n">upper</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				
	<span class="c1">#until here we always have the same matrix</span>
	<span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
	<span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
	
	<span class="k">if</span> <span class="n">wavelength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#ok we want to have singular wavelength</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">wavelength</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wavelength</span><span class="p">])</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span><span class="n">wavelength</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">wave</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wavelength</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">out</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">wave</span><span class="o">-</span><span class="n">wavelength_bin</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">wave</span><span class="o">+</span><span class="n">wavelength_bin</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
				<span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">wave</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">wave</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span><span class="k">continue</span>
				<span class="n">out</span><span class="p">[</span><span class="n">wave</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">wave</span><span class="o">-</span><span class="n">wavelength_bin</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="n">wave</span><span class="o">+</span><span class="n">wavelength_bin</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
		<span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">out</span>
	<span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1">#ok we want to have single times</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">times</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">times</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">baseunit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span>
		<span class="n">time_scale</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
		<span class="k">if</span> <span class="n">time_width_percent</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>			
				<span class="k">if</span> <span class="n">time</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">time_scale</span><span class="p">,</span><span class="n">time</span><span class="o">+</span><span class="n">time</span><span class="o">*</span><span class="n">time_width_percent</span><span class="o">/</span><span class="mf">100.</span><span class="p">),</span>
							  <span class="n">find_nearest_index</span><span class="p">(</span><span class="n">time_scale</span><span class="p">,</span><span class="n">time</span><span class="o">-</span><span class="n">time</span><span class="o">*</span><span class="n">time_width_percent</span><span class="o">/</span><span class="mf">100.</span><span class="p">)]</span>		 
				<span class="k">else</span><span class="p">:</span>
					<span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">time_scale</span><span class="p">,</span><span class="n">time</span><span class="o">-</span><span class="n">time</span><span class="o">*</span><span class="n">time_width_percent</span><span class="o">/</span><span class="mf">100.</span><span class="p">),</span>
							  <span class="n">find_nearest_index</span><span class="p">(</span><span class="n">time_scale</span><span class="p">,</span><span class="n">time</span><span class="o">+</span><span class="n">time</span><span class="o">*</span><span class="n">time_width_percent</span><span class="o">/</span><span class="mf">100.</span><span class="p">)]</span>						 
				<span class="n">time_lower</span> <span class="o">=</span> <span class="n">time_scale</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
				<span class="n">time_upper</span> <span class="o">=</span> <span class="n">time_scale</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
				<span class="n">time_mean</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_lower</span><span class="o">+</span><span class="n">time_upper</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
				<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">out</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
					<span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%.3g</span><span class="s1"> - </span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">time_mean</span><span class="p">,</span><span class="n">baseunit</span><span class="p">,</span><span class="n">time_lower</span><span class="p">,</span><span class="n">time_upper</span><span class="p">,</span><span class="n">baseunit</span><span class="p">)]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">out</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%3g</span><span class="s1"> - </span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">time_mean</span><span class="p">,</span><span class="n">baseunit</span><span class="p">,</span><span class="n">time_lower</span><span class="p">,</span><span class="n">time_upper</span><span class="p">,</span><span class="n">baseunit</span><span class="p">)]</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],:]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>			 
		<span class="k">else</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">time</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
				<span class="n">index</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">time_scale</span><span class="p">,</span><span class="n">time</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">out</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
					<span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">time_scale</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">baseunit</span><span class="p">)]</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">out</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">time_scale</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="n">baseunit</span><span class="p">)]</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">,:]</span>
		<span class="n">out</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">out</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">ds</span><span class="o">=</span><span class="n">out</span>
		<span class="c1">#ds.index.name=&#39;Wavelength in nm&#39;</span>
	<span class="n">ds</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#lets fill nan values with zero to catch probems</span>
	<span class="k">return</span> <span class="n">ds</span>


<div class="viewcode-block" id="plot2d"><a class="viewcode-back" href="../plot_func.html#plot_func.plot2d">[docs]</a><span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
			<span class="n">wavelength_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;function for plotting matrix of TA data.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	ax : None, matplotlib axis object optional</span>
<span class="sd">		If None (Default) a new plot is is created and a new axis, otherwise ax needs to be Matplotlib Axis</span>

<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">	</span>
<span class="sd">	title : None or str</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; </span>
<span class="sd">		</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">		</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">		</span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>
<span class="sd">	</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	time_bin : None or int, optional</span>
<span class="sd">		is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">		This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">		it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">		affects the kinetics is &#39;time_width_percent&#39;</span>
<span class="sd">		 </span>
<span class="sd">	log_scale : bool, optional</span>
<span class="sd">		If True (Default), The 2D plots (Matrix) is plotted with a pseudo logarithmic intensity scale. </span>
<span class="sd">		This usually does not give good results unless the intensity scale is symmetric </span>
<span class="sd">		</span>
<span class="sd">	plot_type : None or str</span>
<span class="sd">		is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">		&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.</span>
<span class="sd">		</span>
<span class="sd">	lintresh : float</span>
<span class="sd">		The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">		time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 0.3 </span>
<span class="sd">		</span>
<span class="sd">	wavelength_bin : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm</span>
<span class="sd">	</span>
<span class="sd">	levels : int, optional</span>
<span class="sd">		how many different colours to use in the description. less makes for more contrast but less </span>
<span class="sd">		intensity details (Default) 256</span>
<span class="sd">		</span>
<span class="sd">	use_colorbar : bool, optional</span>
<span class="sd">		if True (Default) a colour bar is added to the 2d plot for intensity explanation, switch</span>
<span class="sd">		mostely used for creating multiple plots</span>
<span class="sd">	</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>

<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">cmap</span><span class="o">=</span><span class="n">standard_map</span>
	<span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">)):</span><span class="c1">#we must have a </span>
		<span class="n">cmap</span><span class="o">=</span><span class="n">standard_map</span>

	<span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ax_ori</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax_ori</span><span class="o">=</span><span class="kc">True</span>
		<span class="n">fig</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_images</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">timelimits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">timelimits</span><span class="o">=</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
	<span class="n">ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> 
				<span class="n">wavelength_bin</span> <span class="o">=</span> <span class="n">wavelength_bin</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="n">time_bin</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> 
				<span class="n">drop_scatter</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">drop_ignore</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>		
	<span class="k">if</span> <span class="n">intensity_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">maxim</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="nb">abs</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span><span class="nb">abs</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span><span class="p">())])</span>
			<span class="n">intensity_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">maxim</span><span class="p">,</span><span class="n">maxim</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">intensity_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">1e-2</span><span class="p">,</span><span class="mf">1e-2</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="c1">#lets have an lazy option</span>
			<span class="n">intensity_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
					   
			<span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;I highly recommend to make a symmetric intensity distribution for logarithmic scale, the colorbar might look strange otherwise&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span> 
		<span class="n">bounds0</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">levels</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span> <span class="n">levels</span><span class="p">))</span>
		<span class="n">bounds1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">levels</span><span class="o">/</span><span class="mi">2</span><span class="p">)),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>	 <span class="n">levels</span><span class="p">)</span>
		<span class="n">bounds0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">bounds1</span><span class="p">:</span>
			<span class="n">bounds0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
		<span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">bounds0</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">bounds0</span><span class="p">))</span>
		<span class="n">mid_color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)[(</span><span class="n">levels</span><span class="o">-</span><span class="n">levels</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
		<span class="c1">#norm=colors.SymLogNorm(levels,linthresh=1e-5, linscale=1e-5,vmin=intensity_range[0], vmax=intensity_range[1])</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">nbins</span><span class="o">=</span><span class="n">levels</span>
		<span class="n">levels</span> <span class="o">=</span> <span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">levels</span><span class="p">)</span><span class="o">.</span><span class="n">tick_values</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">norm</span> <span class="o">=</span> <span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span><span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ncolors</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
		<span class="n">mid_color_index</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">levels</span><span class="p">)</span>
		<span class="n">mid_color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
		<span class="n">mid_color</span><span class="o">=</span><span class="n">mid_color</span><span class="p">[</span><span class="n">mid_color_index</span><span class="p">]</span>
		
	<span class="n">x</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
	<span class="n">y</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
	<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
	<span class="n">img</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">shading</span><span class="o">=</span><span class="n">shading</span><span class="p">)</span>
	
	<span class="k">if</span> <span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
		<span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="c1">#upper=find_nearest_index(y,ignore_time_region[1])</span>
			<span class="n">upper</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
			<span class="c1">#if upper==0:raise</span>
			<span class="c1">#lower=find_nearest_index(y[:upper],ignore_time_region[0])</span>
			<span class="n">lower</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
			<span class="c1">#rect = plt.Rectangle((x.min(),y[lower]), width=abs(ax.get_xlim()[1]-ax.get_xlim()[0]), height=abs(y[upper]-y[lower]),facecolor=mid_color,alpha=1)#mid_color)</span>
			<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">lower</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">height</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="n">mid_color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">#mid_color)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ignore_time_region_loc</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region_loc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="c1">#upper=find_nearest_index(y,ignore_time_region[k+1])</span>
				<span class="n">upper</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
				<span class="c1">#if upper==0:raise</span>
				<span class="c1">#lower=find_nearest_index(y[:upper],ignore_time_region[k])</span>
				<span class="n">lower</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="n">k</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
				<span class="c1">#rect = plt.Rectangle((x.min(),y[lower]), width=abs(ax.get_xlim()[1]-ax.get_xlim()[0]), height=abs(y[upper]-y[lower]),facecolor=mid_color,alpha=1)#mid_color)</span>
				<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">lower</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">height</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="n">mid_color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>

	<span class="k">if</span> <span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">pass</span>
	<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">upper</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
			<span class="c1">#upper=find_nearest_index(x,scattercut[1])</span>
			<span class="c1">#if upper==0:raise</span>
			<span class="c1">#lower=find_nearest_index(x[:upper],scattercut[0])</span>
			<span class="n">lower</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
			<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">lower</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">height</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="n">mid_color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">#mid_color)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">scattercut</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">upper</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">scattercut</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">upper</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span><span class="k">raise</span>
				<span class="n">lower</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">scattercut</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]:]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
				<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">lower</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">height</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">width</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">upper</span><span class="o">-</span><span class="n">lower</span><span class="p">),</span><span class="n">facecolor</span><span class="o">=</span><span class="n">mid_color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="c1">#mid_color)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>	
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>	
	<span class="k">if</span> <span class="n">use_colorbar</span><span class="p">:</span>
		<span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
		<span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span>
			<span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mid</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">mid</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">mid</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">mid</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
																	
		<span class="k">else</span><span class="p">:</span>
			<span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">mid</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">mid</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
																				  
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
		<span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="o">+</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">cbar</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">ticks</span><span class="o">=</span><span class="n">values</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
		<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
		<span class="n">a</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span>
		<span class="n">fontsize</span><span class="o">=</span><span class="n">a</span><span class="o">.</span><span class="n">get_fontsize</span><span class="p">()</span>
		<span class="n">fontsize</span><span class="o">-=</span><span class="mi">4</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#we use this as a switch to enable a flexible avoidance of the label setting.</span>
			<span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">ax_ori</span><span class="p">:</span><span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">data_type</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Log-scale&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span><span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">data_type</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Log-scale&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>		
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">ax_ori</span><span class="p">:</span><span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span><span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span><span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
	<span class="k">if</span> <span class="s2">&quot;symlog&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>

		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="n">lintresh</span><span class="p">,</span><span class="n">lintresh</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">lintresh</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">lintresh</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
		<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="n">lintresh</span><span class="p">)</span>
			<span class="n">locmaj</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">10.</span><span class="p">,</span><span class="mf">1e2</span><span class="p">,</span><span class="mf">1e3</span><span class="p">,</span><span class="mf">1e4</span><span class="p">))</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locmaj</span><span class="p">)</span>
			<span class="n">locmin</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">LogLocator</span><span class="p">(</span><span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">subs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">))</span> 
			<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">locmin</span><span class="p">)</span>
			<span class="n">ticks</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">())</span>	
			<span class="n">ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lintresh</span><span class="p">)</span>
			<span class="p">[</span><span class="n">ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>
			<span class="n">ticks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">:</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ticks</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">ticks</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">max</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
				   
			<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;here2&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="n">lintresh</span><span class="p">,</span><span class="n">subsy</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">linscaley</span><span class="o">=</span><span class="n">lintresh</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
	<span class="k">elif</span> <span class="s2">&quot;log&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>
		<span class="n">lower_time</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">lower_time</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">timelimits</span><span class="p">)</span>
	
	<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
	<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">title</span><span class="p">:</span>
		<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>	
	<span class="k">if</span> <span class="n">ax_ori</span><span class="p">:</span><span class="k">return</span> <span class="n">ax</span>
	<span class="k">return</span> <span class="n">fig</span></div>


<div class="viewcode-block" id="plot2d_fit"><a class="viewcode-back" href="../plot_func.html#plot_func.plot2d_fit">[docs]</a><span class="k">def</span> <span class="nf">plot2d_fit</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">error_matrix_amplification</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">use_images</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">patches</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
				<span class="n">intensity_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
				<span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
				<span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
				<span class="n">wavelength_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">plot_with_colorbar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
				<span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">):</span>													   
	<span class="sd">&#39;&#39;&#39;Plots the fit output as a single plot with meas,fitted and difference. </span>
<span class="sd">	The differnece used err_matrix_amplification as a factor. patches moves the labels from the</span>
<span class="sd">	title into white patches in the top of the figure</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	re : dict</span>
<span class="sd">		Dictionary that contains the fit results and  specific the dataframes A, AC and AE </span>
<span class="sd">	</span>
<span class="sd">	error_matrix_amplification : int, optional</span>
<span class="sd">		the error matrix AE is multiplied by this factor for the plot.</span>
<span class="sd">	</span>
<span class="sd">	use_images : bool:</span>
<span class="sd">		(Default)True converts the matrix into images, to reduce the filesize. </span>
<span class="sd">	</span>
<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">		</span>
<span class="sd">	patches : bool, optional</span>
<span class="sd">		If False (Default) the names &quot;measured&quot; &quot;fitted&quot; &quot;difference&quot; will be placed above the images.</span>
<span class="sd">		If True, then they will be included into the image (denser)</span>
<span class="sd">	</span>
<span class="sd">	title : None or str</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; </span>
<span class="sd">		</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">		</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">		</span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>
<span class="sd">	</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	time_bin : None or int, optional</span>
<span class="sd">		is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">		This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">		it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">		affects the kinetics is &#39;time_width_percent&#39;</span>
<span class="sd">		 </span>
<span class="sd">	log_scale : bool, optional</span>
<span class="sd">		If True (Default), The 2D plots (Matrix) is plotted with a pseudo logarithmic intensity scale. </span>
<span class="sd">		This usually does not give good results unless the intensity scale is symmetric </span>
<span class="sd">		</span>
<span class="sd">	Scale_type : None or str</span>
<span class="sd">		is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">		&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.</span>
<span class="sd">		</span>
<span class="sd">	lintresh : float</span>
<span class="sd">		The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">		time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 0.3 </span>
<span class="sd">		</span>
<span class="sd">	wavelength_bin : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm</span>
<span class="sd">	</span>
<span class="sd">	levels : int, optional</span>
<span class="sd">		how many different colours to use in the description. less makes for more contrast but less </span>
<span class="sd">		intensity details (Default) 256</span>
<span class="sd">		</span>
<span class="sd">	plot_with_colorbar : bool, optional</span>
<span class="sd">		if True (Default) a colour bar is added to the 2d plot for intensity explanation, switch</span>
<span class="sd">		mostely used for creating multiple plots</span>
<span class="sd">	</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">	</span>
<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="k">if</span> <span class="n">intensity_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">intensity_range</span><span class="o">=</span><span class="mf">5e-3</span>
	<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span>
	<span class="k">if</span> <span class="n">patches</span><span class="p">:</span>			
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
				<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> 
				<span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
				<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> 
				<span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">)</span><span class="o">/</span><span class="n">error_matrix_amplification</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> 
				<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
				<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
			<span class="n">stringen</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;measured&#39;</span><span class="p">,</span><span class="s1">&#39;calculated&#39;</span><span class="p">,</span><span class="s1">&#39;difference&#39;</span><span class="p">]</span>
			<span class="n">x_width</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mi">4</span>
			<span class="k">if</span> <span class="s1">&#39;lin&#39;</span> <span class="ow">in</span> <span class="n">scale_type</span><span class="p">:</span>
				<span class="n">y_width</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">8</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">y_width</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">1.5</span>
			<span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_width</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_width</span><span class="p">),</span> <span class="n">x_width</span><span class="p">,</span> <span class="n">y_width</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
			<span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x_width</span><span class="o">+</span><span class="n">x_width</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y_width</span><span class="o">+</span><span class="n">y_width</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span><span class="n">stringen</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>								 
			<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.067</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.985</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.258</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Measured&#39;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
				<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
				<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>																					
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Calculated&#39;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
				<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
				<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span> <span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="n">plot2d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Difference&#39;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">)</span><span class="o">/</span><span class="n">error_matrix_amplification</span><span class="p">,</span> 
				<span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="n">plot_with_colorbar</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
				<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="c1">#fig.subplots_adjust(left=0.15, bottom=0.067, right=0.97, top=0.97, wspace=0.0, hspace=0.398)</span>
	<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">return</span> <span class="n">fig</span></div>
	
	
<div class="viewcode-block" id="plot_fit_output"><a class="viewcode-back" href="../plot_func.html#plot_func.plot_fit_output">[docs]</a><span class="k">def</span> <span class="nf">plot_fit_output</span><span class="p">(</span> <span class="n">re</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">standard_map</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="s1">&#39;standard&#39;</span><span class="p">,</span> 
					<span class="n">intensity_range</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
					<span class="n">error_matrix_amplification</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">rel_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> 
					<span class="n">time_width_percent</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_figures_to_folder</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
					<span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">evaluation_style</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
					<span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">print_click_position</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
					<span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;nm&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Purly manual function that plots all the fit output figures. Quite cumbersome, </span>
<span class="sd">	but offers a lot of manual options. The figures can be called separately </span>
<span class="sd">	or with a list of plots. e.g. range(6) call plots 0-5 Manual plotting of certain type:</span>
<span class="sd">	This is a wrapper function that triggers the plotting of all the fitted plots.</span>
<span class="sd">	The parameter in this plot call are to control the general look and features of the plot.</span>
<span class="sd">	Which plots are printed is defined by the command (plotting)</span>
<span class="sd">	The plots are generated from the fitted Matrixes and as such only will work after a fit was actually</span>
<span class="sd">	completed (and the &quot;re&quot; dictionary attached to the object.)</span>
<span class="sd">	In all plots the RAW data is plotted as dots and the fit with lines </span>
<span class="sd">	</span>
<span class="sd">	*Contents of the plots*</span>

<span class="sd">	0. DAC contains the assigned spectra for each component of the fit. For</span>
<span class="sd">	   a modelling with independent exponential decays this corresponds to</span>
<span class="sd">	   the &quot;Decay Associated Spectra&quot; (DAS). For all other models this</span>
<span class="sd">	   contains the &quot;Species Associated Spectra&quot; (SAS). According to the</span>
<span class="sd">	   model the separate spectra are labeled by time (process) or name, if</span>
<span class="sd">	   a name is associated in the fitting model. The spectra are shown in</span>
<span class="sd">	   the extracted strength in the right pane and normalized in the left.</span>
<span class="sd">	   Extracted strength means that the measured spectral strength is the</span>
<span class="sd">	   intensity (concentration matrix) times this spectral strength. As the</span>
<span class="sd">	   concentration maxima for all DAS are 1 this corresponds to the</span>
<span class="sd">	   spectral strength for the DAS. (please see the documentation for the</span>
<span class="sd">	   fitting algorithm for further details)</span>

<span class="sd">	1. summed intensity. All wavelength of the spectral axis are summed for</span>
<span class="sd">	   data and fit. The data is plotted in a number of ways vs linear and</span>
<span class="sd">	   logarithmic axis. This plot is not ment for publication but very</span>
<span class="sd">	   useful to evaluate the quality of a fit.</span>

<span class="sd">	2. plot kinetics for selected wavelength (see corresponding RAW plot)</span>

<span class="sd">	3. plot spectra at selected times (see corresponding RAW plot)</span>

<span class="sd">	4. plots matrix (measured, modelled and error Matrix). The parameter are</span>
<span class="sd">	   the same as used for the corresponding RAW plot with the addition of</span>
<span class="sd">	   &quot;error_matrix_amplification&quot; which is a scaling factor multiplied</span>
<span class="sd">	   onto the error matrix. I recommend to play with different &quot;cmap&quot;,</span>
<span class="sd">	   &quot;log_scale&quot; and &quot;intensity_scale&quot; to create a pleasing plot</span>

<span class="sd">	5. concentrations. In the progress of the modelling/fitting a matrix is</span>
<span class="sd">	   generated that contains the relative concentrations of the species</span>
<span class="sd">	   modelled. This plot is showing the temporal development of these</span>
<span class="sd">	   species. Further details on how this matrix is generated can be found</span>
<span class="sd">	   in the documentation of the fitting function. The modeled spectra are</span>
<span class="sd">	   the convolution of these vectors (giving the time-development) and</span>
<span class="sd">	   the DAS/SAS (giving the spectral development).</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	re : dict</span>
<span class="sd">		Dictionary that contains the fit results and  specific the dataframes A, AC and AE </span>

<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">	error_matrix_amplification : int, optional</span>
<span class="sd">		the error matrix AE is multiplied by this factor for the plot.</span>
<span class="sd">	</span>
<span class="sd">	plotting : int or iterable (of integers), optional</span>
<span class="sd">		This parameter determines which figures are plotted </span>
<span class="sd">		the figures can be called separately with plotting = 1</span>
<span class="sd">		or with a list of plots (Default) e.g.~plotting=range(6) calls plots 0,1,2,3,4,5</span>
<span class="sd">		The plots have the following numbers:\</span>
<span class="sd">		0 - DAS or SAS\</span>
<span class="sd">		1 - summed intensity\</span>
<span class="sd">		2 - Kinetics\</span>
<span class="sd">		3 - Spectra\</span>
<span class="sd">		4 - Matrixes\</span>
<span class="sd">		5 - Concentrations (the c-object)\</span>
<span class="sd">		The plotting takes all parameter from the &quot;ta&quot; object unless otherwise specified</span>
<span class="sd">	</span>
<span class="sd">	path : None, str or path object, optional</span>
<span class="sd">		This defines where the files are saved if the safe_figures_to_folder parameter is True, </span>
<span class="sd">		quite useful if a lot of data sets are to be printed fast. </span>
<span class="sd">		If a path is given, this is used. If a string like the (Default) &quot;result_figures&quot; is given, </span>
<span class="sd">		then a subfolder of this name will be used (an generated if necessary) </span>
<span class="sd">		relative to self.path. Use and empty string to use the self.path</span>
<span class="sd">		If set to None, the location of the plot_func will be used and</span>
<span class="sd">		a subfolder with title &quot;result_figures&quot; be generated here</span>
<span class="sd">	</span>
<span class="sd">	savetype : str or iterable (of str), optional </span>
<span class="sd">		matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">		typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;.  </span>
<span class="sd">		</span>
<span class="sd">	evaluation_style : bool, optional</span>
<span class="sd">		True (Default = False) adds a lot of extra information in the plot</span>
<span class="sd">	</span>
<span class="sd">	title : None or str, optional</span>
<span class="sd">	   &quot;title=None&quot; is in general the filename that was loaded. Setting a</span>
<span class="sd">	   specific title will be used in all plots. To remove the title all</span>
<span class="sd">	   together set an empty string with title=&quot;&quot;</span>
<span class="sd">	</span>
<span class="sd">	scale_type : str, optional</span>
<span class="sd">	   refers to the time-axis and takes, symlog (Default)(linear around zero and logarithmic otherwise)</span>
<span class="sd">	   and lin for linear and  log for logarithmic, switching all the time axis to this type</span>
<span class="sd">	</span>
<span class="sd">	patches : bool, optional</span>
<span class="sd">		If False (Default) the names &quot;measured&quot; &quot;fitted&quot; &quot;difference&quot; will be placed above the images.</span>
<span class="sd">		If True, then they will be included into the image (denser)</span>

<span class="sd">	filename : str, optional</span>
<span class="sd">		offers to replace the base-name used for all plots (to e.g.~specify what sample was used). </span>
<span class="sd">		if (Default) None is used, the self.filename is used as a base name. The filename plays only a </span>
<span class="sd">		role during saving, as does the path and savetype	</span>


<span class="sd">	save_figures_to_folder : bool, optional</span>
<span class="sd">		(Default) is True, if True the Figures are automatically saved </span>

<span class="sd">	log_scale : bool, optional</span>
<span class="sd">		If True (Default), The 2D plots (Matrix) is plotted with a pseudo logarithmic intensity scale. </span>
<span class="sd">		This usually does not give good results unless the intensity scale is symmetric </span>


<span class="sd">	subplot : bool, optional</span>
<span class="sd">		If False (Default) axis labels and such are set. If True, we plot into the same axis and </span>
<span class="sd">		do not set labels</span>
<span class="sd">		</span>

<span class="sd">	color_offset : int, optional</span>
<span class="sd">		At the (Default) 0 the colours are chose from the beginning, for a larger value Color_offset </span>
<span class="sd">		colors are skipped. Usually only used if multiple plots are created, and the data/or fit is</span>
<span class="sd">		only shown for some of them.</span>
<span class="sd">		</span>
<span class="sd">	lintresh : float</span>
<span class="sd">		The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">		time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 1 </span>


<span class="sd">	rel_time : float or list/vector (of floats), optional</span>
<span class="sd">		For each entry in rel_time a spectrum is plotted. If time_width_percent=0 (Default) the </span>
<span class="sd">		nearest measured timepoint is chosen. For other values see &#39;time_width_percent&#39;</span>

<span class="sd">	time_width_percent : float</span>
<span class="sd">		&quot;rel_time&quot; and &quot;time_width_percent&quot; work together for creating spectral plots at </span>
<span class="sd">		specific timepoints. For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">		If however e.g. time_width_percent=10 the region between the timepoint closest </span>
<span class="sd">		to the  1.1 x timepoint and 0.9 x timepoint is averaged and shown </span>
<span class="sd">		(and the legend adjusted accordingly). This is particularly useful for the densly</span>
<span class="sd">		sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">		timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">		but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">		This averaging is only applied for the plotting function and not for the fits.</span>
<span class="sd">		</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>

<span class="sd">	width : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm</span>

<span class="sd">	rel_wave : float or list (of floats), optional </span>
<span class="sd">		&#39;rel_wave&#39; and &#39;width&#39; (in the object called &#39;wavelength_bin&#39; work together for the creation </span>
<span class="sd">		of kinetic plots. When plotting kinetic spectra one line will be plotted for each entrance</span>
<span class="sd">		in the list/vector rel_wave. During object generation the vector np.arange(300,1000,100) </span>
<span class="sd">		is set as standard. Another typical using style would be to define a list of interesting </span>
<span class="sd">		wavelength at which a kinetic development is to be plotted. At each selected wavelength </span>
<span class="sd">		the data between wavelength+ta.wavelength_bin and wavelength-ta.wavelength_bin is averaged </span>
<span class="sd">		for each timepoint returned </span>

<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>

<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>

<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.	</span>
<span class="sd">	</span>
<span class="sd">	f : str</span>
<span class="sd">		f is a replacement title that is set instead of the title. mainly used to have some options </span>
<span class="sd">		(Default) is &#39;standard&#39;</span>
<span class="sd">			</span>
<span class="sd">	log_fit : bool, optional</span>
<span class="sd">		(default)= False Used for legend generation, tells if the fit was in log or lin space </span>
<span class="sd">	</span>
<span class="sd">	mod : str, optional</span>
<span class="sd">		Used for legend generation, tells what model was used for fitting </span>

<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.		</span>
<span class="sd">	</span>
<span class="sd">	print_click_position : bool, optional</span>
<span class="sd">		if True then the click position is printed for the spectral plots </span>
<span class="sd">	</span>
<span class="sd">	Examples</span>
<span class="sd">	------------</span>
<span class="sd">			</span>
<span class="sd">	&gt;&gt;&gt; ta.plot_fit_output(ta.re,ta.ds)</span>
<span class="sd">		</span>
<span class="sd">	&#39;&#39;&#39;</span>
					 
	<span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">width</span><span class="o">=</span><span class="n">wave_nm_bin</span>
	<span class="n">stringen</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">timedf</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span><span class="n">mod</span><span class="o">=</span><span class="s1">&#39;ext. func.&#39;</span>
	<span class="k">if</span> <span class="n">evaluation_style</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stringen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Fit with Model: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">mod</span><span class="p">)</span>
		<span class="n">timedf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="s2">&quot;res&quot;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">timedf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;init_value&#39;</span><span class="p">:</span> <span class="s2">&quot;init&quot;</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>	  
		<span class="n">stringen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timedf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">],</span><span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.3g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span><span class="n">justify</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">]:</span><span class="n">stringen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Fit with ind.</span><span class="se">\n</span><span class="s1">expon. decays:&#39;</span><span class="p">)</span>	
			<span class="k">else</span><span class="p">:</span><span class="n">stringen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Fit with time parameters:&#39;</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">timedf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span><span class="s1">&#39;t0&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="n">stringen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timedf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.3g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
	<span class="n">stringen</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stringen</span><span class="p">)</span>
	<span class="n">times</span><span class="o">=</span><span class="n">timedf</span><span class="p">[</span><span class="n">timedf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
	<span class="n">time_string</span><span class="o">=</span><span class="n">timedf</span><span class="p">[</span><span class="n">timedf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span><span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{:.3g}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plotting</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">plotting</span><span class="o">=</span><span class="p">[</span><span class="n">plotting</span><span class="p">]</span>
	<span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#DAC</span>
		<span class="c1">#-------plot DAC------------</span>
		<span class="c1">#for i,col in enumerate(re[&#39;DAC&#39;]):</span>
			<span class="c1">#re[&#39;DAC&#39;].iloc[:,i]=re[&#39;DAC&#39;].iloc[:,i].values*re[&#39;c&#39;].max().iloc[i]</span>
		<span class="n">fig1</span><span class="p">,(</span><span class="n">ax1a</span><span class="p">,</span><span class="n">ax1b</span><span class="p">,</span><span class="n">ax1c</span><span class="p">)</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>
		<span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
		<span class="n">DAC</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span>
		<span class="n">DAC_copy</span><span class="o">=</span><span class="n">DAC</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">normed</span><span class="o">=</span><span class="p">(</span><span class="n">DAC</span><span class="o">/</span><span class="n">DAC</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DAC_copy</span><span class="p">):</span>
			<span class="n">DAC_copy</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">DAC_copy</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">*</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>	
			<span class="n">DAC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
			<span class="n">normed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
			<span class="n">DAC_copy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
			<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="n">normed</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
			<span class="n">normed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>			
			<span class="n">DAC_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
			<span class="n">DAC_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>	
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">scattercut</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
						<span class="n">normed</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
						<span class="n">DAC_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
						<span class="n">normed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>			
						<span class="n">DAC_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>	
					<span class="k">else</span><span class="p">:</span>
						<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
						<span class="n">normed</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>			
						<span class="n">DAC_copy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>	
			<span class="k">except</span><span class="p">:</span>
				<span class="n">DAC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1b</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
				<span class="n">normed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1a</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>
				<span class="n">DAC_copy</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">))</span>	
		
		<span class="k">if</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">]:</span>
			<span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;decay </span><span class="si">%i</span><span class="s1">: </span><span class="si">%.3g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">baseunit</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">times</span><span class="p">)]</span>
			<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;background&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="s1">&#39;Non Decaying&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span><span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Non Decaying&#39;</span><span class="p">)</span>
			<span class="n">ax1a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1b</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1c</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
		<span class="k">elif</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;exp&#39;</span><span class="p">]:</span>
			<span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;species </span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)]</span>
			<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
				<span class="k">if</span> <span class="s1">&#39;Non Decaying&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
					<span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
					<span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;Non Decaying&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
					<span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
			<span class="n">ax1a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1b</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1c</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
			<span class="n">ax1a</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1b</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
			<span class="n">ax1c</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">))</span>
		<span class="c1">#ax1c.legend(time_string,title=&#39;Model: {}&#39;.format(mod))</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax1a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">ax1a</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax1b</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span><span class="n">ax1b</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax1c</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span><span class="n">ax1c</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
		<span class="n">ax1a</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1a</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">ax1b</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1b</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">ax1c</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1b</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">ax1a</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">ax1b</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">ax1c</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">ax1a</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;intensity norm.&#39;</span><span class="p">)</span>
		<span class="n">ax1b</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;intensity in arb. units&#39;</span><span class="p">)</span>
		<span class="n">ax1c</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;intensity*max(c) in arb. units&#39;</span><span class="p">)</span>
		<span class="n">fig1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span>  <span class="c1">#-------plot sum_sum------------</span>
		<span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
		<span class="n">ax2</span><span class="o">=</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
		<span class="n">dat</span> <span class="o">=</span> <span class="p">[</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)]</span>
		<span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">dat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">dat_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;measured&#39;</span><span class="p">,</span><span class="s1">&#39;calculated&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
		<span class="n">dat_styles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">]</span>
		<span class="n">dat_cols</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
		
		<span class="n">limits</span> <span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="n">xlimits</span> <span class="o">=</span> <span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">x</span><span class="o">=</span><span class="n">dat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
			<span class="n">lower</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">upper</span><span class="o">=</span><span class="n">find_nearest_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
				<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">lower</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">upper</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>						
					<span class="k">else</span><span class="p">:</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">lower</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
						<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">upper</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">dat_cols</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">ignore_time_region_loc</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region_loc</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
							<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
								<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>			
					<span class="k">elif</span> <span class="n">k</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
							<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
								<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>	
					<span class="k">else</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
							<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
								<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>									
								<span class="k">else</span><span class="p">:</span>
									<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region_loc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>	
			<span class="k">except</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
					<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
						<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
							<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">_</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">dat_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">style</span> <span class="o">=</span> <span class="n">dat_styles</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">))</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linscale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linscale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		
		<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">10000</span><span class="p">]),</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlimits</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>	

		<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">10000</span><span class="p">]),</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">xlimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		
		<span class="c1">#draw a black line at zero</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="n">ax2a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="c1">#plot empty to get the labels right</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">stringen</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Model: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">title</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
				<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],</span><span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
				<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],</span><span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
				<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">],</span><span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
		<span class="n">x_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
		<span class="n">ax2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
		<span class="n">fig2</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#---plot single wavelength----------</span>
		<span class="n">fig3</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
		<span class="c1">#fig3,ax3 = plt.subplots(figsize = (8,4),dpi = 100)</span>
		<span class="n">_</span><span class="o">=</span><span class="n">plot1d</span><span class="p">(</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> 
					  <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> 
					  <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">text_in_legend</span> <span class="o">=</span> <span class="n">time_string</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> 
					  <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="n">_</span><span class="o">=</span><span class="n">plot1d</span><span class="p">(</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> 
					  <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span><span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> 
					  <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span> <span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span> <span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> 
					  <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">tight</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
				<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="n">ax3</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
		<span class="n">fig3</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span>		<span class="c1">#---plot at set time----------</span>
		<span class="n">fig4</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>	
		<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span><span class="n">subplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rel_time</span><span class="o">=</span><span class="n">rel_time</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">baseunit</span><span class="o">=</span><span class="n">baseunit</span><span class="p">,</span> 
					<span class="n">time_width_percent</span><span class="o">=</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">lines_are</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">scattercut</span><span class="o">=</span><span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> 
					<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="n">plot_second_as_energy</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rel_time</span><span class="o">=</span><span class="n">rel_time</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> 
						<span class="n">baseunit</span><span class="o">=</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">time_width_percent</span><span class="o">=</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">lines_are</span><span class="o">=</span><span class="s1">&#39;fitted&#39;</span><span class="p">,</span>
						<span class="n">color_offset</span><span class="o">=</span><span class="n">color_offset</span><span class="p">,</span> <span class="n">scattercut</span><span class="o">=</span><span class="n">scattercut</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> 
						<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="n">plot_second_as_energy</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bordercut</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">if</span> <span class="n">print_click_position</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">mouse_move</span><span class="p">)</span>
		<span class="n">fig4</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#---matrix with fit and error, as figures----------</span>
		<span class="n">fig5</span> <span class="o">=</span> <span class="n">plot2d_fit</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> 
							<span class="n">error_matrix_amplification</span> <span class="o">=</span> <span class="n">error_matrix_amplification</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
							<span class="n">use_images</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="p">,</span> 
							<span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> 
							<span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>	
		<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">5</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span>
		<span class="n">fig6</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
		<span class="n">G</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">ax6</span><span class="o">=</span><span class="p">[]</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]))</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">]))</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">2</span><span class="p">]))</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">3</span><span class="p">]))</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:]))</span>
		<span class="n">ax6</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig6</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span>
		<span class="n">n_colors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
			<span class="n">ax6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax6</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n_colors</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">),</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
				<span class="n">ax6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">baseunit</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="mf">1.1</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="n">ax6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="n">ax6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">title</span><span class="o">=</span><span class="n">f</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="n">title</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span>
			<span class="n">ncol</span><span class="o">=</span><span class="mi">2</span>
		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">handles</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">7</span><span class="p">:</span>
			<span class="n">ncol</span><span class="o">=</span><span class="mi">3</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ncol</span><span class="o">=</span><span class="mi">4</span>
		<span class="n">leg</span><span class="o">=</span><span class="n">ax6</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncol</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>   
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
			<span class="n">ax6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
		<span class="n">ax6</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;This factor represents the temporal evolution</span><span class="se">\n</span><span class="s1"> of the components in the fit.</span><span class="se">\n</span><span class="s1">This time dependent factor multiplied with the </span><span class="se">\n</span><span class="s1">spectral intensity from the SAS/DAS is re[</span><span class="se">\&quot;</span><span class="s1">AC</span><span class="se">\&quot;</span><span class="s1">]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">fig6</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">6</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#---matrix with fit and error, as contours----------</span>
		<span class="n">fig7</span> <span class="o">=</span> <span class="n">plot2d_fit</span><span class="p">(</span><span class="n">re</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> 
							<span class="n">error_matrix_amplification</span> <span class="o">=</span> <span class="n">error_matrix_amplification</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> 
							<span class="n">use_images</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span>  <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>								
	<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">save_figures_to_folder</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
		<span class="n">figure_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">filename</span><span class="o">=</span><span class="s1">&#39;test.fig&#39;</span>
		<span class="n">fi</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_DAC.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_SUM.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_SEL.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_SPEC.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="n">fig5</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_FIG_MAT.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="n">fig6</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_concentrations.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>	   
			<span class="n">fig7</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_CONTOUR.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>	</div>


<div class="viewcode-block" id="plot_raw"><a class="viewcode-back" href="../plot_func.html#plot_func.plot_raw">[docs]</a><span class="k">def</span> <span class="nf">plot_raw</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span>
			<span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="n">rel_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
			<span class="n">log_scale</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">save_figures_to_folder</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">print_click_position</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">,</span>
			<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;nm&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;This is the extended plot function, for convenient object based plotting see TA.Plot_RAW </span>
<span class="sd">	This function plotts of various RAW (non fitted) plots. Based on the DataFrame ds a number of </span>
<span class="sd">	cuts are created using the shaping parameters explained below.</span>
<span class="sd">	In all plots the RAW data is plotted as dots and interpolated with lines </span>
<span class="sd">	(using Savitzky-Golay window=5, order=3 interpolation). </span>

<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">		</span>
<span class="sd">	plotting : int or iterable (of integers), optional</span>
<span class="sd">		This parameter determines which figures are plotted </span>
<span class="sd">		the figures can be called separately with plotting = 1</span>
<span class="sd">		or with a list of plots (Default) e.g.plotting=range(4) calls plots 0,1,2,3</span>
<span class="sd">		The plots have the following numbers: </span>
<span class="sd">		</span>
<span class="sd">			0. Matrix</span>
<span class="sd">			1. Kinetics</span>
<span class="sd">			2. Spectra</span>
<span class="sd">			3. SVD </span>
<span class="sd">		</span>
<span class="sd">	title : None or str</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; </span>
<span class="sd">		</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">		</span>
<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">	</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &quot;ps&quot;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">		</span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>
<span class="sd">	</span>
<span class="sd">	width : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm</span>
<span class="sd">		</span>
<span class="sd">	rel_wave : float or list (of floats), optional </span>
<span class="sd">		&quot;rel_wave&quot; and &quot;width&quot; (in the object called &quot;wavelength_bin&quot; work together for the creation </span>
<span class="sd">		of kinetic plots. When plotting kinetic spectra one line will be plotted for each entrance</span>
<span class="sd">		in the list/vector rel_wave. During object generation the vector np.arange(300,1000,100) </span>
<span class="sd">		is set as standard. Another typical using style would be to define a list of interesting </span>
<span class="sd">		wavelength at which a kinetic development is to be plotted. At each selected wavelength </span>
<span class="sd">		the data between wavelength+ta.wavelength_bin and wavelength-ta.wavelength_bin is averaged </span>
<span class="sd">		for each timepoint returned </span>
<span class="sd">		</span>
<span class="sd">	rel_time : float or list/vector (of floats), optional</span>
<span class="sd">		For each entry in rel_time a spectrum is plotted. If time_width_percent=0 (Default) the </span>
<span class="sd">		nearest measured timepoint is chosen. For other values see &quot;time_width_percent&quot;</span>
<span class="sd">		</span>
<span class="sd">	time_width_percent : float</span>
<span class="sd">		&quot;rel_time&quot; and &quot;time_width_percent&quot; work together for creating spectral plots at </span>
<span class="sd">		specific timepoints. For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">		If however e.g. time_width_percent=10 the region between the timepoint closest </span>
<span class="sd">		to the  1.1 x timepoint and 0.9 x timepoint is averaged and shown </span>
<span class="sd">		(and the legend adjusted accordingly). This is particularly useful for the densly</span>
<span class="sd">		sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">		timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">		but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">		This averaging is only applied for the plotting function and not for the fits.</span>
<span class="sd">		</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	time_bin : None or int, optional</span>
<span class="sd">		is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">		This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">		it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">		affects the kinetics is &quot;time_width_percent&quot;</span>
<span class="sd">		</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g. your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		 </span>
<span class="sd">	color_offset : int, optional</span>
<span class="sd">		At the (Default) 0 the colours are chose from the beginning, for a larger value Color_offset </span>
<span class="sd">		colors are skipped. Usually only used if multiple plots are created, and the data/or fit is</span>
<span class="sd">		only shown for some of them.</span>
<span class="sd">		 </span>
<span class="sd">	log_scale : bool, optional</span>
<span class="sd">		If True (Default), The 2D plots (Matrix) is plotted with a pseudo logarithmic intensity scale. </span>
<span class="sd">		This usually does not give good results unless the intensity scale is symmetric </span>
<span class="sd">		</span>
<span class="sd">	Scale_type : None or str</span>
<span class="sd">		is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">		&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.</span>
<span class="sd">		</span>
<span class="sd">	lintresh : float</span>
<span class="sd">		The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">		time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 0.3 </span>
<span class="sd">		</span>
<span class="sd">	times : None or int</span>
<span class="sd">		are the number of components to be used in the SVD (Default) is None (which is seen as 6)</span>
<span class="sd">		</span>
<span class="sd">	save_figures_to_folder : bool, optional</span>
<span class="sd">		(Default) is False, if True the Figures are automatically saved </span>
<span class="sd">		</span>
<span class="sd">	savetype : str or iterable (of str), optional </span>
<span class="sd">		matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">		typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;.  </span>
<span class="sd">		</span>
<span class="sd">	path : None, str or path object, optional</span>
<span class="sd">		This defines where the files are saved if the safe_figures_to_folder parameter is True, </span>
<span class="sd">		quite useful if a lot of data sets are to be printed fast. </span>
<span class="sd">		If a path is given, this is used. If a string like the (Default) &quot;result_figures&quot; is given, </span>
<span class="sd">		then a subfolder of this name will be used (an generated if necessary) </span>
<span class="sd">		relative to self.path. Use and empty string to use the self.path</span>
<span class="sd">		If set to None, the location of the plot_func will be used and</span>
<span class="sd">		a subfolder with title &quot;result_figures&quot; be generated here</span>
<span class="sd">		</span>
<span class="sd">	filename : str, optional</span>
<span class="sd">		offers to replace the base-name used for all plots (to e.g.~specify what sample was used). </span>
<span class="sd">		if (Default) None is used, the self.filename is used as a base name. The filename plays only a </span>
<span class="sd">		role during saving, as does the path and savetype</span>
<span class="sd">	</span>
<span class="sd">	print_click_position : bool, optional</span>
<span class="sd">		if True then the click position is printed for the spectral plots </span>
<span class="sd">		</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;We need something to plot!!!&#39;</span><span class="p">)</span>
															
	<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;result_figures&#39;</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>
	<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;standard.sia&#39;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plotting</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">plotting</span><span class="o">=</span><span class="p">[</span><span class="n">plotting</span><span class="p">]</span>
	<span class="n">debug</span><span class="o">=</span><span class="kc">False</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
	<span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#MAtrix</span>
		<span class="n">fig1</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">,</span> 
					<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> 
					<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="n">time_bin</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="n">log_scale</span><span class="p">,</span> 
					<span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">)</span>
		<span class="n">fig1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">debug</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotted Matrix&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#kinetics</span>
		<span class="n">fig2</span><span class="p">,</span><span class="n">ax2</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
		
		<span class="n">_</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span>
					<span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span> <span class="p">,</span>	  <span class="n">plot_type</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> 
					<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="n">_</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span>
					<span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="n">lintresh</span><span class="p">,</span> 
					<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span> <span class="p">)</span>
		<span class="k">if</span> <span class="n">debug</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotted kinetics&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span><span class="c1">#Spectra</span>
		<span class="n">fig3</span><span class="p">,</span><span class="n">ax3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>

		<span class="n">_</span> <span class="o">=</span> <span class="n">plot_time</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> 
						<span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
						<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>	  <span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
						<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
						<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">plot_second_as_energy</span><span class="p">:</span>
			<span class="n">_</span> <span class="o">=</span> <span class="n">plot_time</span><span class="p">(</span><span class="n">ds</span> <span class="p">,</span><span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> 
					<span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
					<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
					<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">_</span> <span class="o">=</span> <span class="n">plot_time</span><span class="p">(</span><span class="n">ds</span> <span class="p">,</span><span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> 
					<span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
					<span class="n">baseunit</span> <span class="o">=</span> <span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
					<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
					<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span> <span class="p">)</span>
		<span class="k">if</span> <span class="n">print_click_position</span><span class="p">:</span>
			<span class="n">plt</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="n">mouse_move</span><span class="p">)</span>
		<span class="n">fig3</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">debug</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotted Spectra&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">plotting</span><span class="p">:</span>		<span class="c1">#---plot at set time----------</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">fig4</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">ds</span> <span class="p">,</span>  <span class="n">times</span> <span class="o">=</span> <span class="n">times</span> <span class="p">,</span>  <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span> <span class="p">,</span>  <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span> <span class="p">,</span>  
					<span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span> <span class="p">,</span>  <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span>
					<span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
											  
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVD failed with:&quot;</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">debug</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotted SVD&#39;</span><span class="p">)</span>
	<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">save_figures_to_folder</span><span class="p">:</span>
		<span class="n">fi</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_RAW_MAT.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
			   
			<span class="n">fig2</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_RAW_SEL.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
			   
			<span class="n">fig3</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_RAW_SPEK.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
			   
			<span class="n">fig4</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_RAW_SVD.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span><span class="n">savetype</span><span class="p">)),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
			   
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span></div>


<div class="viewcode-block" id="plot_time"><a class="viewcode-back" href="../plot_func.html#plot_func.plot_time">[docs]</a><span class="k">def</span> <span class="nf">plot_time</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text_in_legend</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> 
			<span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
			<span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">standard_map</span><span class="p">,</span> 
			<span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;nm&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;Function to create plots at a certain time. In general you give under rel_time a </span>
<span class="sd">		list of times at which yu do want to plot the time width percentage means that </span>
<span class="sd">		this function integrates ewverything plus minus 10% at this time. lines_are is a </span>
<span class="sd">		switch that regulates what is plotted. data plots the data only, </span>
<span class="sd">		smoothed plots the data and a smoothed version of the data, fitted plots only the fit. </span>
<span class="sd">		the subplot switch is for using this to plot e.g. multiple different datasets.</span>
<span class="sd">		</span>
<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	ax : None or matplotlib axis object, optional</span>
<span class="sd">		if None (Default), a figure and axis will be generated for the plot, if axis is given the plot will </span>
<span class="sd">		placed in there.</span>
<span class="sd">	</span>
<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">	</span>
<span class="sd">	rel_time : float or list/vector (of floats), optional</span>
<span class="sd">		For each entry in rel_time a spectrum is plotted. If time_width_percent=0 (Default) the </span>
<span class="sd">		nearest measured timepoint is chosen. For other values see &#39;time_width_percent&#39;</span>
<span class="sd">	</span>
<span class="sd">	time_width_percent : float</span>
<span class="sd">		&quot;rel_time&quot; and &quot;time_width_percent&quot; work together for creating spectral plots at </span>
<span class="sd">		specific timepoints. For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">		If however e.g. time_width_percent=10 the region between the timepoint closest </span>
<span class="sd">		to the  1.1 x timepoint and 0.9 x timepoint is averaged and shown </span>
<span class="sd">		(and the legend adjusted accordingly). This is particularly useful for the densly</span>
<span class="sd">		sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">		timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">		but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">		This averaging is only applied for the plotting function and not for the fits.</span>

<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.</span>
<span class="sd">		</span>
<span class="sd">	title : None or str, optional</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; </span>
<span class="sd">		</span>
<span class="sd">	linewidth : float, optional</span>
<span class="sd">		linewidth to be used for plotting</span>
<span class="sd">				</span>
<span class="sd">	text_in_legend : str, optional</span>
<span class="sd">		text to be used in legend before the actually lines and colours (set as heasder)</span>
<span class="sd">	</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">				</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>

<span class="sd">	subplot ; bool, optional</span>
<span class="sd">		False (Default) means this is a main plot in this axis! if True then this is the second plot in the axis </span>
<span class="sd">		and things like axis ticks should not be reset</span>
<span class="sd">		this also avoids adding the object to the legend</span>

<span class="sd">	color_offset : int, optional</span>
<span class="sd">		At the (Default) 0 the colours are chose from the beginning, for a larger value Color_offset </span>
<span class="sd">		colors are skipped. Usually only used if multiple plots are created, and the data/or fit is</span>
<span class="sd">		only shown for some of them.</span>
<span class="sd">		 		</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">				</span>
<span class="sd">	plot_second_as_energy : bool, optional</span>
<span class="sd">		For (Default) True a second x-axis is plotted  with &quot;eV&quot; as unit</span>
<span class="sd">	</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		 </span>

<span class="sd">		&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rel_time</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">rel_time</span><span class="o">=</span><span class="p">[</span><span class="n">rel_time</span><span class="p">]</span>
	<span class="n">rel_time</span><span class="o">=</span><span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_time</span> <span class="k">if</span> <span class="n">a</span><span class="o">&lt;</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
	
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
		<span class="n">colors</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">color_offset</span><span class="p">:]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">colors</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">color_offset</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">+</span><span class="n">color_offset</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">=</span><span class="n">ax</span>
	<span class="n">ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> 
				<span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">drop_scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;smoothed&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span><span class="c1">#handling single scattercut</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span><span class="c1">#handling multiple scattercuts</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">scattercut</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;printing the smoothed scatter interpolation created an error, using default&#39;</span><span class="p">)</span>
				<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span>
			<span class="n">leg</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;lines = smoothed&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
	<span class="k">elif</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">subplot</span><span class="p">:</span>
			<span class="n">ax1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax1</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">)</span>
			<span class="n">leg</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
	<span class="k">elif</span> <span class="s1">&#39;fitted&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">scattercut</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span><span class="n">leg</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;lines = fit&#39;</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">text_in_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stringen</span><span class="o">=</span><span class="n">leg</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
			<span class="n">texten</span><span class="o">=</span><span class="n">text_in_legend</span>
			<span class="n">leg</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">texten</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span><span class="n">stringen</span><span class="p">)</span>

	<span class="k">else</span><span class="p">:</span><span class="c1">#for multiple plotting</span>
		<span class="k">return</span> <span class="n">ax1</span>
	<span class="k">if</span> <span class="n">bordercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">bordercut</span><span class="p">)</span>	
	<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">subplot</span><span class="p">)</span> <span class="ow">and</span> <span class="n">plot_second_as_energy</span><span class="p">:</span>
		<span class="n">ax2</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">())</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">())</span>
		<span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%.2f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">*</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">electron_volt</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax2</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()]</span>
		<span class="n">dump</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
		<span class="n">dump</span><span class="o">=</span><span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Energy in eV&#39;</span><span class="p">)</span>

	<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span>	
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>		
			<span class="k">try</span><span class="p">:</span>
				<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
		<span class="c1">#ax1.xaxis.set_minor_locator(AutoMinorLocator(6))</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">intensity_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="c1">#lets have an lazy option</span>
				<span class="n">intensity_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">])</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">fig</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ax1</span></div>


<div class="viewcode-block" id="plot1d"><a class="viewcode-back" href="../plot_func.html#plot_func.plot1d">[docs]</a><span class="k">def</span> <span class="nf">plot1d</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
			<span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">standard_map</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span>
			<span class="n">lintresh</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">text_in_legend</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
			<span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;nm&#39;</span><span class="p">):</span>																			  
	<span class="sd">&#39;&#39;&#39;Plots the single line kinetic for specific wavelength given with the parameter wavelength.</span>

<span class="sd">	Parameters</span>
<span class="sd">	---------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	wavelength : float or list (of floats)</span>
<span class="sd">		wavelength is in the object called &quot;rel_wave&quot; and works with &quot;width&quot; </span>
<span class="sd">		(in the object called &quot;wavelength_bin&quot;) together for the creation </span>
<span class="sd">		of kinetic plots. When plotting kinetic spectra one line will be plotted for each entrance</span>
<span class="sd">		in the list/vector rel_wave. During object generation the vector np.arange(300,1000,100) </span>
<span class="sd">		is set as standard. Another typical using style would be to define a list of interesting </span>
<span class="sd">		wavelength at which a kinetic development is to be plotted. At each selected wavelength </span>
<span class="sd">		the data between wavelength+ta.wavelength_bin and wavelength-ta.wavelength_bin is averaged </span>
<span class="sd">		for each timepoint returned </span>
<span class="sd">		</span>
<span class="sd">	data_type : str</span>
<span class="sd">		this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">		(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">		</span>
<span class="sd">	width : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm		</span>
<span class="sd">		</span>
<span class="sd">	ax : None, matplotlib axis object optional</span>
<span class="sd">		If None (Default) a new plot is is created and a new axis, otherwise ax needs to be Matplotlib Axis</span>
<span class="sd">	</span>
<span class="sd">	subplot : bool, optional</span>
<span class="sd">		If False (Default) axis labels and such are set. If True, we plot into the same axis and </span>
<span class="sd">		do not set labels</span>
<span class="sd">	</span>
<span class="sd">	text_in_legend : None, str, optional</span>
<span class="sd">		extra text to be put into the legend (above the lines)</span>
<span class="sd">	</span>
<span class="sd">	lines_are : str, optional</span>
<span class="sd">		Depending on this parameter the plots contain:</span>
<span class="sd">		&#39;smoothed&#39; = data lines of golay smoothed data (Default) </span>
<span class="sd">		&#39;data&#39; = dots are data, </span>
<span class="sd">		&#39;fitted&#39; = not data, just lines shown</span>
<span class="sd">		</span>
<span class="sd">	title : None or str</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string</span>
<span class="sd">		</span>
<span class="sd">	linewidth : float, optional</span>
<span class="sd">		linewidht to be used for plotting</span>
<span class="sd">		</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">		</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">		</span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		 </span>
<span class="sd">	color_offset : int, optional</span>
<span class="sd">		At the (Default) 0 the colours are chose from the beginning, for a larger value Color_offset </span>
<span class="sd">		colors are skipped. Usually only used if multiple plots are created, and the data/or fit is</span>
<span class="sd">		only shown for some of them.</span>
<span class="sd">		</span>
<span class="sd">	plot_type : None or str</span>
<span class="sd">		is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">		&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.</span>
<span class="sd">		</span>
<span class="sd">	lintresh : float</span>
<span class="sd">		The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">		time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 0.3 </span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;input format wrong&quot;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">fig</span><span class="p">,</span><span class="n">ax1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">=</span><span class="n">ax</span>
	<span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">wavelength</span> <span class="o">=</span> <span class="p">[</span><span class="n">wavelength</span><span class="p">]</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
		<span class="n">colors</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">color_offset</span><span class="p">:]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">color_offset</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)</span><span class="o">+</span><span class="n">color_offset</span><span class="p">),</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
	<span class="n">ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">wavelength</span><span class="p">,</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
				<span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">,</span> <span class="n">drop_ignore</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
	<span class="k">if</span> <span class="s1">&#39;smoothed&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
			<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">ignore_time_region</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:],</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
						<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">smoothed</span><span class="o">=</span><span class="n">Frame_golay</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">window</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
				<span class="n">smoothed</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		
	<span class="k">elif</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">subplot</span><span class="p">:</span><span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>	   <span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
	<span class="k">elif</span> <span class="s1">&#39;fitted&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">ignore_time_region</span><span class="o">=</span><span class="n">flatten</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore_time_region</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
	<span class="c1">#Legend</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span>
		<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
		<span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)]</span>
		<span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">wavelength</span><span class="p">)]</span>
		<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">entry</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
			<span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">entry</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">units</span>
		<span class="k">if</span> <span class="s1">&#39;smoothed&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span><span class="n">leg</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> width, lines=smoothed&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">units</span><span class="p">),</span><span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">elif</span> <span class="s1">&#39;data&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span>  <span class="n">leg</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> width&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">units</span><span class="p">)</span>				  <span class="p">,</span><span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">elif</span> <span class="s1">&#39;fitted&#39;</span> <span class="ow">in</span> <span class="n">lines_are</span><span class="p">:</span><span class="n">leg</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> width, lines=fit&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">units</span><span class="p">)</span>	  <span class="p">,</span><span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">columnspacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">text_in_legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">stringen</span><span class="o">=</span><span class="n">leg</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span><span class="o">.</span><span class="n">get_text</span><span class="p">()</span>
			<span class="n">texten</span><span class="o">=</span><span class="n">text_in_legend</span>
			<span class="n">leg</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">texten</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span><span class="n">stringen</span><span class="p">)</span>
	<span class="n">x</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
	<span class="c1">#limits and ticks</span>
	<span class="k">if</span> <span class="n">timelimits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">timelimits</span><span class="o">=</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
	<span class="k">if</span> <span class="s2">&quot;symlog&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>
		<span class="n">lintresh</span><span class="o">=</span><span class="n">lintresh</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linthresh</span><span class="o">=</span><span class="n">lintresh</span><span class="p">,</span><span class="n">subs</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span><span class="n">linscale</span><span class="o">=</span><span class="n">lintresh</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">lintresh</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">:</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,),[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)))</span>
			<span class="k">elif</span> <span class="n">lintresh</span><span class="o">&gt;=</span><span class="mf">0.3</span><span class="p">:</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,),[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.3</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)))</span>
			<span class="k">elif</span> <span class="n">lintresh</span><span class="o">&gt;=</span><span class="mf">0.1</span><span class="p">:</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,),[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.1</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,),[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">)))</span>
			<span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">[</span><span class="n">ticks</span><span class="o">&gt;</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
			<span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">[</span><span class="n">ticks</span><span class="o">&lt;</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
	<span class="k">elif</span> <span class="s2">&quot;log&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>
		<span class="n">lower_time</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lower_time</span><span class="p">,</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
	<span class="k">elif</span> <span class="s2">&quot;lin&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

	<span class="k">if</span> <span class="n">intensity_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="c1">#lets have an lazy option</span>
			<span class="n">intensity_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">])</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">)</span>			
	<span class="k">if</span> <span class="ow">not</span> <span class="n">subplot</span><span class="p">:</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">title</span><span class="p">:</span>		
				<span class="k">try</span><span class="p">:</span>
					<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
		<span class="k">if</span> <span class="s2">&quot;symlog&quot;</span> <span class="ow">in</span> <span class="n">plot_type</span><span class="p">:</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">lintresh</span><span class="p">,</span><span class="n">lintresh</span><span class="p">],</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">lintresh</span><span class="p">,</span><span class="o">-</span><span class="n">lintresh</span><span class="p">],</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">(),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
			
	<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">data_type</span><span class="p">)</span>		
	<span class="c1">#ax1.set_xlabel(&#39;time in %s&#39;%baseunit)</span>
	<span class="c1">#ax1.set_ylabel(&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;)</span>
	<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.2g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
	<span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">fig</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">ax1</span></div>


<div class="viewcode-block" id="SVD"><a class="viewcode-back" href="../plot_func.html#plot_func.SVD">[docs]</a><span class="k">def</span> <span class="nf">SVD</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5e-1</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
		<span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
		<span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="s1">&#39;differential Absorption in $\mathregular{\Delta OD}$&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;This function calculates the SVD and plots an overview.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	------------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	times : None or int</span>
<span class="sd">		are the number of components to be used in the SVD (Default) is None (which is seen as 6)</span>
<span class="sd">	</span>
<span class="sd">	plotting : bool</span>
<span class="sd">		if True (Default) the functions plots the SVD, if False it returns the vectors</span>
<span class="sd">	</span>
<span class="sd">	title : None or str</span>
<span class="sd">		title to be used on top of each plot</span>
<span class="sd">		The (Default) None triggers  self.filename to be used. Setting a specific title as string will</span>
<span class="sd">		be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; </span>
<span class="sd">		</span>
<span class="sd">	baseunit : str</span>
<span class="sd">		baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">		can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">		During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">		I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">		this unit.</span>
<span class="sd">		</span>
<span class="sd">	timelimits : None or list (of 2 floats), optional</span>
<span class="sd">		cut times at the low and high time limit. (Default) [5e-1 , 150] uses the limits of measurement</span>
<span class="sd">		Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">		time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">		the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		</span>
<span class="sd">	bordercut : None or iterable (with two floats), optional</span>
<span class="sd">		cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">		uses the limits of measurement </span>
<span class="sd">		</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared. (Default = 10)</span>
<span class="sd">	</span>
<span class="sd">	wavelength_bin : float, optional</span>
<span class="sd">		the width used in kinetics, see below (Default) 10nm</span>
<span class="sd">		</span>
<span class="sd">	ignore_time_region : None or list (of two floats or of lists), optional</span>
<span class="sd">		cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">		The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">		plots) </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit],</span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">	</span>
<span class="sd">	time_bin : None or int, optional</span>
<span class="sd">		is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">		This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">		it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">		affects the kinetics is &#39;time_width_percent&#39;	</span>
<span class="sd">		</span>
<span class="sd">	cmap : None or matplotlib color map, optional</span>
<span class="sd">		is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">		None (Default) then the self.cmap is used.</span>
<span class="sd">		As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">		available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">		visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">		or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">		See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">		selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">		self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">		with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">		else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">		I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">		are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">		cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">		contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">		the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">		(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">		(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">		If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">	</span>
<span class="sd">	&#39;&#39;&#39;</span>
	
	<span class="k">if</span> <span class="n">times</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="n">max_order</span><span class="o">=</span><span class="mi">6</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">max_order</span><span class="o">=</span><span class="n">times</span>
	<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="n">standard_map</span>
	<span class="n">colors</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">max_order</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
	<span class="n">ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">bordercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> 
				<span class="n">wavelength_bin</span> <span class="o">=</span> <span class="n">wavelength_bin</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="n">time_bin</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">ignore_time_region</span><span class="p">)</span>
	<span class="n">U</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">plotting</span><span class="p">:</span>
		<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
		<span class="n">G</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">2</span><span class="p">])</span>
		<span class="n">ax2</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span>
		<span class="n">ax3</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:])</span>
		
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.titlesize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Component</span><span class="se">\n</span><span class="s2">strength&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.titlesize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
			<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Spectral component&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.titlesize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
			<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Temporal development</span><span class="se">\n</span><span class="s2">of spectral component&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.titlesize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
		<span class="n">s</span><span class="o">/=</span><span class="n">s</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">max_order</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">s</span><span class="p">[:</span><span class="n">max_order</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;SVD order&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Singular values norm.&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_order</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">max_order</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">max_order</span><span class="p">,</span><span class="mi">6</span><span class="p">)])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="nb">round</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">max_order</span><span class="p">,</span><span class="mi">5</span><span class="p">)])</span>
		<span class="n">V2</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">))</span>
		<span class="n">U2</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">))</span>
		<span class="n">U2</span><span class="o">=</span><span class="n">U2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">)</span>
		<span class="n">V2</span><span class="o">=</span><span class="n">V2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="o">-</span><span class="n">s</span><span class="p">)</span>
		<span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SVD vector </span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_order</span><span class="p">)]</span>
		<span class="n">U2</span><span class="o">=</span><span class="n">U2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="n">max_order</span><span class="p">]</span>
		<span class="n">U2</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">names</span>
		<span class="n">V2</span><span class="o">=</span><span class="n">V2</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,:</span><span class="n">max_order</span><span class="p">]</span>	
		<span class="n">V2</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">names</span>
		<span class="n">V2</span><span class="o">/=</span><span class="n">V2</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="n">V2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity norm.&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">U2</span><span class="o">/=</span><span class="n">U2</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
		<span class="n">U2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">)</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Intensity norm.&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">lims</span><span class="o">=</span><span class="n">V2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">lims</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">lims</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="c1">#ax2.set_xticks(np.linspace(round(lims.min(),-2),round(lims.max()-2),5))</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%.4g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

		<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
		<span class="n">tims</span><span class="o">=</span><span class="n">U2</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">max</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="n">tims</span><span class="o">.</span><span class="n">min</span><span class="p">()]),</span><span class="n">tims</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
		<span class="c1">#ax3.set_xticks(np.logspace(-1,2,round(np.log())))</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%1g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
		<span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		<span class="n">ax3</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">labelspacing</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">borderpad</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">handlelength</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
		
		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">return</span> <span class="n">fig</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">U</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">V2</span><span class="p">,</span><span class="n">ds</span></div>

<div class="viewcode-block" id="Species_Spectra"><a class="viewcode-back" href="../plot_func.html#plot_func.Species_Spectra">[docs]</a><span class="k">def</span> <span class="nf">Species_Spectra</span><span class="p">(</span><span class="n">ta</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">conc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">das</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;useful help function that returns a dictionary that has DataFrame as entries and the names of the </span>
<span class="sd">	components as keys</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	ta : plot_func.TA object, optional </span>
<span class="sd">		This object should contain a successful fit. The function will cycle through the fitted species </span>
<span class="sd">		and return the matrix that is formed from the dynamics and the species associated spectrum</span>
<span class="sd">		If this given, then &quot;conc&quot; and &quot;das&quot; are ignored. We cycle through the columns of the concentration </span>
<span class="sd">		and take the same column from the das Frame. </span>
<span class="sd">	</span>
<span class="sd">	conc : DataFrame, optional</span>
<span class="sd">		Is read only if ta_object is None. This should contain the concentration matrix with the species as</span>
<span class="sd">		as columns</span>
<span class="sd">		</span>
<span class="sd">	das : DataFrame, optional</span>
<span class="sd">		This should contain the spectra of the species with one column per spectrum. The position of the columns </span>
<span class="sd">		must match the columns in the conc (at least this is what is assumed)</span>
<span class="sd">		</span>
<span class="sd">	Examples</span>
<span class="sd">	---------</span>
<span class="sd">	dicten=Species_Spectra(ta)</span>
<span class="sd">	</span>
<span class="sd">	&#39;&#39;&#39;</span>
	<span class="k">if</span> <span class="n">ta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">time</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
			<span class="n">WL</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
			<span class="n">conc</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
			<span class="n">das</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the TA object must contain a successful fit&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">re</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">False</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">conc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">das</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;If the ta object is None, then we need both the conc and the das&#39;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">False</span>			
	<span class="n">results</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conc</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
		<span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">conc</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">das</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
		<span class="n">C</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">WL</span><span class="p">)</span>
		<span class="n">results</span><span class="p">[</span><span class="n">conc</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">C</span>
	<span class="k">return</span> <span class="n">results</span></div>

<span class="k">def</span> <span class="nf">Fix_Chirp</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">save_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="mf">5e-3</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> 
			<span class="n">shown_window</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fitcoeff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_points</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> 
			<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">prism</span><span class="p">):</span>										
	<span class="sd">&#39;&#39;&#39;Manual selecting polynom for chirp. 	This function is opening </span>
<span class="sd">		a plot and allows the user to select a number of points, which are then </span>
<span class="sd">		approximated with a 4th order polynomial and finally to select a point </span>
<span class="sd">		that is declared as time zero. The observed window as well as the intensities </span>
<span class="sd">		and the colour map can be chosen to enable a good correction. Here a fast </span>
<span class="sd">		iterating colour scheme such as &quot;prism&quot; is often a good choice. In all of the </span>
<span class="sd">		selections a left click selects, a right click removes the last point and </span>
<span class="sd">		a middle click (sometime appreviated by clicking left and right together) </span>
<span class="sd">		finishes the selection. If no middle click exists, the process</span>
<span class="sd">		automatically ends after max_points (40 preset).</span>
<span class="sd">		Many of the parameters are from the raw plotting part</span>
<span class="sd">		</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be plotted. It is copied and sliced into the</span>
<span class="sd">		regions defined. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	save_file : None or str, optional</span>
<span class="sd">		   If a raw file was read(e.g. &quot;data.SIA&quot;) and the chirp correction was</span>
<span class="sd">		   completed, a file with the attached word &quot;chirp&quot; is created and</span>
<span class="sd">		   stored in the same location. (&quot;data_chirp.dat&quot;) This file contains</span>
<span class="sd">		   the 5 values of the chirp correction. By selecting such a file</span>
<span class="sd">		   (e.g.from another raw data) a specific chirp is applied. If a</span>
<span class="sd">		   specific name is given with **chirp_file** (and optional **path**)</span>
<span class="sd">		   then this file is used.\n</span>
<span class="sd">		   GUI\n</span>
<span class="sd">		   The word *&#39;gui&#39;* can be used instead of a filename to open a gui that</span>
<span class="sd">		   allows the selection of a chrip file</span>
<span class="sd">	</span>
<span class="sd">	scattercut : None or iterable (of floats or other iterable, always pairs!), optional</span>
<span class="sd">		intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">		happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">		Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">		use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">	</span>
<span class="sd">	intensity_range : None, float or list [of two floats]</span>
<span class="sd">		intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">		For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">		This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">		maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">		scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">		intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]	</span>
<span class="sd">	</span>
<span class="sd">	wave_nm_bin : None or float, optional</span>
<span class="sd">		rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">		If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">		and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">		the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">		This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">		like a prism in the infrared.	</span>
<span class="sd">		</span>
<span class="sd">	shown_window : list (with two floats), optional</span>
<span class="sd">		Defines the window that is shown during chirp correction. If the t=0 is not visible, adjust this parameter</span>
<span class="sd">		to suit the experiment. If problems arise, I recomment to use Plot_Raw to check where t=0 is located</span>
<span class="sd">		</span>
<span class="sd">	filename : str, optional</span>
<span class="sd">		name of the original file, that will be used to save the results later (with attached &quot;_chirp&quot;)	</span>
<span class="sd">		</span>
<span class="sd">	path : str or path object (optional)</span>
<span class="sd">		if path is a string without the operation system dependent separator, it is treated as a relative path, </span>
<span class="sd">		e.g. data will look from the working directory in the sub director data. Otherwise this has to be a </span>
<span class="sd">		full path in either strong or path object form.</span>
<span class="sd">			</span>
<span class="sd">	fitcoeff : list or vector (5 floats), optional</span>
<span class="sd">		One can give a vector/list with 5 numbers representing the parameter</span>
<span class="sd">		of a 4th order polynomial (in the order</span>
<span class="sd">		:math:`(a4*x^4 + a3*x^3+a2*x^2+a1*x1+a0)`. The chirp parameter are</span>
<span class="sd">		stored in ta.fitcoeff and can thus be used in other TA objects. This</span>
<span class="sd">		vector is also stored with the file and automatically applied during</span>
<span class="sd">		re-loading of a hdf5-object</span>

<span class="sd">	max_points : int, optional</span>
<span class="sd">		Default = 40 max numbers of points to use in Gui selection. Useful option in case no middle mouse button</span>
<span class="sd">		is available. (e.g. touchpad)</span>
<span class="sd">		</span>
<span class="sd">	cmap : matplotlib colourmap, optional</span>
<span class="sd">		Colourmap to be used for the chirp correction. While there is a large selection here I recommend to choose</span>
<span class="sd">		a different map than is used for the normal 2d plotting.\n</span>
<span class="sd">		cm.prism (Default) has proofen to be very usefull</span>
<span class="sd">	</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span> 
	<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">fitcoeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#we loaded a previous project this is a dublication, but I&#39;m currently to lazy to make this tighter</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span><span class="n">fitcoeff</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fitcoeff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span><span class="c1">#old style parameter</span>
			<span class="n">fitcoeff</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="n">fitcoeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
			<span class="n">fitcoeff</span><span class="o">=</span><span class="n">fitcoeff</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
		<span class="n">wl</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the wavelength</span>
		<span class="n">time</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the time</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
			<span class="n">correcttimeval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span> <span class="n">wl</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">f</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">((</span><span class="n">time</span><span class="o">-</span><span class="n">correcttimeval</span><span class="p">),</span> <span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">fixed_wave</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
			<span class="n">ds</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixed_wave</span>
		<span class="k">return</span> <span class="n">ds</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">save_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1">#lets start by choosing a good intensity</span>
			<span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
				<span class="n">maxim</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity_range</span><span class="p">)))</span>
				<span class="n">intensity_range</span><span class="o">=</span><span class="n">maxim</span>
			<span class="k">elif</span> <span class="n">intensity_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">intensity_range</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
			<span class="n">intensities</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">6.</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">1.</span><span class="p">))</span><span class="o">*</span><span class="n">intensity_range</span>
			<span class="n">window_difference</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shown_window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">shown_window</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mf">0.1</span>
			<span class="n">timelimits</span><span class="o">=</span><span class="n">shown_window</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="o">-</span><span class="n">window_difference</span><span class="p">,</span><span class="n">window_difference</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">repeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">timelimits</span> <span class="o">=</span> <span class="n">timelimits</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;select intensity where we can work,  if happy,  choose confirm or abort&#39;</span><span class="p">,</span> 
							<span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="n">w</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">shown_window</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">w</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intensities</span><span class="p">):</span>
					<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">w</span><span class="o">/</span><span class="mf">10.</span><span class="p">,</span><span class="n">shown_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;</span><span class="si">%.1g</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">6.</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">1.</span><span class="p">))[</span><span class="n">i</span><span class="p">],</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Accept&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mf">3.</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mf">3.</span><span class="o">/</span><span class="mf">4.</span><span class="p">,</span><span class="n">timelimits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Cancel all&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
				<span class="n">choice</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
				<span class="n">factor</span><span class="o">=</span><span class="nb">int</span><span class="p">((</span><span class="n">choice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mf">10.</span><span class="p">))</span>
				<span class="k">if</span> <span class="n">choice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">shown_window</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
					<span class="n">intensity_range</span><span class="o">=</span><span class="n">intensities</span><span class="p">[</span><span class="n">factor</span><span class="p">]</span>
					<span class="nb">print</span><span class="p">((</span><span class="mi">2</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">6.</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">1.</span><span class="p">))[</span><span class="n">factor</span><span class="p">])</span>
					<span class="n">intensity_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">intensity_range</span><span class="p">,</span><span class="n">intensity_range</span><span class="p">]</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">continue</span>		
				<span class="k">elif</span> <span class="n">choice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">shown_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">:</span><span class="c1">#we choice to finish the choices</span>
					<span class="k">if</span> <span class="n">choice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span><span class="c1">#</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accept&#39;</span><span class="p">)</span>
						<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
						<span class="k">break</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
						<span class="k">return</span> <span class="kc">False</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;click better please&#39;</span><span class="p">)</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">continue</span>
			<span class="k">for</span> <span class="n">repeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">timelimits</span> <span class="o">=</span> <span class="n">shown_window</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;select points,  rightclick  =  remove last,  </span><span class="se">\n</span><span class="s1"> middle click (or both at once finishes &#39;</span><span class="p">,</span> 
							<span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="n">polypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">max_points</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">show_clicks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mouse_add</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mouse_pop</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">mouse_stop</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">timelimits</span> <span class="o">=</span> <span class="n">shown_window</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;like it? </span><span class="si">%i</span><span class="s1"> more attempts&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">9</span><span class="o">-</span><span class="n">repeat</span><span class="p">),</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
							<span class="n">plot_type</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="c1">#Fit a polynomial of the form p(x) = p[2] + p[1] + p[0]</span>
				<span class="n">fitcoeff</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">polypts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">polypts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				<span class="n">correcttimeval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">correcttimeval</span><span class="p">)</span>
				 
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span><span class="s1">&#39;Save&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
								   
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span><span class="s1">&#39;Redo&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
				<span class="n">satisfied</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">satisfied</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">)</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">break</span>
				<span class="k">elif</span> <span class="n">repeat</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">:</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">continue</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">return</span> <span class="kc">False</span>
			<span class="c1">#stdev = sum(residuals**2)/8</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">fitcoeff</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
			<span class="n">fitcoeff</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fitcoeff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span><span class="c1">#old style params</span>
				<span class="n">fitcoeff</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-=</span><span class="n">fitcoeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">fitcoeff</span><span class="o">=</span><span class="n">fitcoeff</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
		<span class="n">time</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the time</span>
		<span class="n">ds_new</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span><span class="n">xp</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">fp</span><span class="o">=</span><span class="n">x</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
				  
		<span class="k">if</span> <span class="n">save_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1">#finding where zero time is</span>
			<span class="k">for</span> <span class="n">repeat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">lintresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;uncorrected select new zero&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">fittingto</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">fittingto</span><span class="p">)</span>
				<span class="n">fitcoeff</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+=</span><span class="n">fittingto</span>
				<span class="n">ds_new</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">time</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span><span class="n">xp</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">fp</span><span class="o">=</span><span class="n">x</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
							
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">plot2d</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">lintresh</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;corrected,  please select&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">use_colorbar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;black&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">w</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
				 
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span><span class="s1">&#39;Save&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]),</span><span class="n">w</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.05</span><span class="p">,</span><span class="s1">&#39;Redo&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
				<span class="n">satisfied</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ginput</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">satisfied</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;accepted&#39;</span><span class="p">)</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">break</span>
				<span class="k">elif</span> <span class="n">repeat</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">:</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">continue</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
					<span class="k">return</span> <span class="kc">False</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">f</span><span class="o">=</span><span class="s1">&#39;chirp.dat&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">f</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
				<span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="o">+</span><span class="s1">&#39;_chirp&#39;</span> <span class="o">+</span> <span class="s1">&#39;.dat&#39;</span>
			<span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
					<span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">))))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">f</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">opened_file</span><span class="p">:</span>
					<span class="n">opened_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">))))</span>	
		<span class="k">return</span> <span class="n">ds_new</span>


<div class="viewcode-block" id="build_c"><a class="viewcode-back" href="../plot_func.html#plot_func.build_c">[docs]</a><span class="k">def</span> <span class="nf">build_c</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="s1">&#39;paral&#39;</span><span class="p">,</span> <span class="n">pardf</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sub_steps</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">	Build concentration matrix after model the parameters are:</span>
<span class="sd">	resolution is the width of the rise time (at sigma 50% intensity) </span>
<span class="sd">	This function can also be used to create illustration dynamics.</span>
<span class="sd">	The parallel decays are created explicit, while the consecutive decays are </span>
<span class="sd">	created by sampling the populations at the times given in the first vector and</span>
<span class="sd">	evaluate the progression at a number of substeps defined bu sub_samples (10 by default) </span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	times : np.array</span>
<span class="sd">		array with the times at which the dataframe should be generated. In general the </span>
<span class="sd">		experimental times</span>
<span class="sd">	mod : str, optional</span>
<span class="sd">		this selects the model that is used to generate the concentrations.</span>
<span class="sd">		</span>
<span class="sd">			1. &#39;paral&#39; (Default) or &#39;exponential&#39; both are equivalent</span>
<span class="sd">			2. &#39;consecutive&#39; or &#39;full_consecutive&#39;</span>
<span class="sd">		</span>
<span class="sd">		In 2 the &#39;consecutive&#39; and &#39;full_consecutive&#39; are different in that for consecutive </span>
<span class="sd">		the optimization is done using &#39;exponential&#39; (as it shoudl give the same times)</span>
<span class="sd">		and then only in the last (final) iteration the &#39;full consecutive&#39; differential</span>
<span class="sd">		equation is used. This has significant speed advantages, but can lead to errors particularly</span>
<span class="sd">		for the very fast times.</span>
<span class="sd">	sub_step : int, optional</span>
<span class="sd">		defines how many times the iterative loop (used in consecutive only) is sampling the concentrations </span>
<span class="sd">		between the times given in &quot;times&quot;</span>
<span class="sd">	pardf : pd.DataFrame</span>
<span class="sd">		This dataframe must contain the parameter that are used for creating the dynamics</span>
<span class="sd">		the parameter must be named with the index.</span>
<span class="sd">		For the internal functions this must contain these keys:</span>
<span class="sd">		</span>
<span class="sd">			* &#39;t0&#39; = zero time, mandatory</span>
<span class="sd">			* &#39;resolution&#39; = instrument response function, mandatory</span>
<span class="sd">			* &#39;background&#39;,optional = if this keyword is present a flat constant background is created (=1 over the whole time)</span>
<span class="sd">			* &#39;infinite&#39;,optional = if this keyword is present a new non decaying component is formed with the last decay time.</span>
<span class="sd">			* &#39;k0,k1,...&#39; = with increasing integers are taken as decay times. te number of these components is used to determine how many shall be generated.</span>

<span class="sd">	Examples</span>
<span class="sd">	---------</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">choices</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;paral&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;consecutive&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;full_consecutive&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
	<span class="n">model</span><span class="o">=</span><span class="n">choices</span><span class="p">[</span><span class="n">mod</span><span class="p">]</span>
	<span class="n">param</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
	<span class="n">t0</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
	<span class="n">resolution</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="c1">#parallel</span>
		<span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">times</span><span class="o">-</span><span class="n">t0</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">param</span><span class="p">)</span>
		<span class="n">c</span><span class="p">[(</span><span class="n">times</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="n">c</span><span class="o">*=</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">rise</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span><span class="n">begin</span><span class="o">=</span><span class="n">t0</span><span class="p">),(</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
		<span class="n">c</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
		<span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
		<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
			<span class="n">c</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
			<span class="n">c</span><span class="p">[</span><span class="s1">&#39;infinite&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rise</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span><span class="n">begin</span><span class="o">=</span><span class="n">t0</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span><span class="c1">#consecutive decays</span>
		<span class="n">n_decays</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
		<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
			<span class="n">infinite</span><span class="o">=</span><span class="kc">True</span>
			<span class="n">n_decays</span><span class="o">+=</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">infinite</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">decays</span><span class="o">=</span><span class="n">param</span>
		<span class="n">c</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">),</span><span class="n">n_decays</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">g</span><span class="o">=</span><span class="n">gauss</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">resolution</span><span class="o">/</span><span class="n">FWHM</span><span class="p">,</span><span class="n">mu</span><span class="o">=</span><span class="n">t0</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)):</span>
			<span class="n">dc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_decays</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
			<span class="n">dt</span><span class="o">=</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">times</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">sub_steps</span><span class="p">)</span>
			<span class="n">c_temp</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sub_steps</span><span class="p">)):</span>
				<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_decays</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">l</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">infinite</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">l</span><span class="o">&lt;</span><span class="p">(</span><span class="n">n_decays</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
								<span class="n">dc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">dc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">dc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">infinite</span> <span class="ow">and</span> <span class="n">n_decays</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
							<span class="n">dc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">dc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">=</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">-</span><span class="n">decays</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">c_temp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
				<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
					<span class="n">c_temp</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([(</span><span class="n">c_temp</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">+</span><span class="n">dc</span><span class="p">[</span><span class="n">b</span><span class="p">]),</span><span class="mf">0.</span><span class="p">])</span>
			<span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span><span class="n">c_temp</span>
		<span class="n">c</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
		<span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;time&#39;</span>
		<span class="k">if</span> <span class="n">infinite</span><span class="p">:</span>
			<span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
			<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
			<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
				<span class="n">c</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
				<span class="n">c</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
	<span class="k">return</span> <span class="n">c</span></div>


<div class="viewcode-block" id="fill_int"><a class="viewcode-back" href="../plot_func.html#plot_func.fill_int">[docs]</a><span class="k">def</span> <span class="nf">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">baseunit</span><span class="o">=</span><span class="s1">&#39;ps&#39;</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;solving the intensity an equation_way, takes the target dataframe and the concentration frame </span>
<span class="sd">	prepares the matrixes(c) the tries to solve this equation system using </span>
<span class="sd">	eps=np.linalg.lstsq(AA,Af,rcond=-1)[0]</span>
<span class="sd">	if failes it returns a dictionary with 1000 as error (only entry) if successful</span>
<span class="sd">	it returns a dictionary that contains the </span>
<span class="sd">	fit_error = (AE**2).sum() with AE beeing the difference of measured and calcuated matrix</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	-----------</span>
<span class="sd">	</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		DataFrame to be fitted</span>
<span class="sd">		</span>
<span class="sd">	c: DataFrame</span>
<span class="sd">		DataFrame oontaining the concentration matrix (the concentrations as with the times as index. </span>
<span class="sd">		Each different species has a column with the species name as column name</span>
<span class="sd">		</span>
<span class="sd">	final : bool,optional</span>
<span class="sd">		if True (Default) the complete solutions will be attached otherwise only the error is attached</span>
<span class="sd">		</span>
<span class="sd">	baseunit : str,optional</span>
<span class="sd">		this string is used as unit for the time axis</span>

<span class="sd">	Returns</span>
<span class="sd">	------------------</span>
<span class="sd">	</span>
<span class="sd">	re : dict</span>
<span class="sd">		the dictionary &quot;re&quot; attached to the object containing all the matrixes and parameter. </span>
<span class="sd">		</span>
<span class="sd">		if &quot;final&quot; is True:</span>
<span class="sd">		</span>
<span class="sd">			* &quot;A&quot; Shaped measured Matrix</span>
<span class="sd">			* &quot;AC&quot; Shaped calculated Matrix </span>
<span class="sd">			* &quot;AE&quot; Difference between A and AC = linear error </span>
<span class="sd">			* &quot;DAC&quot; DAS or SAS, labeled after the names given in the function (the columns of c) Care must be taken that this mesured intensity is C * DAS, the product. For exponential model the concentrations are normalized</span>
<span class="sd">			* &quot;c&quot; The Concentrations (meaning the evolution of the concentrations over time. Care must be taken that this mesured intensity is C * DAS, the product. For exponential model the concentrations are normalized</span>
<span class="sd">			* &quot;error&quot; is the S2, meaning AE**2.sum().sum()</span>
<span class="sd">			</span>
<span class="sd">		else:</span>
<span class="sd">		</span>
<span class="sd">			* &quot;error&quot; is the S2, meaning AE**2.sum()</span>
<span class="sd">			</span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">time</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
	<span class="n">wl</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
	<span class="n">time_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
	<span class="n">energy_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
	<span class="n">A</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">values</span>
	<span class="n">er</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">values</span>
	<span class="n">ert</span> <span class="o">=</span> <span class="n">er</span><span class="o">.</span><span class="n">T</span>
	<span class="n">AA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">ert</span><span class="p">,</span><span class="n">er</span><span class="p">)</span>
	<span class="n">Af</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">ert</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">eps</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">AA</span><span class="p">,</span><span class="n">Af</span><span class="p">,</span><span class="n">rcond</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="n">re</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="mi">1000</span><span class="p">}</span>
		<span class="k">return</span> <span class="n">re</span>
	<span class="n">eps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">eps</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">eps</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">eps</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
	<span class="n">AC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">er</span><span class="p">,</span><span class="n">eps</span><span class="p">);</span>
	<span class="n">AE</span> <span class="o">=</span> <span class="n">A</span><span class="o">-</span><span class="n">AC</span><span class="p">;</span>
	<span class="n">fit_error</span> <span class="o">=</span> <span class="p">(</span><span class="n">AE</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
		<span class="n">A</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">wl</span><span class="p">)</span>
		<span class="n">AC</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">AC</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">wl</span><span class="p">)</span>
		<span class="n">AE</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">AE</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">wl</span><span class="p">)</span>
		<span class="n">DAC</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">wl</span><span class="p">)</span>
		<span class="n">A</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">A</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">AC</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">AC</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">AE</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">AE</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">DAC</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">energy_label</span>
		<span class="n">re</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">,</span><span class="s1">&#39;AC&#39;</span><span class="p">:</span><span class="n">AC</span><span class="p">,</span><span class="s1">&#39;AE&#39;</span><span class="p">:</span><span class="n">AE</span><span class="p">,</span><span class="s1">&#39;DAC&#39;</span><span class="p">:</span><span class="n">DAC</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="n">fit_error</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="n">c</span><span class="p">}</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">re</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span><span class="n">fit_error</span><span class="p">}</span>
	<span class="k">return</span> <span class="n">re</span></div>


<div class="viewcode-block" id="err_func"><a class="viewcode-back" href="../plot_func.html#plot_func.err_func">[docs]</a><span class="k">def</span> <span class="nf">err_func</span><span class="p">(</span><span class="n">paras</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="s1">&#39;paral&#39;</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">dump_paras</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ext_spectra</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;function that calculates and returns the error for the global fit. This function is intended for</span>
<span class="sd">	fitting a single dataset.</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	--------------</span>
<span class="sd">	ds : DataFrame</span>
<span class="sd">		This dataframe contains the data to be fitted. This has to be shaped as it is intended to (so all shping parameters</span>
<span class="sd">		already applied. The dataframe expects the time to be in Index and the wavelength/energy </span>
<span class="sd">		to be in the columns. The spectra is plotted with a second (energy) axis</span>
<span class="sd">	</span>
<span class="sd">	paras : lmfit parameter oject</span>
<span class="sd">		The parameter object that defines what is calculated </span>
<span class="sd">		</span>
<span class="sd">	mod : str or function, optional</span>
<span class="sd">		The model selection is depending if it is an internal or external model. </span>
<span class="sd">		The internal functions are triggered by calling their name </span>
<span class="sd">		Two main are currently implemented </span>
<span class="sd">		</span>
<span class="sd">			1. &#39;paral&#39; (Default) or &#39;exponential&#39;</span>
<span class="sd">			2. &#39;consecutive&#39; or &#39;full_consecutive&#39;</span>
<span class="sd">		</span>
<span class="sd">		In 2 the &#39;consecutive&#39; and &#39;full_consecutive&#39; are different in that for consecutive </span>
<span class="sd">		the optimization is done using &#39;exponential&#39; (as it shoudl give the same times)</span>
<span class="sd">		and then only in the last (final) iteration the &#39;full consecutive&#39; differential</span>
<span class="sd">		equation is used. This has significant speed advantages, but can lead to errors particularly</span>
<span class="sd">		for the very fast times.</span>
<span class="sd">		</span>
<span class="sd">		As external model a function is handed to this parameter, this function </span>
<span class="sd">		must accept the times and an paramater Dataframe and return a DataFrame </span>
<span class="sd">		with the concentrations (similar to build_c) </span>
<span class="sd">		</span>
<span class="sd">		for the internal functions:</span>
<span class="sd">		This datafram must contain the parameter that are used for creadting the dynamics</span>
<span class="sd">		the parameter must be named with the index.</span>
<span class="sd">		&#39;t0&#39; = zero time, mandatory</span>
<span class="sd">		&#39;resolution&#39; = instrument response function, mandatory</span>
<span class="sd">		&#39;background&#39;,optional = if this keyword is present a flat constant background is created (=1 over the whole time)</span>
<span class="sd">		&#39;infinite&#39;,optional = if this keyword is present a new non decaying component is formed with the last decay time.</span>
<span class="sd">		&#39;k0,k1,...&#39; = with increasing integers are taken as decay times. te number of these components is used to determine how many shall be generated.</span>
<span class="sd">		</span>
<span class="sd">	final : bool, optional</span>
<span class="sd">		this switch decides if just the squared error is returned (for False) (Default) or if the full</span>
<span class="sd">		matrixes are returned, including the r2 are returned.</span>
<span class="sd">		</span>
<span class="sd">	log_fit : bool, optional</span>
<span class="sd">		if False (Default) then the parameter are handed to the fitting function as they are, if true </span>
<span class="sd">		then all times are first converted to log space. </span>
<span class="sd">	</span>
<span class="sd">	dump_paras : bool, optional</span>
<span class="sd">		(Default) is False, If True creates two files in the working folder, one with the </span>
<span class="sd">		currently used parameter created at the end of each optimisation step, and one with</span>
<span class="sd">		the set of parameter that up to now gave the lowest error. Intented to store</span>
<span class="sd">		the optimisation results if the fit needs to be interrupted </span>
<span class="sd">		(if e.g. Ampgo simply needs to long to optimize.) useful option if things are slow</span>
<span class="sd">	</span>
<span class="sd">	filename : None or str, optional</span>
<span class="sd">		Only used in conjunction with &#39;dump_paras&#39;. The program uses this filename to dump the </span>
<span class="sd">		parameter to disk </span>
<span class="sd">		</span>
<span class="sd">	ext_spectra : DataFrame, optional</span>
<span class="sd">		(Default) is None, if given substract this spectra from the DataMatrix using the intensity </span>
<span class="sd">		given in &quot;C(t)&quot; this function will only work for external models. The name of the spectral column </span>
<span class="sd">		must be same as the name of the column used. If not the spectrum will be ignored. The spectrum will </span>
<span class="sd">		be interpolated to the spectral points of the model ds before the substraction. </span>

<span class="sd">	&#39;&#39;&#39;</span>
	<span class="n">time_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
	<span class="n">energy_label</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
	<span class="n">pardf</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="n">paras</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">log_fit</span><span class="p">:</span>
		<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="o">**</span><span class="n">x</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span><span class="c1">#did we use a build in model?</span>
		<span class="k">if</span> <span class="n">final</span><span class="p">:</span><span class="c1">#for final we really want the model</span>
			<span class="n">c</span><span class="o">=</span><span class="n">build_c</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="p">)</span>
		<span class="k">elif</span> <span class="s1">&#39;full_consecutive&#39;</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">:</span><span class="c1"># here we force the full consecutive modelling</span>
			<span class="n">c</span><span class="o">=</span><span class="n">build_c</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span><span class="c1">#here we &quot;bypass&quot; the full consecutive and optimize the rates with the decays</span>
			<span class="n">c</span><span class="o">=</span><span class="n">build_c</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">mod</span><span class="o">=</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="p">)</span>
		<span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="n">time_label</span>
		<span class="n">re</span><span class="o">=</span><span class="n">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
			<span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
			<span class="n">changed</span><span class="o">=</span><span class="kc">True</span>
			<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
				<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
					<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
					<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
					<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
		 
				<span class="k">else</span><span class="p">:</span><span class="n">changed</span><span class="o">=</span><span class="kc">False</span>
			<span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span>
			<span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">re</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">dump_paras</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;minimal_dump_paras.par&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;minimal_dump_paras_</span><span class="si">%s</span><span class="s1">.par&#39;</span><span class="o">%</span><span class="n">filename</span>
					<span class="n">min_df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
					<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]):</span>
						<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;dump_paras.par&#39;</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;dump_paras_</span><span class="si">%s</span><span class="s1">.par&#39;</span><span class="o">%</span><span class="n">filename</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="s1">&#39;consecutive&#39;</span><span class="p">]:</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">c</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">ext_spectra</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">re</span><span class="o">=</span><span class="n">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">ext_spectra</span><span class="o">=</span><span class="n">rebin</span><span class="p">(</span><span class="n">ext_spectra</span><span class="p">,</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
			<span class="n">c_temp</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ext_spectra</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
				<span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
				<span class="n">C</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">((</span><span class="n">A</span><span class="o">*</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">ext_spectra</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
				<span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">-</span><span class="n">C</span>
				<span class="n">c_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="n">re</span><span class="o">=</span><span class="n">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c_temp</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span><span class="c1">#</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error in the calculation&#39;</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">re</span>
			<span class="k">if</span> <span class="n">ext_spectra</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c_temp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c_temp</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
				<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ext_spectra</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
					<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">ext_spectra</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
					<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
			<span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
			<span class="k">return</span> <span class="n">re</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">dump_paras</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">min_df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;minimal_dump_paras.par&#39;</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
					<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]):</span>
						<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;minimal_dump_paras.par&#39;</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;dump_paras.par&#39;</span><span class="p">)</span>
			<span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
			<span class="k">return</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="err_func_multi"><a class="viewcode-back" href="../plot_func.html#plot_func.err_func_multi">[docs]</a><span class="k">def</span> <span class="nf">err_func_multi</span><span class="p">(</span><span class="n">paras</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="s1">&#39;paral&#39;</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">multi_project</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
					<span class="n">unique_parameter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dump_paras</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ext_spectra</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;function that calculates and returns the error for the global fit. This function is intended for</span>
<span class="sd">	fitting of multiple datasets</span>
<span class="sd">	</span>
<span class="sd">	Parameters</span>
<span class="sd">	--------------</span>
<span class="sd">	</span>
<span class="sd">	paras : lmfit parameter oject</span>
<span class="sd">		The parameter object that defines what is calculated </span>
<span class="sd">		</span>
<span class="sd">	mod : str or function, optional</span>
<span class="sd">		The model selection is depending if it is an internal or external model. </span>
<span class="sd">		The internal functions are triggered by calling their name </span>
<span class="sd">		Two main are currently implemented </span>
<span class="sd">		</span>
<span class="sd">			1. &#39;paral&#39; (Default) or &#39;exponential&#39;</span>
<span class="sd">			2. &#39;consecutive&#39; or &#39;full_consecutive&#39;</span>
<span class="sd">		</span>
<span class="sd">		In 2 the &#39;consecutive&#39; and &#39;full_consecutive&#39; are different in that for consecutive </span>
<span class="sd">		the optimization is done using &#39;exponential&#39; (as it shoudl give the same times)</span>
<span class="sd">		and then only in the last (final) iteration the &#39;full consecutive&#39; differential</span>
<span class="sd">		equation is used. This has significant speed advantages, but can lead to errors particularly</span>
<span class="sd">		for the very fast times.</span>
<span class="sd">		</span>
<span class="sd">		for the internal functions:</span>
<span class="sd">		This datafram must contain the parameter that are used for creadting the dynamics</span>
<span class="sd">		the parameter must be named with the index.</span>
<span class="sd">		&#39;t0&#39; = zero time, mandatory</span>
<span class="sd">		&#39;resolution&#39; = instrument response function, mandatory</span>
<span class="sd">		&#39;background&#39;,optional = if this keyword is present a flat constant background is created (=1 over the whole time)</span>
<span class="sd">		&#39;infinite&#39;,optional = if this keyword is present a new non decaying component is formed with the last decay time.</span>
<span class="sd">		&#39;k0,k1,...&#39; = with increasing integers are taken as decay times. te number of these components is used to determine how many shall be generated.</span>
<span class="sd">		</span>
<span class="sd">		As external model a function is handed to this parameter, this function </span>
<span class="sd">		must accept the times and an paramater Dataframe and return a DataFrame </span>
<span class="sd">		with the concentrations (similar to build_c) </span>
<span class="sd">		</span>
<span class="sd">	final : bool, optional</span>
<span class="sd">		this switch decides if just the squared error is returned (for False) (Default) or if the full</span>
<span class="sd">		matrixes are returned, including the r2 are returned.</span>
<span class="sd">		</span>
<span class="sd">	log_fit : bool, optional</span>
<span class="sd">		if False (Default) then the parameter are handed to the fitting function as they are, if true </span>
<span class="sd">		then all times are first converted to log space. </span>
<span class="sd">	</span>
<span class="sd">	dump_paras : bool, optional</span>
<span class="sd">		(Default) is False, If True creates two files in the working folder, one with the </span>
<span class="sd">		currently used parameter created at the end of each optimisation step, and one with</span>
<span class="sd">		the set of parameter that up to now gave the lowest error. Intented to store</span>
<span class="sd">		the optimisation results if the fit needs to be interrupted </span>
<span class="sd">		(if e.g. Ampgo simply needs to long to optimize.) useful option if things are slow</span>
<span class="sd">	</span>
<span class="sd">	filename : None or str, optional</span>
<span class="sd">		Only used in conjunction with &#39;dump_paras&#39;. The program uses this filename to dump the </span>
<span class="sd">		parameter to disk </span>
<span class="sd">	</span>
<span class="sd">	multi_project : None or list (of TA projects), optional</span>
<span class="sd">		This switch is triggering the simultaneous optimisation of multiple datasets.  </span>
<span class="sd">		multi_project is as (Default) None. it expects an iterable (typically list) with other </span>
<span class="sd">		TA projects (like ta) that are then optimised with the same parameter. </span>
<span class="sd">		This means that all projects get the same parameter object for each iteration </span>
<span class="sd">		of the fit and return their individual error, which is summed linearly. </span>
<span class="sd">		The &quot;weights&quot; option allows to give each multi_project a specific weight (number) </span>
<span class="sd">		that is multiplied to the error. If the weight object has the same number of items </span>
<span class="sd">		as the multi_project it is assumed that the triggering object (the embedded project) </span>
<span class="sd">		has the weight of 1, otherwise the first weight is for the embedded project. </span>
<span class="sd">		The option &#39;unique_parameter&#39; takes (a list) of parameter that are not </span>
<span class="sd">		to be shared between the projects (and that are not optimized either) </span>
<span class="sd">		The intended use of this is to give e.g. the pump power for multiple experiments to </span>
<span class="sd">		study non linear behaviour. Returned will be only the parameter set for the optimium</span>
<span class="sd">		combination of all parameter. Internally, we iterate through the projects and calculate </span>
<span class="sd">		for each project the error for each iteration. Important to note is that currently this </span>
<span class="sd">		means that each DAS/SAS is calculated independently! For performing the same calculation</span>
<span class="sd">		with a single DAS, the Matrixes need to be concatenated before the run and an external</span>
<span class="sd">		function used to create a combined model. As this is very difficult to implement reliably</span>
<span class="sd">		For general use (think e.g. different pump wavelength) this has to be done manually. </span>
<span class="sd">	</span>
<span class="sd">	unique_parameter : None or str or list (of strings), optional </span>
<span class="sd">		only used in conjunction with &#39;multi_project&#39;, it takes (a list) of parameter that </span>
<span class="sd">		are not to be shared between the projects (and that are not optimized either) </span>
<span class="sd">		The intended use of this is to give e.g. the pump power for multiple experiments </span>
<span class="sd">		to study non linear behaviour. (Default) None</span>
<span class="sd">	</span>
<span class="sd">	weights : list of floats, optional</span>
<span class="sd">		only used in conjunction with &#39;multi_project&#39;. The &quot;weights&quot; option allows to </span>
<span class="sd">		give each multi\_project a specific weight (number) that is multiplied to the error. </span>
<span class="sd">		If the weight object has the same number of items as the &#39;multi_project&#39; it is assumed </span>
<span class="sd">		that ta (the embedded project) has the weight of 1, otherwise the first weight is for the </span>
<span class="sd">		embedded object</span>
<span class="sd">		</span>
<span class="sd">	ext_spectra : DataFrame, optional</span>
<span class="sd">		(Default) is None, if given substract this spectra from the DataMatrix using the intensity </span>
<span class="sd">		given in &quot;C(t)&quot; this function will only work for external models. The name of the spectral column </span>
<span class="sd">		must be same as the name of the column used. If not the spectrum will be ignored. The spectrum will </span>
<span class="sd">		be interpolated to the spectral points of the model ds before the substraction. </span>

<span class="sd">	&#39;&#39;&#39;</span>									   
	<span class="n">pardf_changing</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="n">paras</span><span class="p">)</span>
	<span class="n">error_listen</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">r2_listen</span><span class="o">=</span><span class="p">[]</span>
	<span class="n">slice_setting_object</span><span class="o">=</span><span class="n">multi_project</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Copy</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ta</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">multi_project</span><span class="p">):</span>
		<span class="n">ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
					<span class="n">timelimits</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> 
					<span class="n">time_bin</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">time_bin</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="n">slice_setting_object</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">)</span>	
		<span class="n">pardf</span><span class="o">=</span><span class="n">pardf_changing</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">try</span><span class="p">:</span><span class="c1">#let&#39;s see if the project has an parameter object</span>
			<span class="n">pardf_ori</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">par</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">pardf_ori</span><span class="o">=</span><span class="n">pardf</span>
		<span class="k">if</span> <span class="n">unique_parameter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">unique_parameter</span><span class="p">:</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf_ori</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>	
		<span class="k">if</span> <span class="n">log_fit</span><span class="p">:</span>
			<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="o">**</span><span class="n">x</span><span class="p">)</span>

		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span><span class="c1">#did we use a build in model?</span>
			<span class="n">c</span><span class="o">=</span><span class="n">build_c</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="p">)</span>
			<span class="n">re</span><span class="o">=</span><span class="n">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">labels</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
					<span class="n">changed</span><span class="o">=</span><span class="kc">True</span>
					<span class="k">if</span> <span class="s1">&#39;background&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
						<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
							<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
							<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;background&#39;</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="s1">&#39;infinite&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
							<span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Non Decaying&#39;</span>
		   
						<span class="k">else</span><span class="p">:</span><span class="n">changed</span><span class="o">=</span><span class="kc">False</span>
					<span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
						<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span>
						<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">labels</span>
					<span class="n">re_final</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
				<span class="n">error_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
				<span class="n">r2_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">error_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">c</span><span class="o">=</span><span class="n">mod</span><span class="p">(</span><span class="n">times</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">),</span><span class="n">pardf</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;value&#39;</span><span class="p">])</span>
			<span class="n">re</span><span class="o">=</span><span class="n">fill_int</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
					<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
					<span class="n">re</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
					<span class="n">re_final</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
				<span class="n">error_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
				<span class="n">r2_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">((</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">error_listen</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">weights</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">error_listen</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="n">weights</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
			<span class="n">weights</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">error_listen</span><span class="p">):</span>
			<span class="n">Ex</span> <span class="o">=</span> <span class="ne">ValueError</span><span class="p">()</span>
			<span class="n">Ex</span><span class="o">.</span><span class="n">strerror</span><span class="o">=</span><span class="s1">&#39;The number of entries i the list must either be the number of all elements (including </span><span class="se">\&quot;</span><span class="s1">TA</span><span class="se">\&quot;</span><span class="s1"> or the number of elements in other. In this case the element ta gets the weight=1&#39;</span>
			<span class="k">raise</span> <span class="n">Ex</span>
		<span class="n">combined_error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">error_listen</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
			<span class="n">combined_r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r2_listen</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">combined_error</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">error_listen</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
			<span class="n">combined_r2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r2_listen</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
	<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
		<span class="n">re_final</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">combined_error</span>
		<span class="n">re_final</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">combined_r2</span>
	<span class="k">if</span> <span class="n">dump_paras</span><span class="p">:</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">combined_error</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">combined_r2</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;minimal_dump_paras.par&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;minimal_dump_paras_</span><span class="si">%s</span><span class="s1">.par&#39;</span><span class="o">%</span><span class="n">filename</span>
			<span class="n">min_df</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">float</span><span class="p">(</span><span class="n">combined_error</span><span class="p">):</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">)</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;dump_paras.par&#39;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">store_name</span><span class="o">=</span><span class="s1">&#39;dump_paras_</span><span class="si">%s</span><span class="s1">.par&#39;</span><span class="o">%</span><span class="n">filename</span>
		<span class="n">pardf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">store_name</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">mod</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="s1">&#39;consecutive&#39;</span><span class="p">]:</span>
		<span class="nb">print</span><span class="p">(</span><span class="n">combined_error</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">final</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">re_final</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">combined_error</span></div>


<span class="k">def</span> <span class="nf">par_to_pardf</span><span class="p">(</span><span class="n">par</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;function to convert a parameters object into a pretty DataFrame, it expects par to be a lmfit parameters object and loops through the keys&#39;&#39;&#39;</span>
	<span class="n">out_dicten</span><span class="o">=</span><span class="p">{}</span>
	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">}</span>
		<span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span><span class="c1">#its a time parameter</span>
			<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">False</span>
		<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">min</span>
		<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">max</span>
		<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;vary&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span>
		<span class="n">out_dicten</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;expr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">expr</span>
	<span class="k">return</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out_dicten</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>


<span class="k">def</span> <span class="nf">pardf_to_par</span><span class="p">(</span><span class="n">par_df</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;converts a dataframe to lmfit object</span>
<span class="sd">	set(value=None, vary=None, min=None, max=None, expr=None, brute_step=None)&#39;&#39;&#39;</span>
	<span class="n">par</span><span class="o">=</span><span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">par_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
		<span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">],</span> <span class="nb">min</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">],</span> <span class="n">expr</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>															 
	<span class="k">return</span> <span class="n">par</span>
	
	
<span class="k">def</span> <span class="nf">pardf_to_timedf</span><span class="p">(</span><span class="n">pardf</span><span class="p">):</span>
	<span class="sd">&#39;&#39;&#39;inverts all the rates to times in a dataframe&#39;&#39;&#39;</span>
	<span class="n">timedf</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
	<span class="k">if</span> <span class="s1">&#39;upper_limit&#39;</span> <span class="ow">in</span> <span class="n">pardf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">]:</span>
			<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pardf</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">timedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]:</span>
					<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;max&#39;</span>
					<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;min&#39;</span>
					<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;lower_limit&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;upper_limit&#39;</span>
					<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;upper_limit&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;lower_limit&#39;</span>
					<span class="k">else</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="n">key</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
							<span class="n">timedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key_in</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span> 
						<span class="k">else</span><span class="p">:</span>
							<span class="n">timedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key_in</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;inf&#39;</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;init_value&#39;</span><span class="p">:</span><span class="k">pass</span><span class="c1">#we don&#39;t save the init values, so we get an error when converting the saved file</span>
						<span class="k">elif</span> <span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="k">continue</span>
						<span class="k">else</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;conversion of this key failed: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
			<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;max&#39;</span>		 
			<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="s1">&#39;min&#39;</span>
			<span class="k">else</span><span class="p">:</span><span class="n">key_in</span><span class="o">=</span><span class="n">key</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">timedf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key_in</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">!=</span><span class="mi">0</span>  <span class="k">else</span> <span class="s1">&#39;inf&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;init_value&#39;</span><span class="p">:</span><span class="k">pass</span><span class="c1">#we don&#39;t save the init values, so we get an error when converting the saved file</span>
				<span class="k">else</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;conversion of this key failed:&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">timedf</span>


<div class="viewcode-block" id="TA"><a class="viewcode-back" href="../plot_func.html#plot_func.TA">[docs]</a><span class="k">class</span> <span class="nc">TA</span><span class="p">():</span>	<span class="c1"># object wrapper for the whole</span>
<div class="viewcode-block" id="TA.__init__"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.__init__">[docs]</a>	<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">index_is_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
				<span class="n">sort_indexes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">divide_times_by</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
				<span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>		 
		<span class="sd">&#39;&#39;&#39;Function that opens and imports data into an TA object</span>
<span class="sd">		it is designed to open combined files that contain both the wavelength and the time. (e.g. SIA files as recorded by Pascher instruments software) or hdf5 projects saved by this software</span>
<span class="sd">		There are however a lot of additional options to open other ascii type files and adapt their format internally</span>
<span class="sd">		Attention times with Nan will be completely removed during the import</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		filename : str</span>
<span class="sd">			</span>
<span class="sd">			* expects a filename in string form for opening a single file. </span>
<span class="sd">			* alternatively &#39;gui&#39; can be set as filename, then a TKinter gui is opened for select.</span>
<span class="sd">			* alternatively &#39;recent&#39; can given as key word. in this case it tries to find a text file named &quot;recent.dat&quot; that should contain the path to the last file opened with the GUI. this file is then opened. if this file is not found the GUI is opened instead</span>
<span class="sd">		</span>
<span class="sd">		path : str or path object (optional)</span>
<span class="sd">			if path is a string without the operation system dependent separator, it is treated as a relative path, </span>
<span class="sd">			e.g. data will look from the working directory in the sub director data. Otherwise this has to be a </span>
<span class="sd">			full path in either strong or path object form.</span>
<span class="sd">		</span>
<span class="sd">		sep : str (optional)</span>
<span class="sd">			is the separator between different numbers, typical are tap (Backslash t) (Default) ,one or </span>
<span class="sd">			multiple white spaces &#39;backslash s+&#39; or comma &#39;,&#39;.</span>
<span class="sd">		</span>
<span class="sd">		decimal : str (optional) </span>
<span class="sd">			sets the ascii symbol that is used for the decimal sign. In most countries this is &#39;.&#39;(Default) </span>
<span class="sd">			but it can be &#39;,&#39; in countries like Sweden or Germany</span>
<span class="sd">		</span>
<span class="sd">		index_is_energy : bool (optional)</span>
<span class="sd">			switches if the wavelength is given in nm (Default) or in eV (if True), currently everything </span>
<span class="sd">			is handled as wavelength in nm internally</span>
<span class="sd">		</span>
<span class="sd">		data_type: str (optional)</span>
<span class="sd">			data_type is the string that represents the intensity measurements. Usually this contains if absolute </span>
<span class="sd">			of differential data. This is used for the color intensity in the 2d plots and the y-axis for the 1d plots</span>
<span class="sd">			</span>
<span class="sd">		units: str (optional)</span>
<span class="sd">			this is used to identify the units on the energy axis and to label the slices, recognized is &#39;nm&#39;, &#39;eV&#39; and &#39;keV&#39; </span>
<span class="sd">			but if another unit like &#39;cm^-1&#39; is used it will state energy in &#39;cm^-1&#39;. Pleas observe that if you use the index_is_energy</span>
<span class="sd">			switch the program tries to convert this energy into wavelength. </span>
<span class="sd">		</span>
<span class="sd">		transpose : bool (optional)</span>
<span class="sd">			if this switch is False (Default) the wavelength are the columns and the rows the times.</span>
<span class="sd">		</span>
<span class="sd">		sort_indexes : bool (optional)</span>
<span class="sd">			For False (Default) I assume that the times and energies are already in a rising order. </span>
<span class="sd">			with this switch, both are sorted again. </span>
<span class="sd">		</span>
<span class="sd">		divide_times_by : bool or float (optional) </span>
<span class="sd">			here a number can be given that scales the time by an arbitary factor. This is actually dividing</span>
<span class="sd">			the times by this value. Alternatively there is the variable self.baseunit. The latter only affects </span>
<span class="sd">			what is written on the axis, while this value is actually used to scale the times. False (Default) </span>
<span class="sd">			ignores this</span>
<span class="sd">		</span>
<span class="sd">		shift_times_by : None, float (optional)</span>
<span class="sd">			This a value by which the time axis is shifted during import. This is a useful option of e.g. </span>
<span class="sd">			the recording software does not compensate for t0 and the data is always shifted. </span>
<span class="sd">			None (Default) ignores this setting</span>
<span class="sd">		</span>
<span class="sd">		data_type : str, None</span>
<span class="sd">			this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">			(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">		</span>
<span class="sd">		external_time : None or str (optional)</span>
<span class="sd">			Here a filename extension (string) can be given that contains the time vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single </span>
<span class="sd">			type of separated data without header. It also assumes that this is the ending </span>
<span class="sd">			for the file. The filename itself is taken from the filename. </span>
<span class="sd">			e.g. if samp1.txt is the filename and external_time=&#39;.tid&#39; the program searches </span>
<span class="sd">			samp1.tid for the times. The transpose setting is applied and sets where the times are </span>
<span class="sd">			to be inserted (row or column indexes)</span>
<span class="sd">		</span>
<span class="sd">		external_wave: None or str (optional) </span>
<span class="sd">			Here a filename extension (string) can be given that contains the wavelength vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single type </span>
<span class="sd">			of separated data without header. This is the ending for the file. The filename itself </span>
<span class="sd">			is taken from the filename. e.g. if samp1.txt is the filename and external_wave=&#39;.wav&#39; </span>
<span class="sd">			then the program searches samp1.wav for the wavelength. The transpose setting is applied </span>
<span class="sd">			and sets where the wavelength are to be inserted (columns or row indexes)</span>
<span class="sd">			</span>
<span class="sd">		Returns</span>
<span class="sd">		-------</span>
<span class="sd">		</span>
<span class="sd">		A TA object with all parameter initialized</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------------</span>
<span class="sd">		</span>
<span class="sd">		Typical useage:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf #import the module and give it a shorter name</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;gui&#39;) #use a GUI to open</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;sample_1.SIA&#39;) #use a filename in the same folder</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;sample_1.hdf5&#39;,path=&#39;Data&#39;) #use a filename in the folder &#39;Data&#39;</span>
<span class="sd">		</span>
<span class="sd">		Opening a list of files with external time vector (of the same name) so it looks for a data</span>
<span class="sd">		file &quot;fite1.txt&quot; and a file with the time information &quot;file1.tid&quot;</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt;ta=pf.TA(&#39;file1.txt&#39;, external_time = &#39;tid&#39;)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;gui&#39;</span><span class="p">:</span>
			<span class="n">root_window</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
			<span class="n">root_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
			<span class="n">root_window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">root_window</span><span class="o">.</span><span class="n">focus_force</span><span class="p">())</span>
			<span class="n">complete_path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
			<span class="n">listen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
			<span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">filename</span><span class="o">=</span><span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;recent.dat&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
				<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;recent&#39;</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;recent.dat&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="n">complete_path</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
					<span class="n">listen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
					<span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
					<span class="n">filename</span><span class="o">=</span><span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">root_window</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
				<span class="n">root_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
				<span class="n">root_window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">root_window</span><span class="o">.</span><span class="n">focus_force</span><span class="p">())</span>
				<span class="n">complete_path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
				<span class="n">listen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
				<span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">filename</span><span class="o">=</span><span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;recent.dat&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span>
		<span class="k">if</span> <span class="s1">&#39;hdf5&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span><span class="c1">#we read in data from previous run</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">__read_project</span><span class="p">(</span><span class="n">saved_project</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">__make_standard_parameter</span><span class="p">()</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Cor_Chirp</span><span class="p">(</span><span class="n">fitcoeff</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span><span class="c1">#we read in raw data from sia File</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">__read_ascii_data</span><span class="p">(</span><span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="n">decimal</span><span class="p">,</span> <span class="n">index_is_energy</span> <span class="o">=</span> <span class="n">index_is_energy</span><span class="p">,</span> 
									<span class="n">transpose</span> <span class="o">=</span> <span class="n">transpose</span><span class="p">,</span> <span class="n">sort_indexes</span> <span class="o">=</span> <span class="n">sort_indexes</span><span class="p">,</span> 
									<span class="n">divide_times_by</span> <span class="o">=</span> <span class="n">divide_times_by</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="n">shift_times_by</span><span class="p">,</span> 
									<span class="n">external_time</span> <span class="o">=</span> <span class="n">external_time</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="n">external_wave</span><span class="p">,</span>
									<span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">__make_standard_parameter</span><span class="p">()</span></div>


	<span class="k">def</span> <span class="nf">__read_ascii_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">decimal</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">index_is_energy</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
							<span class="n">sort_indexes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">divide_times_by</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">shift_times_by</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
							<span class="n">external_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">external_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">correct_ascii_errors</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
							<span class="n">data_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Fancy function that handles the import of pure ascii files.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		sep : str (optional)</span>
<span class="sd">			is the separator between different numbers, typical are tap (Backslash t) (Default) ,one or </span>
<span class="sd">			multiple white spaces &#39;backslash s+&#39; or comma &#39;,&#39;.</span>
<span class="sd">		decimal : str (optional) </span>
<span class="sd">			sets the ascii symbol that is used for the decimal sign. In most countries this is &#39;.&#39;(Default) </span>
<span class="sd">			but it can be &#39;,&#39; in countries like Sweden or Germany</span>
<span class="sd">		index_is_energy : bool (optional)</span>
<span class="sd">			switches if the wavelength is given in nm (Default) or in eV (if True), currently everything </span>
<span class="sd">			is handled as wavelength in nm internally</span>
<span class="sd">		data_type: str (optional)</span>
<span class="sd">			data_type is the string that represents the intensity measurements. Usually this contains if absolute </span>
<span class="sd">			of differential data. This is used for the color intensity in the 2d plots and the y-axis for the 1d plots</span>
<span class="sd">		units: str (optional)</span>
<span class="sd">			this is used to identify the units on the energy axis and to label the slices, recognized is &#39;nm&#39;, &#39;eV&#39; and &#39;keV&#39; </span>
<span class="sd">			but if another unit like &#39;cm^-1&#39; is used it will state energy in &#39;cm^-1&#39;. Pleas observe that if you use the index_is_energy</span>
<span class="sd">			switch the program tries to convert this energy into wavelength. </span>
<span class="sd">		transpose : bool (optional)</span>
<span class="sd">			if this switch is False (Default) the wavelength are the columns and the rows the times.</span>
<span class="sd">		sort_indexes : bool (optional)</span>
<span class="sd">			For False (Default) I assume that the times and energies are already in a rising order. </span>
<span class="sd">			with this switch, both are sorted again. </span>
<span class="sd">		divide_times_by : bool or float (optional) </span>
<span class="sd">			here a number can be given that scales the time by an arbitary factor. This is actually dividing</span>
<span class="sd">			the times by this value. Alternatively there is the variable self.baseunit. The latter only affects </span>
<span class="sd">			what is written on the axis, while this value is actually used to scale the times. False (Default) </span>
<span class="sd">			ignores this</span>
<span class="sd">		shift_times_by : None, float (optional)</span>
<span class="sd">			This a value by which the time axis is shifted during import. This is a useful option of e.g. </span>
<span class="sd">			the recording software does not compensate for t0 and the data is always shifted. </span>
<span class="sd">			None (Default) ignores this setting</span>
<span class="sd">		external_time : None or str (optional)</span>
<span class="sd">			Here a filename extension (string) can be given that contains the time vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single </span>
<span class="sd">			type of separated data without header. It also assumes that this is the ending </span>
<span class="sd">			for the file. The filename itself is taken from the filename. </span>
<span class="sd">			e.g. if samp1.txt is the filename and external_time=&#39;.tid&#39; the program searches </span>
<span class="sd">			samp1.tid for the times. The transpose setting is applied and sets where the times are </span>
<span class="sd">			to be inserted (row or column indexes)</span>
<span class="sd">		external_wave : None or str (optional) </span>
<span class="sd">			Here a filename extension (string) can be given that contains the wavelength vector. </span>
<span class="sd">			The file is assumed to be at the same path as the data and to contain a single type </span>
<span class="sd">			of separated data without header. This is the ending for the file. The filename itself </span>
<span class="sd">			is taken from the filename. e.g. if samp1.txt is the filename and external_wave=&#39;.wav&#39; </span>
<span class="sd">			then the program searches samp1.wav for the wavelength. The transpose setting is applied </span>
<span class="sd">			and sets where the wavelength are to be inserted (columns or row indexes)</span>
<span class="sd">		correct_ascii_errors :  bool (optional)</span>
<span class="sd">			If True (Default) then the code tries to catch some stuff like double minus signs and double dots</span>
<span class="sd">			</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">correct_ascii_errors</span><span class="p">:</span>
			<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">==</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
				<span class="k">pass</span><span class="c1">#all columns were converted to float,nice</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;some data bad, try filtering&#39;</span><span class="p">)</span>
				<span class="k">try</span><span class="p">:</span><span class="c1"># try forced conversion</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> 
				<span class="k">except</span><span class="p">:</span>
					<span class="c1">#try:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">applymap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.+&#39;</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
					<span class="c1">#except:</span>
					<span class="c1">#	print(&#39;Attention filtering/cleaning failed check the file type&#39;)</span>
		<span class="k">if</span> <span class="n">external_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">data_file_name</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
			<span class="n">time_file</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">external_time</span><span class="p">)</span>
			<span class="n">times</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">time_file</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span> <span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">times</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">times</span>
		<span class="k">if</span> <span class="n">external_wave</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">data_file_name</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
			<span class="n">wave_file</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">external_wave</span><span class="p">)</span>
			<span class="n">waves</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">wave_file</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">waves</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="n">decimal</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">waves</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#Make columns indexes numbers</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#Make row indexes numbers</span>
		<span class="k">if</span> <span class="n">index_is_energy</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">h</span><span class="o">*</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="mf">1e-9</span><span class="o">*</span><span class="n">scipy</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">electron_volt</span><span class="p">)</span>
															  
		<span class="k">if</span> <span class="n">transpose</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">T</span>
		<span class="k">if</span> <span class="n">sort_indexes</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">shift_times_by</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="n">shift_times_by</span>
		<span class="k">if</span> <span class="n">divide_times_by</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="n">divide_times_by</span>
		<span class="k">if</span> <span class="n">data_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="n">data_type</span>
		<span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>

		
	<span class="k">def</span> <span class="nf">__make_standard_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;function that sets the standard parameter. The function takes no input, but we use this docstring to explain the parameter.</span>

<span class="sd">		Parameters</span>
<span class="sd">		-------------</span>

<span class="sd">		log_scale : bool, optional</span>
<span class="sd">			If False (Default), The 2D plots (Matrix) is plotted with a pseudo logarithmic intensity scale. </span>
<span class="sd">			This usually does not give good results unless the intensity scale is symmetric </span>
<span class="sd">		self.cmap  : matplotlib.cm</span>
<span class="sd">			(Default)  standard_map - global parameter</span>
<span class="sd">			cmap is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		self.lintresh : float</span>
<span class="sd">			The pseudo logratihmic range &quot;symlog&quot; is used for most time axis. Symlog plots a range around</span>
<span class="sd">			time zero linear and beyond this linear treshold &#39;lintresh&#39; on a logarithmic scale. (Default) 0.3 </span>
<span class="sd">		self.log_fit  : </span>
<span class="sd">			(Default)  False\n</span>
<span class="sd">			Transfer all the time-fitting parameters into log-space before the fit</span>
<span class="sd">		self.ignore_time_region  : None or list (of two floats or of lists)</span>
<span class="sd">			(Default)  None</span>
<span class="sd">			cut set a time range with a low and high limit from the fits. (Default) None nothing happens</span>
<span class="sd">			The region will be removed during the fitting process (and will be missing in the fit-result</span>
<span class="sd">			plots)\n</span>
<span class="sd">			Usage single region: [lower region limit,upper region limit]\n</span>
<span class="sd">			use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		self.error_matrix_amplification  : </span>
<span class="sd">			(Default)  10</span>
<span class="sd">		self.rel_wave  : float or list (of floats) </span>
<span class="sd">			(Default)  np.arange(300,1000,100)\n</span>
<span class="sd">			&#39;rel_wave&#39; and &#39;width&#39; (in the object called &#39;wavelength_bin&#39; work together for the creation </span>
<span class="sd">			of kinetic plots. When plotting kinetic spectra one line will be plotted for each entrance</span>
<span class="sd">			in the list/vector rel_wave. During object generation the vector np.arange(300,1000,100) </span>
<span class="sd">			is set as standard. Another typical using style would be to define a list of interesting </span>
<span class="sd">			wavelength at which a kinetic development is to be plotted. At each selected wavelength </span>
<span class="sd">			the data between wavelength+ta.wavelength_bin and wavelength-ta.wavelength_bin is averaged </span>
<span class="sd">			for each timepoint returned </span>
<span class="sd">		self.rel_time  : float or list/vector (of floats)</span>
<span class="sd">			(Default)  [0.2,0.3,0.5,1,3,10,30,100,300,1000,3000,9000]\n</span>
<span class="sd">			For each entry in rel_time a spectrum is plotted. If time_width_percent=0 (Default) the </span>
<span class="sd">			nearest measured timepoint is chosen. For other values see &#39;time_width_percent&#39;</span>
<span class="sd">		self.time_width_percent  : float</span>
<span class="sd">			(Default)  0 &quot;rel_time&quot; and &quot;time_width_percent&quot; work together for </span>
<span class="sd">			creating spectral plots at specific timepoints. For each entry </span>
<span class="sd">			in rel_time a spectrum is plotted. If however e.g. time_width_percent=10 </span>
<span class="sd">			the region between the timepoint closest to the  1.1 x timepoint </span>
<span class="sd">			and 0.9 x timepoint is averaged and shown (and the legend adjusted accordingly). </span>
<span class="sd">			This is particularly useful for the densly</span>
<span class="sd">			sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">			timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">			but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">			This averaging is only applied for the plotting function and not for the fits.</span>
<span class="sd">		self.baseunit  : str</span>
<span class="sd">			(Default)  &#39;ps&#39;\n</span>
<span class="sd">			baseunit is a neat way to change the unit on the time axis of the plots. (Default) &#39;ps&#39;, but they </span>
<span class="sd">			can be frames or something similarly. This is changing only the label of the axis. </span>
<span class="sd">			During the import there is the option to divide the numbers by a factor. </span>
<span class="sd">			I have also used frames or fs as units. Important is that all time units will be labeled with</span>
<span class="sd">			this unit.</span>
<span class="sd">		self.mod  : </span>
<span class="sd">			(Default)  &#39;exponential&#39;\n</span>
<span class="sd">			This is the default fitting function, in general this is discussed in the fitting section</span>
<span class="sd">		self.scattercut  : None or iterable (of floats or other iterable, always pairs!)</span>
<span class="sd">			(Default)  None\n</span>
<span class="sd">			intented to &quot;cut&quot; one or multiple scatter regions. (if (Default) None nothing</span>
<span class="sd">			happens) If it is set the spectral region between the limits is set to zero. </span>
<span class="sd">			Usage single region: [lower region limit,upper region limit], </span>
<span class="sd">			use for multiple regions:[[lower limit 1,upper limit 1],[lower limit 2,upper limit 2],...]</span>
<span class="sd">		self.bordercut  : None or iterable (with two floats)</span>
<span class="sd">			(Default)  None\n</span>
<span class="sd">			cut spectra at the low and high wavelength limit. (Default) None </span>
<span class="sd">			uses the limits of measurement </span>
<span class="sd">		self.time_bin  : None or int</span>
<span class="sd">			(Default)  None</span>
<span class="sd">			is dividing the points on the time-axis in even bins and averages the found values in between. </span>
<span class="sd">			This is a hard approach that also affects the fits. I do recommend to use this carefully, </span>
<span class="sd">			it is most useful for modulated data. A better choice for transient absorption that only </span>
<span class="sd">			affects the kinetics is &#39;time_width_percent&#39;</span>
<span class="sd">		self.timelimits  : None or list (of 2 floats)</span>
<span class="sd">			(Default)  None\n</span>
<span class="sd">			cut times at the low and high time limit. (Default) None uses the limits of measurement</span>
<span class="sd">			Important: If either the background or the chirp is to be fit this must include the </span>
<span class="sd">			time before zero! Useful: It is useful to work on different regions, starting with</span>
<span class="sd">			the longest (then use the ta.Backgound function prior to fit) and expand from there</span>
<span class="sd">		data_type : str</span>
<span class="sd">			this is the datatype and effectively the unit put on the intensity axis </span>
<span class="sd">			(Default)&#39;differential Absorption in $\mathregular{\Delta OD}$</span>
<span class="sd">		self.wave_nm_bin  : None or float </span>
<span class="sd">			(Default)  None\n</span>
<span class="sd">			rebins the original data into even intervals. If set to None the original data will be used. </span>
<span class="sd">			If set to a width (e.g. 2nm), the wavelength axis will be divided into steps of this size</span>
<span class="sd">			and the mean of all measurements in the interval is taken. The re-binning stops as soon as</span>
<span class="sd">			the measured stepsize is wider than given here, then the original bins are used. </span>
<span class="sd">			This function is particularly useful for spectrometer with non-linear dispersion, </span>
<span class="sd">			like a prism in the infrared.</span>
<span class="sd">		self.wavelength_bin  :  float, optional</span>
<span class="sd">			(Default)  10nm the width used in kinetics, see below</span>
<span class="sd">		self.intensity_range  : None, float or list [of two floats]</span>
<span class="sd">			(Default)  None - intensity_range is a general switch that governs what intensity range the plots show. </span>
<span class="sd">			For the 1d plots this is the y-axis for the 2d-plots this is the colour scale. </span>
<span class="sd">			This parameter recognizes three settings. If set to &quot;None&quot; (Default) this uses the minimum and</span>
<span class="sd">			maximum of the data. A single value like in the example below and the intended use is the symmetric</span>
<span class="sd">			scale while a list with two entries an assymmetric scale e.g. </span>
<span class="sd">			intensity_range=3e-3 is converted into intensity_range=[-3e-3,3e-3]</span>
<span class="sd">		self.ds_ori.columns.name : str, optional </span>
<span class="sd">			(Default)  &#39;Wavelength in nm&#39;\n</span>
<span class="sd">			This is the general energy axis. here we define it with the unit. Change this to energy for use in e.g x-ray science</span>
<span class="sd">		self.ds_ori.index.name : str, optional</span>
<span class="sd">			Standard &#39;Time in %s&#39; % self.baseunit </span>
<span class="sd">		self.data_type: str (optional)</span>
<span class="sd">			self.data_type=&#39;diff. Absorption in $\mathregular{\Delta OD}$&#39;</span>
<span class="sd">		self.fitcoeff : list (5 floats)</span>
<span class="sd">			chirp correction polynom</span>
<span class="sd">		self.chirp_file : str</span>
<span class="sd">			if there is a file withthe right name write it here, otherwise None</span>
<span class="sd">		self.figure_path : str</span>
<span class="sd">			Path for saving figures, if set</span>
<span class="sd">		self.save_figures_to_folder : bool</span>
<span class="sd">			if True all figures are automatically saved when any plotfunction is called</span>

<span class="sd">		Examples</span>
<span class="sd">		-----------</span>

<span class="sd">		&gt;&gt;&gt; ta.bordercut=[350,1200]  #remove all data outside this limit</span>
<span class="sd">		&gt;&gt;&gt; ta.scattercut=[522,605]  #set data inside this limit to zero</span>
<span class="sd">		&gt;&gt;&gt; ta.timelimits=[0.2,5000]  #remove all data outside this limit</span>
<span class="sd">		&gt;&gt;&gt; ta.wave_nm_bin=5  #rebin the data to this width</span>
<span class="sd">		&gt;&gt;&gt; ta.intensity_range=3e-3  #equivalent to [-3e-3,3e-3]</span>
<span class="sd">		&gt;&gt;&gt; ta.intensity_range=[-1e-3,3e-3]  #intensity that is plotted in 2d plot and y-axis in 1d plots</span>
<span class="sd">		&gt;&gt;&gt; ta.cmap=matplotlib.cm.prism  #choose different colour map</span>
<span class="sd">		&gt;&gt;&gt; ta.ignore_time_region=[-0.1,0.1] #ignore -0.1ps to 0.1ps</span>


<span class="sd">		&#39;&#39;&#39;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">log_scale</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;log_scale&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_scale</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">standard_map</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lintresh</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lintresh&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">lintresh</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;log_fit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ignore_time_region&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">error_matrix_amplification</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;error_matrix_amplificatio&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_matrix_amplification</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rel_wave&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">9000</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;rel_time&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;time_width_percent&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span> <span class="o">=</span> <span class="s1">&#39;ps&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;baseunit&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">mod</span> <span class="o">=</span> <span class="s1">&#39;exponential&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;scattercut&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;bordercut&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;time_bin&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;timelimits&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;wave_nm_bin&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;wavelength_bin&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;save_figures_to_folder&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;intensity_range&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Time in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ds_ori.index.name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;nm&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Wavelength in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ds_ori.columns.name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;eV&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Energy in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ds_ori.columns.name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		<span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">==</span> <span class="s1">&#39;keV&#39;</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Energy in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ds_ori.columns.name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Energy in </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;ds_ori.columns.name&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="o">=</span> <span class="s1">&#39;diff. Absorption in $\mathregular{\Delta OD}$&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;data_type&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span>
		
		<span class="k">try</span><span class="p">:</span><span class="c1">#self.fitcoeff</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span>
			<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">:</span><span class="k">raise</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#: test comment here</span>
		<span class="k">try</span><span class="p">:</span><span class="c1">#self.chirp_file</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_chirp.dat&#39;</span><span class="p">)):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_chirp.dat&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">try</span><span class="p">:</span><span class="c1">#self.figure_path</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;result_figures&quot;</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="kc">None</span>

		<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

	
<div class="viewcode-block" id="TA.Filter_data"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Filter_data">[docs]</a>	<span class="k">def</span> <span class="nf">Filter_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cut_bad_times</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">replace_bad_values</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">uppervalue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">lowervalue</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Filteres the data by applying hard replacements. if both replace_bad_values and </span>
<span class="sd">		cut_bad_times are false or None, the times above &quot;value&quot; are replaced by zero</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		------------</span>
<span class="sd">		value : float, optional</span>
<span class="sd">			all values above this (absolute) value are considered to be corrupted. (Default 20) as classically the setup </span>
<span class="sd">			reports optical DEnsity, an OD of 20 would be far above the typically expected</span>
<span class="sd">			OD 1e-3. Pascher instrument software uses a value of 21 to indicate an error.</span>
<span class="sd">		</span>
<span class="sd">		uppervalue : float, optional</span>
<span class="sd">			all values above this number are considered to be corrupted. (Default 20) as classically the setup </span>
<span class="sd">			reports optical DEnsity, an OD of 20 would be far above the typically expected</span>
<span class="sd">			OD 1e-3. Pascher instrument software uses a value of 21 to indicate an error.</span>
<span class="sd">		</span>
<span class="sd">		lowervalue : float, optional</span>
<span class="sd">			all values below this number are considered to be corrupted. (Default -20) as classically the setup </span>
<span class="sd">			reports optical DEnsity, an OD of -20 would be far above the typically expected</span>
<span class="sd">			OD 1e-3. Pascher instrument software uses a value of 21 to indicate an error.</span>
<span class="sd">		</span>
<span class="sd">		replace_bad_values : None of float, optional</span>
<span class="sd">			values above the treshold are replaced with this value. Ignored of None (Default)</span>
<span class="sd">			</span>
<span class="sd">		cut_bad_times = bool, optional</span>
<span class="sd">			True (Default) removes the whole time where this is true</span>
<span class="sd">		</span>
<span class="sd">		</span>
<span class="sd">		the value is the upper bound. everything </span>
<span class="sd">		above will be filtered. Standard is to drop the rows(=times) where something went wrong</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		---------</span>
<span class="sd">		</span>
<span class="sd">		typical usage</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plotfunc as pf</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;testfile.SIA&#39;)</span>
<span class="sd">		&gt;&gt;&gt; ta.Filter_data()</span>
<span class="sd">		&gt;&gt;&gt; ta.Filter_data(value=1) #to filter times with at least one point with OD 1</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">uppervalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">uppervalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">lowervalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">lowervalue</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
		
		<span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="p">]:</span>
			<span class="k">if</span> <span class="n">cut_bad_times</span><span class="p">:</span> <span class="c1">#timepoint filter, delete the timepoints where value is stupid</span>
				<span class="n">damaged_times</span><span class="o">=</span><span class="n">dataset</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="o">&gt;</span><span class="n">uppervalue</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
				<span class="n">damaged_times</span><span class="o">=</span><span class="n">dataset</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="n">lowervalue</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">index</span>
				<span class="n">dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">damaged_times</span><span class="p">,</span><span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">replace_bad_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="c1">#individual data filter</span>
				<span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span><span class="n">uppervalue</span><span class="p">]</span><span class="o">=</span><span class="n">replace_bad_values</span>
				<span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&lt;</span><span class="n">lowervalue</span><span class="p">]</span><span class="o">=</span><span class="n">replace_bad_values</span>
			<span class="k">else</span><span class="p">:</span>																 
				<span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&gt;</span><span class="n">uppervalue</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
				<span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">&lt;</span><span class="n">lowervalue</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span></div>
	
	
<div class="viewcode-block" id="TA.Background"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Background">[docs]</a>	<span class="k">def</span> <span class="nf">Background</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowlimit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">uplimit</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">use_median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">correction</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This is the background correction. In general it for each measured </span>
<span class="sd">		wavelength averages the values from &#39;lowlimit&#39; to &#39;uplimit&#39; and </span>
<span class="sd">		subtracts it from the data. It rund on the object (global) or if </span>
<span class="sd">		given a specific ds local. </span>
<span class="sd">		The low and uplimit can be set anywhere to substract any background.</span>
<span class="sd">		It is important to note that many problems during measurements might</span>
<span class="sd">		be visible in the data before time zero. So I recommend to first</span>
<span class="sd">		plot without background correction and only after this inspection </span>
<span class="sd">		apply the background correction. </span>
<span class="sd">		The fit function has its own way to calculcate and apply a background </span>
<span class="sd">		That could be used instead (but making the fit less stable) </span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		------------</span>
<span class="sd">		</span>
<span class="sd">		lowlimit : None or float, optional</span>
<span class="sd">			this is the lower limit from which the average (or median) is taken</span>
<span class="sd">			(Default) is None, in which case the lower limit of the data is used.</span>
<span class="sd">		</span>
<span class="sd">		uplimit : None or float, optional </span>
<span class="sd">			this is the upper limit until which the average (or median) is taken</span>
<span class="sd">			(Default) is -1 (usually ps), in which case the lower limit of the data is used.</span>
<span class="sd">		</span>
<span class="sd">		use_median : bool, optional</span>
<span class="sd">			the Median is a more outlier resistant metric in comparision to </span>
<span class="sd">			the Mean (Average). However the values are not quite as close </span>
<span class="sd">			to the distribution center in case of very few values. False </span>
<span class="sd">			(Default) means the Mean is used</span>
<span class="sd">			</span>
<span class="sd">		ds : None or DataFrame, optional</span>
<span class="sd">			if None (Default) the internal Dataframe self.ds is used, </span>
<span class="sd">			otherwise the pandas DataFrame ds is corrected and returned</span>
<span class="sd">			</span>
<span class="sd">		correction : None or DataFrame, optional</span>
<span class="sd">			this is the correction applied. It must be a DataFrame with </span>
<span class="sd">			the same numbers of columns (spectral points) as the used ds</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		if the object self has the name &quot;ta&quot;</span>
<span class="sd">		</span>
<span class="sd">		typical useage:  		</span>
<span class="sd">				</span>
<span class="sd">		&gt;&gt;&gt; ta.Background()</span>
<span class="sd">		</span>
<span class="sd">		specify inegrated are to - inf (Default) up to -0.5ps and use the Median for computation	</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Background(uplimit = -0.5, use_median = True)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">run_global</span><span class="o">=</span><span class="kc">True</span>
			<span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">run_global</span><span class="o">=</span><span class="kc">False</span>
			<span class="k">if</span> <span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;We must have correction given, to slow otherhwise&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">lowlimit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">use_median</span><span class="p">:</span>
				<span class="n">correction</span><span class="o">=</span><span class="n">ds</span><span class="p">[:</span><span class="n">uplimit</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">correction</span><span class="o">=</span><span class="n">ds</span><span class="p">[:</span><span class="n">uplimit</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">lowlimit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">correction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">use_median</span><span class="p">:</span>
				<span class="n">correction</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="n">lowlimit</span><span class="p">:</span><span class="n">uplimit</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">correction</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="n">lowlimit</span><span class="p">:</span><span class="n">uplimit</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">run_global</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">-</span><span class="n">correction</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">background_par</span><span class="o">=</span><span class="p">[</span><span class="n">lowlimit</span><span class="p">,</span><span class="n">uplimit</span><span class="p">,</span><span class="n">use_median</span><span class="p">,</span><span class="n">correction</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">ds</span><span class="o">-</span><span class="n">correction</span></div>


<div class="viewcode-block" id="TA.Man_Chirp"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Man_Chirp">[docs]</a>	<span class="k">def</span> <span class="nf">Man_Chirp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">shown_window</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">max_points</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">prism</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Triggering of Manuel Fix_Chirp. usually used when Cor_Chirp has run already. </span>
<span class="sd">		Alternatively delete the chirp file. This Function opens a plot in which the user manually selects a number of points</span>
<span class="sd">		These points will then be interpolated with a 4th order polynomial</span>
<span class="sd">		The user can then select a new t=0 point. </span>
<span class="sd">		The first option allows to fine select an intensity setting for this chirp correction.</span>
<span class="sd">		However sometimes spikes are making this things difficult. In this case set a guessed intensity with self.intensity_range=1e-3</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		-------------</span>
<span class="sd">		   </span>
<span class="sd">		path : str or path object (optional)</span>
<span class="sd">			if path is a string without the operation system dependent separator, it is treated as a relative path, </span>
<span class="sd">			e.g. data will look from the working directory in the sub director data. Otherwise this has to be a </span>
<span class="sd">			full path in either strong or path object form.</span>
<span class="sd">		</span>
<span class="sd">		shown_window : list (with two floats), optional</span>
<span class="sd">			Defines the window that is shown during chirp correction. If the t=0 is not visible, adjust this parameter</span>
<span class="sd">			to suit the experiment. If problems arise, I recomment to use Plot_Raw to check where t=0 is located</span>

<span class="sd">		max_points : int, optional</span>
<span class="sd">			Default = 40 max numbers of points to use in Gui selection. Useful option in case no middle mouse button</span>
<span class="sd">			is available. (e.g. touchpad)</span>
<span class="sd">		</span>
<span class="sd">		cmap : matplotlib colourmap, optional</span>
<span class="sd">			Colourmap to be used for the chirp correction. While there is a large selection here I recommend to choose</span>
<span class="sd">			a different map than is used for the normal 2d plotting.\n</span>
<span class="sd">			cm.prism (Default) has proofen to be very usefull</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="n">temp_ds</span> <span class="o">=</span> <span class="n">Fix_Chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">save_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> 
							<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">shown_window</span> <span class="o">=</span> <span class="n">shown_window</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
							<span class="n">path</span> <span class="o">=</span> <span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">max_points</span> <span class="o">=</span> <span class="n">max_points</span><span class="p">)</span> 
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp_ds</span><span class="p">,</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="n">temp_ds</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_chirp.dat&#39;</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Cor_Chirp</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;Man Chirp interrupted&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TA.Cor_Chirp"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Cor_Chirp">[docs]</a>	<span class="k">def</span> <span class="nf">Cor_Chirp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chirp_file</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">shown_window</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">fitcoeff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_points</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">prism</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;*Cor_Chirp* is a powerful Function to correct for a different arrival times of </span>
<span class="sd">		different wavelength (sometimes call chirp). </span>
<span class="sd">		In general if a file is opened for the first time this function is opening </span>
<span class="sd">		a plot and allows the user to select a number of points, which are then </span>
<span class="sd">		approximated with a 4th order polynomial and finally to select a point </span>
<span class="sd">		that is declared as time zero. The observed window as well as the intensities </span>
<span class="sd">		and the colour map can be chosen to enable a good correction. Here a fast </span>
<span class="sd">		iterating colour scheme such as &quot;prism&quot; is often a good choice. In all of the </span>
<span class="sd">		selections a left click selects, a right click removes the last point and </span>
<span class="sd">		a middle click (sometime appreviated by clicking left and right together) </span>
<span class="sd">		finishes the selection. If no middle click exists, the process</span>
<span class="sd">		automatically ends after max_points (40 preset).</span>
<span class="sd">		</span>
<span class="sd">		The first option allows to fine select an intensity setting for this chirp correction.</span>
<span class="sd">		However sometimes spikes are making this things difficult. In this case set a guessed intensity with self.intensity_range=1e-3</span>

<span class="sd">		After the first run the polynom is stored in self.fitcoeff, a new matrix </span>
<span class="sd">		calculated from self.ds_ori that is stored as self.ds and a file stored in the </span>
<span class="sd">		same location as the original data. The second time the function *Cor_Chirp* is </span>
<span class="sd">		run the function will find the file and apply the chirp correction automatically.</span>

<span class="sd">		If one does want to re-run the chirp correction the function *Man_Chirp* does</span>
<span class="sd">		not look for this file, but creates after finishing a new file.</span>

<span class="sd">		Alternatively the polynom or a filename can be given that load a chirp correction</span>
<span class="sd">		(e.g. from a different run with the same sample).</span>
<span class="sd">		The function *Cor_Chirp* selects in the order: </span>

<span class="sd">		# &quot;fitcoeff&quot;</span>
<span class="sd">		# &quot;other files&quot;</span>
<span class="sd">		# &quot;stored_file&quot;</span>
<span class="sd">		# call Man_Chirp (clicking by hand)</span>

<span class="sd">		Parameters</span>
<span class="sd">		-------------</span>
<span class="sd">		</span>
<span class="sd">		chirp-file : None or str, optional</span>
<span class="sd">		   If a raw file was read(e.g. &quot;data.SIA&quot;) and the chirp correction was</span>
<span class="sd">		   completed, a file with the attached word &quot;chirp&quot; is created and</span>
<span class="sd">		   stored in the same location. (&quot;data_chirp.dat&quot;) This file contains</span>
<span class="sd">		   the 5 values of the chirp correction. By selecting such a file</span>
<span class="sd">		   (e.g.from another raw data) a specific chirp is applied. If a</span>
<span class="sd">		   specific name is given with **chirp_file** (and optional **path**)</span>
<span class="sd">		   then this file is used.\n</span>
<span class="sd">		   GUI\n</span>
<span class="sd">		   The word *&#39;gui&#39;* can be used instead of a filename to open a gui that</span>
<span class="sd">		   allows the selection of a chrip file</span>
<span class="sd">		   </span>
<span class="sd">		path : str or path object (optional)</span>
<span class="sd">			if path is a string without the operation system dependent separator, it is treated as a relative path, </span>
<span class="sd">			e.g. data will look from the working directory in the sub director data. Otherwise this has to be a </span>
<span class="sd">			full path in either strong or path object form.</span>
<span class="sd">		</span>
<span class="sd">		shown_window : list (with two floats), optional</span>
<span class="sd">			Defines the window that is shown during chirp correction. If the t=0 is not visible, adjust this parameter</span>
<span class="sd">			to suit the experiment. If problems arise, I recomment to use Plot_Raw to check where t=0 is located</span>
<span class="sd">			</span>
<span class="sd">		fitcoeff : list or vector (5 floats), optional</span>
<span class="sd">			One can give a vector/list with 5 numbers representing the parameter</span>
<span class="sd">			of a 4th order polynomial (in the order</span>
<span class="sd">			:math:`(a4*x^4 + a3*x^3+a2*x^2+a1*x1+a0)`. The chirp parameter are</span>
<span class="sd">			stored in ta.fitcoeff and can thus be used in other TA objects. This</span>
<span class="sd">			vector is also stored with the file and automatically applied during</span>
<span class="sd">			re-loading of a hdf5-object</span>

<span class="sd">		max_points : int, optional</span>
<span class="sd">			Default = 40 max numbers of points to use in Gui selection. Useful option in case no middle mouse button</span>
<span class="sd">			is available. (e.g. touchpad)</span>
<span class="sd">		</span>
<span class="sd">		cmap : matplotlib colourmap, optional</span>
<span class="sd">			Colourmap to be used for the chirp correction. While there is a large selection here I recommend to choose</span>
<span class="sd">			a different map than is used for the normal 2d plotting.\n</span>
<span class="sd">			cm.prism (Default) has proofen to be very usefull</span>

<span class="sd">		Examples</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		In most cases:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf</span>
<span class="sd">		&gt;&gt;&gt; ta = pf.TA(&#39;test1.SIA&#39;) #open the original project, </span>
<span class="sd">		&gt;&gt;&gt; ta.Cor_Chirp()</span>
<span class="sd">		</span>
<span class="sd">		Selecting a specific correction</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Cor_Chirp(gui)</span>
<span class="sd">		&gt;&gt;&gt; ta.Cor_Chirp(chirp_file = &#39;older_data_chirp.dat&#39;)</span>
<span class="sd">		&gt;&gt;&gt; #use the coefficients from a different project</span>
<span class="sd">		&gt;&gt;&gt; ta.Cor_Chirp(fitcoeff = ta_old.fitcoeff) #use the coefficients from a different project</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="n">chirp_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">chirp_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span>
		<span class="k">elif</span> <span class="s1">&#39;gui&#39;</span> <span class="ow">in</span> <span class="n">chirp_file</span><span class="p">:</span>
			<span class="n">root_window</span> <span class="o">=</span> <span class="n">tkinter</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
			<span class="n">root_window</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
			<span class="n">root_window</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">root_window</span><span class="o">.</span><span class="n">focus_force</span><span class="p">())</span>
			<span class="n">complete_path</span> <span class="o">=</span> <span class="n">filedialog</span><span class="o">.</span><span class="n">askopenfilename</span><span class="p">(</span><span class="n">initialdir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
			<span class="n">listen</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">complete_path</span><span class="p">)</span>
			<span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">listen</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">chirp_file</span><span class="o">=</span><span class="n">listen</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">fitcoeff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#we use a stored project</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">)</span><span class="o">==</span><span class="mi">5</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">)</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span><span class="c1">#we provide a valid list/vector</span>
					<span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">elem</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">fitcoeff</span><span class="p">):</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;all chirp coefficients are zero so no chirp correction applied&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>	
						<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="n">Fix_Chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="p">,</span><span class="n">fitcoeff</span><span class="o">=</span><span class="n">fitcoeff</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="o">=</span><span class="n">fitcoeff</span> <span class="c1">#we came to here so fitcoeff must be right</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span>
		  
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;something went wrong with the provided fitcoeff. This should be either a list/array with 5-6 parameter or the object should contain the parameter&#39;</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;fitcoeff is currently:&#39;</span> <span class="o">+</span> <span class="n">fitcoeff</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">=</span><span class="n">Fix_Chirp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">save_file</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">chirp_file</span><span class="p">),</span><span class="n">scattercut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span><span class="n">intensity_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span><span class="n">wave_nm_bin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">shown_window</span><span class="o">=</span><span class="n">shown_window</span><span class="p">,</span><span class="n">fitcoeff</span><span class="o">=</span><span class="n">fitcoeff</span><span class="p">,</span><span class="n">max_points</span><span class="o">=</span><span class="n">max_points</span><span class="p">)</span>
																						  
																			 
				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">chirp_file</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_chirp.dat&#39;</span><span class="p">))</span>
				<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_chirp.dat&#39;</span><span class="p">)):</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;somehting is wrong, try deleting old chirp file&#39;</span><span class="p">)</span>
					<span class="k">raise</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No old chirp file&#39;</span><span class="p">)</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">Man_Chirp</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">shown_window</span><span class="o">=</span><span class="n">shown_window</span><span class="p">,</span><span class="n">max_points</span><span class="o">=</span><span class="n">max_points</span><span class="p">)</span>
					<span class="n">chirp_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span>
					<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">chirp_file</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="TA.Plot_RAW"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Plot_RAW">[docs]</a>	<span class="k">def</span> <span class="nf">Plot_RAW</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
				<span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;result_figures&quot;</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span> <span class="p">,</span> <span class="n">print_click_position</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
				<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This is a wrapper function that triggers the plotting of various RAW (non fitted) plots. </span>
<span class="sd">		The shaping parameter are taken from the object and should be defined before.</span>
<span class="sd">		The parameter in this plot call are to control the general look and features of the plot.</span>
<span class="sd">		Which plots are printed is defined byt the first command (plotting)</span>
<span class="sd">		The plots are generated on the fly using self.ds and all the shaping parameter</span>
<span class="sd">		In all plots the RAW data is plotted as dots and interpolated with lines </span>
<span class="sd">		(using Savitzky-Golay window=5, order=3 interpolation). As defined by the internal parameters </span>
<span class="sd">		at selected time-points and the kinetics for selected wavelength are shaped by the </span>
<span class="sd">		object parameter. The SVD is performed using the same shaping parameter and is commonly </span>
<span class="sd">		used as an orientation for the number of components in the data.</span>
<span class="sd">		Everything is handed over to &#39;plot_raw&#39; function that can be used for extended RAW plotting.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		---------------</span>
<span class="sd">		</span>
<span class="sd">		plotting : int or iterable (of integers), optional</span>
<span class="sd">			This parameter determines which figures are plotted </span>
<span class="sd">			the figures can be called separately with plotting = 1</span>
<span class="sd">			or with a list of plots (Default) e.g. plotting=range(4) calls plots 0,1,2,3.</span>
<span class="sd">			The plots have the following numbers: </span>
<span class="sd">			</span>
<span class="sd">				0. Matrix</span>
<span class="sd">				1. Kinetics</span>
<span class="sd">				2. Spectra</span>
<span class="sd">				3. SVD </span>
<span class="sd">			</span>
<span class="sd">			The plotting takes all parameter from the &quot;ta&quot; object.</span>
<span class="sd">		</span>
<span class="sd">		title : None or str</span>
<span class="sd">			title to be used on top of each plot</span>
<span class="sd">			The (Default) None triggers  self.filename to be used. Setting a specific title as string will.</span>
<span class="sd">			be used in all plots. To remove the title all together set an empty string with this command title=&quot;&quot; .</span>
<span class="sd">		</span>
<span class="sd">		Scale_type : None or str</span>
<span class="sd">			is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">			&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.</span>
<span class="sd">		</span>
<span class="sd">		times : int</span>
<span class="sd">			are the number of components to be used in the SVD (Default) is 6.</span>
<span class="sd">		</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.		</span>
<span class="sd">		</span>
<span class="sd">		filename : str, optional</span>
<span class="sd">			offers to replace the base-name used for all plots (to e.g.~specify what sample was used). </span>
<span class="sd">			if (Default) None is used, the self.filename is used as a base name. The filename plays only a </span>
<span class="sd">			role during saving, as does the path and savetype.</span>
<span class="sd">		</span>
<span class="sd">		path : None or str or path object, optional</span>
<span class="sd">			This defines where the files are saved if the safe_figures_to_folder parameter is True, </span>
<span class="sd">			quite useful if a lot of data sets are to be printed fast. </span>
<span class="sd">			If a path is given, this is used. If a string like the (Default) &quot;result_figures&quot; is given, </span>
<span class="sd">			then a subfolder of this name will be used (an generated if necessary) </span>
<span class="sd">			relative to self.path. Use and empty string to use the self.path</span>
<span class="sd">			If set to None, the location of the plot_func will be used and</span>
<span class="sd">			a subfolder with title &quot;result_figures&quot; be generated here.</span>
<span class="sd">		</span>
<span class="sd">		savetype : str or iterable (of str), optional </span>
<span class="sd">			matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">			typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;.  </span>
<span class="sd">			</span>
<span class="sd">		print_click_position : bool, optional</span>
<span class="sd">			if True then the click position is printed for the spectral plots </span>
<span class="sd">			</span>
<span class="sd">		ds : DataFrame, optional</span>
<span class="sd">			if None (Default), the program first tests self.ds and if this is not there then self.ds_ori.</span>
<span class="sd">			This option was introduced to allow plotting of other matrixes with the same parameter</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		------------</span>
<span class="sd">		</span>
<span class="sd">		Typically one would call this function empty for an overview. We name the object &quot;ta&quot; so with</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;testfile.SIA&#39;) </span>
<span class="sd">		</span>
<span class="sd">		This would trigger the plotting of the 4 mayor plots for an overview.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_RAW()</span>
<span class="sd">		</span>
<span class="sd">		This would plot only the kinetics.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_RAW(1)</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_RAW(plotting = 1)</span>
<span class="sd"> </span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="n">path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="n">path</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plotting</span><span class="p">,</span><span class="s2">&quot;__iter__&quot;</span><span class="p">):</span><span class="n">plotting</span><span class="o">=</span><span class="p">[</span><span class="n">plotting</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="n">filename</span>
		<span class="n">plot_raw</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="p">,</span> <span class="n">plotting</span><span class="o">=</span><span class="n">plotting</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> 
				<span class="n">intensity_range</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_scale</span><span class="p">,</span> <span class="n">baseunit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> 
				<span class="n">timelimits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">scattercut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
				<span class="n">wave_nm_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">rel_wave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span><span class="p">,</span> 
				<span class="n">time_width_percent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">ignore_time_region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">,</span> 
				<span class="n">time_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">,</span> <span class="n">rel_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span><span class="p">,</span> <span class="n">save_figures_to_folder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">,</span> 
				<span class="n">savetype</span><span class="o">=</span><span class="n">savetype</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="n">scale_type</span><span class="p">,</span><span class="n">lintresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lintresh</span><span class="p">,</span> <span class="n">times</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> 
				<span class="n">print_click_position</span> <span class="o">=</span> <span class="n">print_click_position</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> 
				<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="n">plot_second_as_energy</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>


<div class="viewcode-block" id="TA.Save_Plots"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Save_Plots">[docs]</a>	<span class="k">def</span> <span class="nf">Save_Plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;result_figures&#39;</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> 
					<span class="n">patches</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Convenience function that sets save_plots_to_folder temporarily to true and replots everything</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		path : None, str or path, optional</span>
<span class="sd">			(Default) None, if left on None, then a folder &quot;result_figures&quot; is created in the folder </span>
<span class="sd">			of the data (self.path)</span>
<span class="sd">		</span>
<span class="sd">		savetype : str or iterable (of str), optional </span>
<span class="sd">			matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">			typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;. </span>
<span class="sd">			</span>
<span class="sd">		title : None or str, optional</span>
<span class="sd">			(Default) None, Use this title on all plots. if None, use self.filename</span>
<span class="sd">			</span>
<span class="sd">		filename : str, optional</span>
<span class="sd">			(Default) None, Base name for all plots. If None, then self.filename will be used</span>
<span class="sd">			</span>
<span class="sd">		scale_type : str, optional</span>
<span class="sd">			&quot;symlog&quot; (Default), &quot;linear&quot;, &quot;log&quot; time axis</span>
<span class="sd">			</span>
<span class="sd">		patches : bool, optional</span>
<span class="sd">			For true use white patches to label things in the 2d matrixes, to safe</span>
<span class="sd">			space for publication</span>
<span class="sd">			</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		---------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_Plots()</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_Plots(patches = True)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">savetype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">savetype</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">savetype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">,</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span><span class="s1">&#39;svg&#39;</span><span class="p">]:</span><span class="n">savetype</span><span class="o">=</span><span class="p">[</span><span class="n">savetype</span><span class="p">]</span>
		<span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">savetype</span><span class="p">,</span><span class="s2">&quot;__iter__&quot;</span><span class="p">):</span><span class="n">savetype</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">savetype</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please specify a single filetype from </span><span class="se">\&#39;</span><span class="s1">png</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">pdf</span><span class="se">\&#39;</span><span class="s1">,</span><span class="se">\&#39;</span><span class="s1">svg</span><span class="se">\&#39;</span><span class="s1"> or a list of those. Nothing was saved&#39;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="n">standard_map</span>
		<span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="kc">True</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">:</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Plot_RAW</span><span class="p">(</span><span class="n">savetype</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
								<span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saved RAW plots type </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving of Raw plots for filetype </span><span class="si">%s</span><span class="s1"> failed&#39;</span><span class="o">%</span><span class="n">t</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">:</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Plot_fit_output</span><span class="p">(</span><span class="n">savetype</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">scale_type</span><span class="o">=</span><span class="n">scale_type</span><span class="p">,</span><span class="n">patches</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved Fit plots of type </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)))</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving of Fit plots for filetype </span><span class="si">%s</span><span class="s1"> failed&#39;</span><span class="o">%</span><span class="n">t</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="n">origin</span></div>


	<span class="k">def</span> <span class="nf">__Fit_Chirp_inner</span><span class="p">(</span>	<span class="bp">self</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">,</span> <span class="n">initial_fit_coeff</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
							<span class="n">timelimits</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ds_back_corr</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39; Function to calculate a new chirp corrected matrix and return an error value,  The &quot;cost function&quot; for the chirp optimization </span>
<span class="sd">		&#39;&#39;&#39;</span>
		<span class="n">fitcoeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
		<span class="c1">#fitcoeff = __shift_polynom(fitcoeff, -500) #this was an arbitrary shift of the data by 500 to make the chirp parameter </span>
		<span class="n">time</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the time</span>
		<span class="n">ds_new</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">fitcoeff</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">xp</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
		<span class="n">re</span> <span class="o">=</span> <span class="n">err_func</span><span class="p">(</span><span class="n">paras</span> <span class="o">=</span> <span class="n">params</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_new</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">mod</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="n">log_fit</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">re</span>
		
		
	<span class="k">def</span> <span class="nf">__Fit_Chirp_outer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pardf</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">fit_ds</span><span class="p">,</span> <span class="n">fit_chirp_iterations</span><span class="p">,</span> <span class="n">mod</span><span class="p">,</span> <span class="n">deep_iteration</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;Broken out Chirp optimization,  takes the fitted parameters and performs &#39;fit_chirp_iterations&#39; times the loop,  </span>
<span class="sd">		(optimise chirp + optimize global) after each global iteration the error is compared to the previous. It continues until no improvement is made or </span>
<span class="sd">		until the &#39;fit_chirp_iterations&#39; is reached. If the error is reduced by more than a factor of 100 in a single step,  it is assumed that something fishy is going on and we restart the fit,  but with a 10x smaller simplex stepsize and deep_iteraction FAlse</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		-----------</span>
<span class="sd">		pardf</span>
<span class="sd">					# deep_iteration uses the previous kinetic optimized parameter as the input into the next fit. </span>
<span class="sd">			#Can be great but can also run away, in general not needed and can be triggered by feeding the </span>
<span class="sd">			#results back into the global fit&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
			<span class="n">initial_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">results</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
			<span class="n">par_into_chirpfit</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">initial_error</span> <span class="o">=</span> <span class="p">[</span><span class="n">err_func</span><span class="p">(</span><span class="n">paras</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">fit_ds</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">)]</span>
			<span class="n">par_into_chirpfit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">par</span>
		<span class="n">par_into_chirpfit</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="n">initial_fit_coeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_fit_coeff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
			<span class="n">initial_fit_coeff</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
			<span class="n">initial_fit_coeff</span> <span class="o">=</span> <span class="n">initial_fit_coeff</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
		<span class="n">chirp_par</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
															   
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
			<span class="n">chirp_par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;p</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">i</span><span class="p">),</span> <span class="n">value</span> <span class="o">=</span> <span class="n">initial_fit_coeff</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="nb">min</span> <span class="o">=</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span><span class="c1">#lets send in the background corrected matrix fails if no prior background was done</span>
			<span class="n">correction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_par</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
			<span class="n">ds_back_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">-</span><span class="n">correction</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="n">ds_back_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span>
		<span class="n">ds_back_corr</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">)</span>																	   
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before chirpfit the error is:</span><span class="si">{:.6e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
		
		<span class="c1">#################################################################################################################</span>
		<span class="c1">#----Chirp fit loop---------------------------------------------------------------------------------</span>
		<span class="c1">#################################################################################################################</span>
		
		<span class="k">for</span> <span class="n">loop</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fit_chirp_iterations</span><span class="p">):</span>
			
			<span class="n">chirpmini</span>  <span class="o">=</span>  <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__Fit_Chirp_inner</span><span class="p">,</span> <span class="n">chirp_par</span><span class="p">,</span> 
											<span class="n">fcn_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ds_back_corr&#39;</span><span class="p">:</span><span class="n">ds_back_corr</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s1">&#39;initial_fit_coeff&#39;</span><span class="p">:</span><span class="n">initial_fit_coeff</span><span class="p">,</span> 
														<span class="s1">&#39;params&#39;</span><span class="p">:</span><span class="n">par_into_chirpfit</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span> 
														<span class="s1">&#39;scattercut&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="s1">&#39;bordercut&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
														<span class="s1">&#39;timelimits&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="s1">&#39;wave_nm_bin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> 
														<span class="s1">&#39;time_bin&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">})</span> 
			<span class="n">step_size</span> <span class="o">=</span> <span class="mf">5e-2</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">start</span>  <span class="o">=</span>  <span class="n">tm</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
				<span class="n">simp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">chirp_par</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
				<span class="n">simp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">simp</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
							<span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">step_size</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.1</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">simp</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>	
				<span class="c1">#we start by optimizing the chirp with fixed Global fit</span>
				<span class="n">chirp_results</span>  <span class="o">=</span>  <span class="n">chirpmini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span>  <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;maxfev&#39;</span><span class="p">:</span><span class="mf">1e4</span><span class="p">,</span> <span class="s1">&#39;fatol&#39;</span><span class="p">:</span><span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-6</span><span class="p">,</span> <span class="s1">&#39;initial_simplex&#39;</span><span class="p">:</span><span class="n">simp</span><span class="p">})</span>
				<span class="n">end</span>  <span class="o">=</span>  <span class="n">tm</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
				<span class="n">opt_coeff</span> <span class="o">=</span> <span class="n">chirp_results</span><span class="o">.</span><span class="n">params</span>
				<span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">opt_coeff</span><span class="p">[</span><span class="s1">&#39;p0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
				<span class="c1">#Create the new chirp corrected data</span>
				<span class="n">time</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the time		 </span>
				<span class="n">new_ds</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span> <span class="n">xp</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="c1">#New Global Fit</span>
				<span class="n">fit_ds_loop</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="n">new_ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">)</span>	
				<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>							 
					<span class="n">mini</span>  <span class="o">=</span>  <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">err_func</span><span class="p">,</span> <span class="n">par_into_chirpfit</span><span class="p">,</span> <span class="n">fcn_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span><span class="n">fit_ds_loop</span><span class="p">,</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span> <span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span> <span class="s1">&#39;final&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
					<span class="n">results_in_chirp</span>  <span class="o">=</span>  <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">})</span>
					<span class="n">initial_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results_in_chirp</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">initial_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">err_func</span><span class="p">(</span><span class="n">paras</span> <span class="o">=</span> <span class="n">par_into_chirpfit</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">fit_ds_loop</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">mod</span><span class="p">,</span> <span class="n">final</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">log_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">))</span>	
				<span class="k">if</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span>
					<span class="k">if</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">100</span><span class="p">:</span><span class="c1">#something fishy going on. lets try again</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Chirp_loop </span><span class="si">{:02d}</span><span class="s1"> strange decrease step size&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loop</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
						<span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
						<span class="n">step_size</span> <span class="o">=</span> <span class="n">step_size</span><span class="o">/</span><span class="mi">100</span>
						<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">initial_error</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
							<span class="k">if</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="c1">#we have run this trick now three times,  time to break</span>
								<span class="k">raise</span> <span class="ne">StopIteration</span>
						<span class="n">deep_iteration</span><span class="o">=</span><span class="kc">False</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Chirp_loop </span><span class="si">{:02d}</span><span class="s1"> resulted in   :</span><span class="si">{:.8e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loop</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
						<span class="k">if</span> <span class="n">deep_iteration</span><span class="p">:</span>			<span class="c1">#This results in a very deep iteration of the starting parameter</span>
							<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
								<span class="n">par_into_chirpfit</span> <span class="o">=</span> <span class="n">results_in_chirp</span><span class="o">.</span><span class="n">params</span>				
						<span class="n">chirp_par</span> <span class="o">=</span> <span class="n">chirp_results</span><span class="o">.</span><span class="n">params</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">StopIteration</span>
			<span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration is not smaller finished chirp looping&#39;</span><span class="p">)</span>
				<span class="k">break</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failure in chirp optimisation in iteration </span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">loop</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
				<span class="kn">import</span> <span class="nn">sys</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span>  <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">initial_error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial_error</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="c1">#to avoid that numbers are written</span>
				<span class="k">break</span>
		
		<span class="c1">#################################################################################################################</span>
		<span class="c1">#-----------------------------------------end chrip fit loop-------------------------------------------------</span>
		<span class="c1">#################################################################################################################</span>
		
		<span class="k">if</span> <span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">initial_error</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="c1">#lets check if we improved anything</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;chirp fit improved error by </span><span class="si">%.2g</span><span class="s1"> percent&#39;</span><span class="o">%</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">initial_error</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">initial_error</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">))):</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span> <span class="o">=</span> <span class="n">temp</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span>
			<span class="n">time</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span><span class="c1">#extract the time</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds_back_corr</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">time</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)),</span> <span class="n">xp</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">fp</span> <span class="o">=</span> <span class="n">x</span><span class="p">),</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">raw</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>			 
			<span class="n">fit_ds</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">time_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
				<span class="n">results</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">results_in_chirp</span><span class="o">.</span><span class="n">params</span>
		<span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">fit_ds</span>
		
		
<div class="viewcode-block" id="TA.Fit_Global"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Fit_Global">[docs]</a>	<span class="k">def</span> <span class="nf">Fit_Global</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">confidence_level</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_ampgo</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fit_chirp</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fit_chirp_iterations</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">multi_project</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">unique_parameter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dump_paras</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ext_spectra</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;This function is performing a global fit of the data. As embedded object it uses </span>
<span class="sd">		the parameter control options of the lmfit project as an essential tool. </span>
<span class="sd">		(my thanks to Matthew Newville and colleagues for creating this phantastic tool) </span>
<span class="sd">		[M. Newville, T. Stensitzki, D. B. Allen, A. Ingargiola, 2014. DOI: 10.5281/ZENODO.11813.]. </span>
<span class="sd">		The what type of fitting is performed is controlled by setting of the parameter here.</span>
<span class="sd">		</span>
<span class="sd">		The general fitting follows this routine:</span>
<span class="sd">			1. 	create a copy of the Data-Matrix self.ds is created with the shaping parameters</span>
<span class="sd">			2. 	Then a Matrix is created that represents the fractional population of each species </span>
<span class="sd">				(or processes in case of the paral model). </span>
<span class="sd">				This Matrix contains one entry for each timepoint and represents the kinetic model </span>
<span class="sd">				based upon the starting parameter. (see below for a description of the models). </span>
<span class="sd">				This model formation can by done by using a build in or a user supplied function. </span>
<span class="sd">				(handled in the function &quot;pf.build_c&quot;)</span>
<span class="sd">				-&gt; If an ext_spectra is provided this its intensity is substacted from the matrix (only for external models)</span>
<span class="sd">			3. 	Then the process/species associated spectra for each of the species is calculated </span>
<span class="sd">				using the linalg.lstsq algorithm from numpy </span>
<span class="sd">				(https://numpy.org/doc/stable/reference/generated/numpy.linalg.lstsq.html)</span>
<span class="sd">			4. 	From the convoluted calculated species concentrations and spectra a calculated matrix </span>
<span class="sd">				is formed (handled in the function &quot;pf.fill_int&quot;)</span>
<span class="sd">			5. 	The difference between calculated and measured spectra is calculated, point-wise squared </span>
<span class="sd">				and summed together. (function &quot;err_func&quot; or &quot;err_func_multi&quot; if multiple datasets are fitted)</span>
<span class="sd">			6. 	This difference is minimized by iterating 2-4 with changing parameters using an </span>
<span class="sd">				optimization algorithm (generally nelder-mead simplex)</span>
<span class="sd">			7. 	Finally in a last run of 2-5 the final spectra are calculated (using the &quot;final&quot; flag) </span>
<span class="sd">				and the optimized parameter, the matrixes </span>
<span class="sd">				(&quot;A&quot;-measured, &quot;AC&quot; - calculated, &quot;AE&quot; - linear error), </span>
<span class="sd">				spectra (always called &quot;DAS&quot;) the concentrations (called &quot;c&quot;) </span>
<span class="sd">				are written in the dictionary &quot;ta.re&quot; together with a few result representations </span>
<span class="sd">				and other fit outputs. The optimized parameter are also written into ta.par_fit </span>
<span class="sd">				(as an parameter object) that can be re-used as input into further optimization steps.</span>
<span class="sd">				</span>
<span class="sd">		All mandatory parameters are in general taken from the internal oject (self) The optional parameter control the behaviour of the fitting function  </span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		------------------</span>
<span class="sd">			</span>
<span class="sd">			par : lmfit parameter oject, optional</span>
<span class="sd">				Here another parameter object could be given,overwriting the (Default is self.par) </span>
<span class="sd">				</span>
<span class="sd">			mod : str or function, optional</span>
<span class="sd">				Give a extra model selection (Default uses self.mod)</span>
<span class="sd">				internal modells: &#39;paral&#39;,&#39;exponential&#39;,&#39;consecutive&#39;,&#39;full_consecutive&#39;</span>
<span class="sd">				see also :meth:`plot_func.build_c` and :meth:`plot_func.err_func`</span>
<span class="sd">				</span>
<span class="sd">			confidence_level: None or float (0.5-1), optional</span>
<span class="sd">				If this is changed from None (Default) to a value between 0.5 and 1 the code will</span>
<span class="sd">				try to calculate the error of the parameter for the fit. For each parameter that </span>
<span class="sd">				can vary a separate optimization is	performed, that attempts to find the upper </span>
<span class="sd">				and lower bound at which the total error of the re-optimized globally fitted results</span>
<span class="sd">				reaches the by F-statistics defined confidence bound. See :meth:`plot_func.s2_vs_smin2` for details </span>
<span class="sd">				on how this level is determined. Careful, this option might run for very long time.</span>
<span class="sd">				Meaning that it typically takes 50 optimization per variable parameter (hard coded limit 200)</span>
<span class="sd">				The confidence level is to be understood that it defines the e.g. 0.65 * 100\% area that the</span>
<span class="sd">				parameter with this set of values is within this bounds.</span>
<span class="sd">			</span>
<span class="sd">			use_ampgo : bool, optional</span>
<span class="sd">				(Default) is False</span>
<span class="sd">				Changes the optimizer from a pure Nelder mead to Ampgo with a local Nelder Mead. </span>
<span class="sd">				For using this powerfull tool all parameter need to have a &quot;min&quot; and a &quot;max&quot; set. </span>
<span class="sd">				Typically takes 10-40x longer than a standard optimization, but can due to its </span>
<span class="sd">				tunneling algorithm more reliably find global minima. </span>
<span class="sd">				see:https://lmfit.github.io/lmfit-py/fitting.html for further details</span>
<span class="sd">			</span>
<span class="sd">			fit_chirp : bool, optional</span>
<span class="sd">				(Default) is False</span>
<span class="sd">				a powerful optimization of the chirp parameter. For this to work the data </span>
<span class="sd">				needs to include timepoints before and after t=0 and one should have reached </span>
<span class="sd">				a decent fit of most features in the spectrum. We perform an Nelder-Mead optimisation </span>
<span class="sd">				of the parameter followed by a Nelder-Mead optimization of the chirp parameter </span>
<span class="sd">				as one iteration. After each consecutive optimization it is checked if the total error </span>
<span class="sd">				improved. If not the fit is ended, if yes the maximum number of iterations </span>
<span class="sd">				&#39;fit_chirp_iterations&#39; is performed. Warning, this goes well in many cases, </span>
<span class="sd">				but can lead to very strange results in others, always carefully check the results.</span>
<span class="sd">				I recommend to make a copy of the object before runnning a chirp optimization.</span>
<span class="sd">			</span>
<span class="sd">			fit_chirp_iterations : int, optional</span>
<span class="sd">				maximum number of times the global - chirp loop is repeated. </span>
<span class="sd">				Typically this iterations run 2-5 times, (Default) is 10</span>
<span class="sd">			</span>
<span class="sd">			dump_paras : bool, optional</span>
<span class="sd">				(Default) is False, If True creates two files in the working folder, one with the </span>
<span class="sd">				currently used parameter created at the end of each optimisation step, and one with</span>
<span class="sd">				the set of parameter that up to now gave the lowest error. Intented to store</span>
<span class="sd">				the optimisation results if the fit needs to be interrupted </span>
<span class="sd">				(if e.g. Ampgo simply needs to long to optimize.) useful option if things are slow</span>
<span class="sd">				this parameter also triggers the writing of fitout to a textfile on disc</span>
<span class="sd">			</span>
<span class="sd">			filename : None or str, optional</span>
<span class="sd">				Only used in conjunction with &#39;dump_paras&#39;. The program uses this filename to dump the </span>
<span class="sd">				parameter to disk </span>
<span class="sd">			</span>
<span class="sd">			multi_project : None or list (of TA projects), optional</span>
<span class="sd">				This switch is triggering the simultaneous optimisation of multiple datasets.  </span>
<span class="sd">				multi_project is as (Default) None. it expects an iterable (typically list) with other </span>
<span class="sd">				TA projects (like ta) that are then optimised with the same parameter. </span>
<span class="sd">				This means that all projects get the same parameter object for each iteration </span>
<span class="sd">				of the fit and return their individual error, which is summed linearly. </span>
<span class="sd">				The &quot;weights&quot; option allows to give each multi_project a specific weight (number) </span>
<span class="sd">				that is multiplied to the error. If the weight object has the same number of items </span>
<span class="sd">				as the multi_project it is assumed that the triggering object (the embedded project) </span>
<span class="sd">				has the weight of 1, otherwise the first weight is for the embedded project. </span>
<span class="sd">				The option &#39;unique_parameter&#39; takes (a list) of parameter that are not </span>
<span class="sd">				to be shared between the projects (and that are not optimized either) </span>
<span class="sd">				The intended use of this is to give e.g. the pump power for multiple experiments to </span>
<span class="sd">				study non linear behaviour. Returned will be only the parameter set for the optimium</span>
<span class="sd">				combination of all parameter. Internally, we iterate through the projects and calculate </span>
<span class="sd">				for each project the error for each iteration. Important to note is that currently this </span>
<span class="sd">				means that each DAS/SAS is calculated independently! For performing the same calculation</span>
<span class="sd">				with a single DAS, the Matrixes need to be concatenated before the run and an external</span>
<span class="sd">				function used to create a combined model. As this is very difficult to implement reliably</span>
<span class="sd">				For general use (think e.g. different pump wavelength) this has to be done manually. </span>
<span class="sd">			</span>
<span class="sd">			unique_parameter : None or str or list (of strings), optional </span>
<span class="sd">				only used in conjunction with &#39;multi_project&#39;, it takes (a list) of parameter that </span>
<span class="sd">				are not to be shared between the projects (and that are not optimized either) </span>
<span class="sd">				The intended use of this is to give e.g. the pump power for multiple experiments </span>
<span class="sd">				to study non linear behaviour. (Default) None</span>
<span class="sd">			</span>
<span class="sd">			weights : list of floats, optional</span>
<span class="sd">				only used in conjunction with &#39;multi_project&#39;. The &quot;weights&quot; option allows to </span>
<span class="sd">				give each multi\_project a specific weight (number) that is multiplied to the error. </span>
<span class="sd">				If the weight object has the same number of items as the &#39;multi_project&#39; it is assumed </span>
<span class="sd">				that ta (the embedded project) has the weight of 1, otherwise the first weight is for the </span>
<span class="sd">				embedded object</span>
<span class="sd">				</span>
<span class="sd">			ext_spectra : DataFrame, optional</span>
<span class="sd">				(Default) is None, if given substract this spectra from the DataMatrix using the intensity </span>
<span class="sd">				given in &quot;C(t)&quot; this function will only work for external models. The name of the spectral column </span>
<span class="sd">				must be same as the name of the column used. If not the spectrum will be ignored. The spectrum will </span>
<span class="sd">				be interpolated to the spectral points of the model ds before the substraction. </span>

<span class="sd">		Returns</span>
<span class="sd">		------------------</span>
<span class="sd">		</span>
<span class="sd">		re : dict</span>
<span class="sd">			the dictionary &quot;re&quot; attached to the object containing all the matrixes and parameter. </span>
<span class="sd">			The usual keys are:</span>
<span class="sd">			&quot;A&quot; Shaped measured Matrix</span>
<span class="sd">			&quot;AC&quot; Shaped calculated Matrix </span>
<span class="sd">			&quot;AE&quot; Difference between A and AC = linear error </span>
<span class="sd">			&quot;DAS&quot; DAS or SAS, labeled after the names given in the function (the columns of c) Care must be taken that this mesured intensity is C * DAS, the product. For exponential model the concentrations are normalized</span>
<span class="sd">			&quot;c&quot; The Concentrations (meaning the evolution of the concentrations over time. Care must be taken that this mesured intensity is C * DAS, the product. For exponential model the concentrations are normalized</span>
<span class="sd">			&quot;fit_results_rates&quot; DataFrame with the fitted rates (and the confidence intervals if calculated)</span>
<span class="sd">			&quot;fit_results_times&quot; DataFrame with the fitted decay times (and the confidence intervals if calculated)</span>
<span class="sd">			&quot;fit_output&quot; The Fit object as returned from lmfit. (This is not saved with the project!)</span>
<span class="sd">			&quot;error&quot; is the S2, meaning AE**2.sum().sum()</span>
<span class="sd">			&quot;r2&quot;=1-&quot;error&quot;/((&#39;A&#39;-&#39;A&#39;.mean())**2).sum(), so the residuals scaled with the signal size</span>
<span class="sd">		</span>
<span class="sd">		par_fit : lmfit parameter object</span>
<span class="sd">			is written into the object as a lmfit parameter object with the optimized results (that can be use further)</span>
<span class="sd">		</span>
<span class="sd">		fitcoeff : list, if chirpfit is done</span>
<span class="sd">			The chirp parameter are updated</span>
<span class="sd">		</span>
<span class="sd">		ds : DataFrame, if chirpfit is done</span>
<span class="sd">			A new ds is calculated form ds_ori if ChripFit is done</span>
<span class="sd">			</span>
<span class="sd">		The rest is mainly printed on screen.</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------------------</span>
<span class="sd">		</span>
<span class="sd">		Non optional:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;testfile.SIA&#39;) #load data</span>
<span class="sd"> 		&gt;&gt;&gt; ta.mod=&#39;exponential&#39;    #define model</span>
<span class="sd">		&gt;&gt;&gt; ta.par=lmfit.Parameters()  #create empty parameter object</span>
<span class="sd">		&gt;&gt;&gt; ta.par.add(&#39;k0&#39;,value=1/0.1,vary=True) #add at least one parameter to optimize</span>
<span class="sd">		  </span>
<span class="sd">		Trigger simple fit:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Fit_Global()</span>
<span class="sd">		</span>
<span class="sd">		Trigger fit with Chrip Fit:</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Fit_Global(fit_chirp=True)</span>
<span class="sd">		</span>
<span class="sd">		Trigger iterative Chirp fitting with fresh refinement of the Global kinetic parametersfor i in range(5):</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; for i in range(5):</span>
<span class="sd">		&gt;&gt;&gt; 	start_error=ta.re[&#39;error&#39;]</span>
<span class="sd">		&gt;&gt;&gt; 	ta.par=ta.par_fit</span>
<span class="sd">		&gt;&gt;&gt; 	ta.Fit_Global(fit_chirp=True)</span>
<span class="sd">		&gt;&gt;&gt; 	if not ta.re[&#39;error&#39;] &lt; start_error:break</span>
<span class="sd">		</span>
<span class="sd">		Trigger fit fit error calculations</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Fit_Global(confidence_level=0.66)</span>
<span class="sd">		</span>
<span class="sd">		Trigger fit of multiple projects</span>
<span class="sd">		#use the GUI_open function to open a list of objects (leave empty for using the GUI)</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; other_projects=pf.GUI_open([&#39;sample_1.hdf5&#39;,&#39;sample_2.hdf5&#39;],path=&#39;Data&#39;)</span>
<span class="sd">		&gt;&gt;&gt; ta.Fit_Global(multi_project=other_projects)</span>
<span class="sd">		</span>
<span class="sd">		</span>
<span class="sd">		For more examples please see the complete documentation under :ref:`Fitting, Parameter optimization and Error estimation`</span>
<span class="sd">		or :ref:`Fitting multiple measured files at once`</span>
<span class="sd">		&quot;&quot;&quot;</span>

		<span class="k">if</span> <span class="n">par</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">par</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par</span>
		<span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">t0</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">min</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">resolution</span><span class="o">=</span><span class="n">par</span><span class="p">[</span><span class="s1">&#39;resolution&#39;</span><span class="p">]</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;resolution&#39;</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mf">0.086</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">par</span><span class="p">[</span><span class="s1">&#39;infinite&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span>
			<span class="n">par</span><span class="p">[</span><span class="s1">&#39;infinite&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">par</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span>
			<span class="n">par</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		
		<span class="n">pardf</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="n">par</span><span class="p">)</span>
		<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">),</span><span class="s1">&#39;min&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
		<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">),</span><span class="s1">&#39;max&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>

		<span class="n">pardf</span><span class="p">[</span><span class="s1">&#39;init_value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">dump_paras</span><span class="p">:</span>
			<span class="n">pardf_temp</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
			<span class="n">pardf_temp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1000</span>
			<span class="n">pardf_temp</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;minimal_dump_paras.par&#39;</span><span class="p">)</span>
	
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>	
		
		<span class="c1">#create-shape the data to be fitted	</span>
		<span class="n">fit_ds</span><span class="o">=</span><span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">scattercut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span><span class="n">bordercut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span><span class="n">timelimits</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span><span class="n">wave_nm_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span><span class="n">time_bin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">,</span><span class="n">ignore_time_region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">,</span><span class="n">drop_scatter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">drop_ignore</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">time_label</span><span class="o">=</span><span class="n">fit_ds</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>
		<span class="n">energy_label</span><span class="o">=</span><span class="n">fit_ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span>
		
		<span class="c1">############################################################################</span>
		<span class="c1">#----Global optimisation------------------------------------------------------</span>
		<span class="c1">############################################################################</span>
		
		<span class="k">if</span> <span class="n">multi_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="c1">#check if there is any concentration to optimise</span>
			<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span><span class="c1">#ok we have something to optimize</span>
				<span class="n">mini</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">err_func</span><span class="p">,</span><span class="n">pardf_to_par</span><span class="p">(</span><span class="n">pardf</span><span class="p">),</span>
										<span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span><span class="n">fit_ds</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span><span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="s1">&#39;final&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;dump_paras&#39;</span><span class="p">:</span><span class="n">dump_paras</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;ext_spectra&#39;</span><span class="p">:</span><span class="n">ext_spectra</span><span class="p">})</span>
				<span class="k">if</span> <span class="ow">not</span> <span class="n">use_ampgo</span><span class="p">:</span>
					<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;we use adaptive mode for nelder&#39;</span><span class="p">)</span>
						<span class="n">results</span> <span class="o">=</span> <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">,</span><span class="s1">&#39;adaptive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">results</span> <span class="o">=</span> <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">})</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">results</span> <span class="o">=</span> <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;ampgo&#39;</span><span class="p">,</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;local&#39;</span><span class="p">:</span><span class="s1">&#39;Nelder-Mead&#39;</span><span class="p">})</span>
					
		<span class="c1">############################################################################</span>
		<span class="c1">#----Multi project	Global optimisation----------------------------------------</span>
		<span class="c1">##########################################################################</span>
		
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fit_chirp</span><span class="o">=</span><span class="kc">False</span> <span class="c1">#chirp fitting currently only works for single problems</span>
			<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span><span class="c1">#ok we have something to optimize lets return the spectra</span>
				<span class="n">multi_project</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
				<span class="n">mini</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">err_func_multi</span><span class="p">,</span><span class="n">pardf_to_par</span><span class="p">(</span><span class="n">pardf</span><span class="p">),</span><span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;multi_project&#39;</span><span class="p">:</span><span class="n">multi_project</span><span class="p">,</span><span class="s1">&#39;unique_parameter&#39;</span><span class="p">:</span><span class="n">unique_parameter</span><span class="p">,</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="n">weights</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span><span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="s1">&#39;final&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s1">&#39;dump_paras&#39;</span><span class="p">:</span><span class="n">dump_paras</span><span class="p">,</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;ext_spectra&#39;</span><span class="p">:</span><span class="n">ext_spectra</span><span class="p">})</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;we use adaptive mode for nelder&#39;</span><span class="p">)</span>
					<span class="n">results</span> <span class="o">=</span> <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">,</span><span class="s1">&#39;adaptive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">results</span> <span class="o">=</span> <span class="n">mini</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">})</span>
					
		<span class="c1">#######################################################################</span>
		<span class="c1">#----Fit chirp----------------------------------------------------------------------------------</span>
		<span class="c1">####################################################################</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
			<span class="k">if</span> <span class="n">fit_chirp</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sorry but currently you can not both ignore a time region and fit the chirp (assuming that you ignore the time-zero region)&#39;</span><span class="p">)</span>
			<span class="n">fit_chirp</span><span class="o">=</span><span class="kc">False</span>
		<span class="k">if</span> <span class="n">fit_chirp</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done initial fitting now chirpfit&#39;</span><span class="p">)</span>
			<span class="n">results</span><span class="p">,</span><span class="n">fit_ds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__Fit_Chirp_outer</span><span class="p">(</span><span class="n">pardf</span><span class="p">,</span><span class="n">results</span><span class="p">,</span><span class="n">fit_ds</span><span class="p">,</span><span class="n">fit_chirp_iterations</span><span class="p">,</span><span class="n">mod</span><span class="p">)</span>
			
			
		<span class="c1">####################################################################</span>
		<span class="c1">#------Write results to parameter------------------------</span>
		<span class="c1">############################################################</span>
		
		<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span><span class="c1">#we actually have optimised something</span>
			<span class="n">pardf</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">)[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">10</span><span class="o">**</span><span class="n">x</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="o">=</span><span class="n">pardf_to_par</span><span class="p">(</span><span class="n">pardf</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ATTENTION: we have not optimized anything but just returned the parameters&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par</span>
		<span class="k">if</span> <span class="n">multi_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">re</span><span class="o">=</span><span class="n">err_func</span><span class="p">(</span><span class="n">paras</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="p">,</span><span class="n">ds</span><span class="o">=</span><span class="n">fit_ds</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span><span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">log_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">=</span><span class="n">ext_spectra</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">re</span><span class="o">=</span><span class="n">err_func_multi</span><span class="p">(</span><span class="n">paras</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">final</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">log_fit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="n">multi_project</span><span class="o">=</span><span class="n">multi_project</span><span class="p">,</span><span class="n">unique_parameter</span><span class="o">=</span><span class="n">unique_parameter</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">=</span><span class="n">ext_spectra</span><span class="p">)</span>
		
		<span class="c1">############################################################################</span>
		<span class="c1">#----Estimate errors---------------------------------------------------------------------</span>
		<span class="c1">############################################################################</span>
		
		<span class="k">if</span> <span class="n">confidence_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span><span class="c1">#ok we calculate errors to the level of the confidence_level</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">]:</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span><span class="c1">#we actually have optimised something</span>
				<span class="k">if</span> <span class="p">(</span><span class="mf">0.6</span> <span class="o">&lt;</span> <span class="n">confidence_level</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">confidence_level</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">multi_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">target</span><span class="o">=</span><span class="n">s2_vs_smin2</span><span class="p">(</span><span class="n">Spectral_points</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="n">Time_points</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="n">number_of_species</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="n">fitted_kinetic_pars</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="n">target_quality</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">multi_project</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
						<span class="c1"># we assume that we have the same number of spectal points but are stacking the times</span>
						<span class="n">total_time_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">multi_project</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>					
						<span class="n">target</span><span class="o">=</span><span class="n">s2_vs_smin2</span><span class="p">(</span><span class="n">Spectral_points</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="n">Time_points</span><span class="o">=</span><span class="n">total_time_points</span><span class="p">,</span><span class="n">number_of_species</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="n">fitted_kinetic_pars</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">),</span><span class="n">target_quality</span><span class="o">=</span><span class="n">confidence_level</span><span class="p">)</span>
					<span class="c1">#print(target)</span>
					<span class="n">target_s2</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">target</span>
					<span class="n">list_of_variable_parameter</span><span class="o">=</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
					<span class="n">conf_limits</span><span class="o">=</span><span class="p">{}</span>
					<span class="n">iterative_calls</span><span class="o">=</span><span class="mi">0</span>
					<span class="k">for</span> <span class="n">fixed_par</span> <span class="ow">in</span> <span class="n">list_of_variable_parameter</span><span class="p">:</span>
						<span class="n">conf_limits</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;upper&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;lower&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span><span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
							<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trying to find </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1"> confidence limit&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">fixed_par</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
							<span class="n">pardf_local</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par_fit</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
							<span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">vary</span><span class="o">=</span><span class="kc">False</span>
							<span class="n">par_local</span><span class="o">=</span><span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
							<span class="k">if</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span><span class="c1">#go below min</span>
								<span class="k">if</span> <span class="n">par_to_pardf</span><span class="p">(</span><span class="n">pardf_local</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">,</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]:</span>
									<span class="n">par_local</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fixed_par</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="mf">0.95</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">par_local</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fixed_par</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="mf">0.95</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
							<span class="k">else</span><span class="p">:</span> <span class="c1">#go above min</span>
								<span class="n">par_local</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">fixed_par</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="n">pardf_local</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">vary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
							
							<span class="k">def</span> <span class="nf">sub_problem</span><span class="p">(</span><span class="n">par_local</span><span class="p">,</span><span class="n">varied_par</span><span class="p">,</span><span class="n">pardf_local</span><span class="p">,</span><span class="n">fit_ds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">log_fit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">multi_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">unique_parameter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">target_s2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">=</span><span class="kc">None</span> <span class="p">):</span>
								<span class="n">pardf_local</span><span class="p">[</span><span class="n">varied_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">=</span><span class="n">par_local</span><span class="p">[</span><span class="n">varied_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
								<span class="k">if</span> <span class="n">par_to_pardf</span><span class="p">(</span><span class="n">pardf_local</span><span class="p">)</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
									<span class="k">if</span> <span class="n">multi_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
										<span class="n">mini_sub</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">err_func</span><span class="p">,</span><span class="n">pardf_local</span><span class="p">,</span><span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ds&#39;</span><span class="p">:</span><span class="n">fit_ds</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span><span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="n">log_fit</span><span class="p">,</span><span class="s1">&#39;ext_spectra&#39;</span><span class="p">:</span><span class="n">ext_spectra</span><span class="p">})</span>
									<span class="k">else</span><span class="p">:</span>
										<span class="n">mini_sub</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">err_func_multi</span><span class="p">,</span><span class="n">pardf_local</span><span class="p">,</span><span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;multi_project&#39;</span><span class="p">:</span><span class="n">multi_project</span><span class="p">,</span><span class="s1">&#39;unique_parameter&#39;</span><span class="p">:</span><span class="n">unique_parameter</span><span class="p">,</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="n">weights</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span><span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="n">log_fit</span><span class="p">,</span><span class="s1">&#39;ext_spectra&#39;</span><span class="p">:</span><span class="n">ext_spectra</span><span class="p">})</span>
									<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
										<span class="n">results_sub</span> <span class="o">=</span> <span class="n">mini_sub</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;Nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">,</span><span class="s1">&#39;adaptive&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
									<span class="k">else</span><span class="p">:</span>
										<span class="n">results_sub</span> <span class="o">=</span> <span class="n">mini_sub</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="s1">&#39;Nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mf">1e5</span><span class="p">})</span>
									<span class="n">local_error</span><span class="o">=</span><span class="p">(</span><span class="n">results_sub</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">target_s2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
									<span class="k">return</span> <span class="n">local_error</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="k">if</span> <span class="n">multi_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
										<span class="k">return</span> <span class="n">err_func</span><span class="p">(</span><span class="n">pardf_local</span><span class="p">,</span><span class="n">ds</span><span class="o">=</span><span class="n">fit_ds</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">log_fit</span><span class="o">=</span><span class="n">log_fit</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">=</span><span class="n">ext_spectra</span><span class="p">)</span>
									<span class="k">else</span><span class="p">:</span>
										<span class="k">return</span> <span class="n">err_func_multi</span><span class="p">(</span><span class="n">pardf_local</span><span class="p">,</span><span class="n">multi_project</span><span class="o">=</span><span class="n">multi_project</span><span class="p">,</span><span class="n">unique_parameter</span><span class="o">=</span><span class="n">unique_parameter</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span><span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">,</span><span class="n">log_fit</span><span class="o">=</span><span class="n">log_fit</span><span class="p">,</span><span class="n">ext_spectra</span><span class="o">=</span><span class="n">ext_spectra</span><span class="p">)</span>
							<span class="k">try</span><span class="p">:</span>
								
								<span class="n">mini_local</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Minimizer</span><span class="p">(</span><span class="n">sub_problem</span><span class="p">,</span><span class="n">par_local</span><span class="p">,</span><span class="n">fcn_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;varied_par&#39;</span><span class="p">:</span><span class="n">fixed_par</span><span class="p">,</span><span class="s1">&#39;pardf_local&#39;</span><span class="p">:</span><span class="n">pardf_local</span><span class="p">,</span><span class="s1">&#39;fit_ds&#39;</span><span class="p">:</span><span class="n">fit_ds</span><span class="p">,</span><span class="s1">&#39;multi_project&#39;</span><span class="p">:</span><span class="n">multi_project</span><span class="p">,</span><span class="s1">&#39;unique_parameter&#39;</span><span class="p">:</span><span class="n">unique_parameter</span><span class="p">,</span><span class="s1">&#39;weights&#39;</span><span class="p">:</span><span class="n">weights</span><span class="p">,</span><span class="s1">&#39;mod&#39;</span><span class="p">:</span><span class="n">mod</span><span class="p">,</span><span class="s1">&#39;log_fit&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="s1">&#39;target_s2&#39;</span><span class="p">:</span><span class="n">target_s2</span><span class="p">,</span><span class="s1">&#39;ext_spectra&#39;</span><span class="p">:</span><span class="n">ext_spectra</span><span class="p">})</span>							
								<span class="n">one_percent_precission</span><span class="o">=</span><span class="p">(</span><span class="n">target</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.01</span><span class="o">*</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
								<span class="c1">#results_local = mini_local.minimize(&#39;least_squares&#39;,ftol=one_percent_precission)</span>
								<span class="n">results_local</span> <span class="o">=</span> <span class="n">mini_local</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nelder&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;maxiter&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;fatol&#39;</span><span class="p">:</span><span class="n">one_percent_precission</span><span class="p">})</span>
								<span class="n">iterative_calls</span><span class="o">+=</span><span class="n">results_local</span><span class="o">.</span><span class="n">nfev</span>
								<span class="k">if</span> <span class="n">results_local</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
									<span class="n">conf_limits</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">results_local</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">fixed_par</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tried to optimise </span><span class="si">%i</span><span class="s2"> times achieved residual </span><span class="si">%g</span><span class="s2"> with targeted </span><span class="si">%g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">results_local</span><span class="o">.</span><span class="n">nfev</span><span class="p">,(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">results_local</span><span class="o">.</span><span class="n">residual</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">target_s2</span><span class="p">),</span><span class="n">target_s2</span><span class="p">))</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="c1">#print(&quot;Unexpected error:&quot;, sys.exc_info()[0])</span>
								<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error in </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%s</span><span class="s2"> limit&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">fixed_par</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
								<span class="k">continue</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;please use a confidence level between 0.6 and 1&quot;</span><span class="p">)</span>
					<span class="k">return</span> <span class="kc">False</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;it took </span><span class="si">%i</span><span class="s2"> optimisations to get the confidence&quot;</span><span class="o">%</span><span class="n">iterative_calls</span><span class="p">)</span>
		
		<span class="c1">############################################################################		</span>
		<span class="c1">#-----prepare frames for storage without confidence and store them------------------------</span>
		<span class="c1">############################################################################</span>
		
		<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">vary</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
			<span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_output&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">results</span><span class="c1">#let&#39;s store the fit results in the re_object for now.</span>
			<span class="k">if</span> <span class="n">confidence_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">conf_limits</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
				<span class="n">pardf</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">conf_limits</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">conf_limits</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;lower&#39;</span><span class="p">]</span>
					<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">conf_limits</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;upper&#39;</span><span class="p">]</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">]:</span>
						<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">pardf</span><span class="p">[</span><span class="n">pardf</span><span class="o">.</span><span class="n">is_rate</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
									<span class="k">continue</span>
								<span class="k">elif</span> <span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">isnan</span><span class="p">():</span>
									<span class="k">continue</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1"> has could not be converted and has value&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">))</span>
									<span class="nb">print</span><span class="p">(</span><span class="n">pardf</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">key</span><span class="p">])</span>
									<span class="k">continue</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">][</span><span class="s1">&#39;target-level&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">((</span><span class="n">confidence_level</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
		<span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf</span>
		<span class="n">timedf</span><span class="o">=</span><span class="n">pardf_to_timedf</span><span class="p">(</span><span class="n">pardf</span><span class="p">)</span>
		<span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">timedf</span>			
		<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="o">=</span><span class="n">re</span>
		
		<span class="c1">############################################################################</span>
		<span class="c1">#---print the output---------------------------------------------------</span>
		<span class="c1">############################################################################</span>
		
		<span class="n">Result_string</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit Results:</span><span class="se">\n</span><span class="s1">&#39;</span>
		
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">mod</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: External function</span><span class="se">\n\n</span><span class="s1">&#39;</span>
		
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;the time between </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> was excluded from the optimization</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span><span class="c1">#we got a list</span>
				<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;the time between </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> was excluded from the optimization</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>
		<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum error is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
		<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum R2-value is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">confidence_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates with confidence interval to level of </span><span class="si">%.1f</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">((</span><span class="n">confidence_level</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="n">pardf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="s1"> with confidence interval to level of </span><span class="si">%.1f</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,(</span><span class="n">confidence_level</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="n">timedf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates</span><span class="se">\n\n</span><span class="s1">&#39;</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="n">pardf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span>
			<span class="n">Result_string</span><span class="o">+=</span><span class="n">timedf</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
		
		<span class="nb">print</span><span class="p">(</span><span class="n">Result_string</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="n">dump_paras</span><span class="p">:</span>
			<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Fit_results_print.par&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
				<span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Result_string</span><span class="p">)</span></div>
			
	
<div class="viewcode-block" id="TA.Plot_fit_output"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Plot_fit_output">[docs]</a>	<span class="k">def</span> <span class="nf">Plot_fit_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;result_figures&#39;</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> 
						<span class="n">evaluation_style</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> 
						<span class="n">patches</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">print_click_position</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
						<span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
																	 
		<span class="sd">&#39;&#39;&#39;plots all the fit output figures. The figures can be called separately </span>
<span class="sd">		or with a list of plots. e.g. range(6) call plots 0-5 Manual plotting of certain type:</span>
<span class="sd">		</span>
<span class="sd">		This is a wrapper function that triggers the plotting of all the fitted plots.</span>
<span class="sd">		The parameter in this plot call are to control the general look and features of the plot.</span>
<span class="sd">		Which plots are printed is defined by the first command (plotting)</span>
<span class="sd">		The plots are generated from the fitted Matrixes and as such only will work after a fit was actually</span>
<span class="sd">		completed (and the &quot;re&quot; dictionary attached to the object.)</span>
<span class="sd">		In all plots the RAW data is plotted as dots and the fit with lines </span>
<span class="sd">		</span>
<span class="sd">		Contents of the plots</span>

<span class="sd">			0. DAC contains the assigned spectra for each component of the fit. For</span>
<span class="sd">			   a modelling with independent exponential decays this corresponds to</span>
<span class="sd">			   the &quot;Decay Associated Spectra&quot; (DAS). For all other models this</span>
<span class="sd">			   contains the &quot;Species Associated Spectra&quot; (SAS). According to the</span>
<span class="sd">			   model the separate spectra are labeled by time (process) or name, if</span>
<span class="sd">			   a name is associated in the fitting model. The spectra are shown in</span>
<span class="sd">			   the extracted strength in the right pane and normalized in the left.</span>
<span class="sd">			   Extracted strength means that the measured spectral strength is the</span>
<span class="sd">			   intensity (concentration matrix) times this spectral strength. As the</span>
<span class="sd">			   concentration maxima for all DAS are 1 this corresponds to the</span>
<span class="sd">			   spectral strength for the DAS. (please see the documentation for the</span>
<span class="sd">			   fitting algorithm for further details).</span>

<span class="sd">			1. summed intensity. All wavelength of the spectral axis are summed for</span>
<span class="sd">			   data and fit. The data is plotted in a number of ways vs linear and</span>
<span class="sd">			   logarithmic axis. This plot is not ment for publication but very</span>
<span class="sd">			   useful to evaluate the quality of a fit.</span>

<span class="sd">			2. plot kinetics for selected wavelength (see corresponding RAW plot).</span>

<span class="sd">			3. plot spectra at selected times (see corresponding RAW plot).</span>

<span class="sd">			4. plots matrix (measured, modelled and error Matrix). The parameter are</span>
<span class="sd">			   the same as used for the corresponding RAW plot with the addition of</span>
<span class="sd">			   &quot;error_matrix_amplification&quot; which is a scaling factor multiplied</span>
<span class="sd">			   onto the error matrix. I recommend to play with different &quot;cmap&quot;,</span>
<span class="sd">			   &quot;log_scale&quot; and &quot;intensity_scale&quot; to create a pleasing plot.</span>

<span class="sd">			5. concentrations. In the progress of the modelling/fitting a matrix is</span>
<span class="sd">			   generated that contains the relative concentrations of the species</span>
<span class="sd">			   modelled. This plot is showing the temporal development of these</span>
<span class="sd">			   species. Further details on how this matrix is generated can be found</span>
<span class="sd">			   in the documentation of the fitting function. The modeled spectra are</span>
<span class="sd">			   the convolution of these vectors (giving the time-development) and</span>
<span class="sd">			   the DAS/SAS (giving the spectral development).</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		---------------</span>
<span class="sd">		</span>
<span class="sd">		plotting : int or iterable (of integers), optional</span>
<span class="sd">			This parameter determines which figures are plotted </span>
<span class="sd">			the figures can be called separately with plotting = 1</span>
<span class="sd">			or with a list of plots (Default) e.g. plotting=range(6) calls plots 0,1,2,3,4,5</span>
<span class="sd">			The plots have the following numbers:</span>
<span class="sd">			</span>
<span class="sd">				0. DAS or SAS</span>
<span class="sd">				1. summed intensity</span>
<span class="sd">				2. Kinetics</span>
<span class="sd">				3. Spectra</span>
<span class="sd">				4. Matrixes</span>
<span class="sd">				5. Concentrations (the c-object)</span>
<span class="sd">			</span>
<span class="sd">			The plotting takes all parameter from the &quot;ta&quot; object unless otherwise specified</span>
<span class="sd">		</span>
<span class="sd">		path : None, str or path object, optional</span>
<span class="sd">			This defines where the files are saved if the safe_figures_to_folder parameter is True, </span>
<span class="sd">			quite useful if a lot of data sets are to be printed fast. </span>
<span class="sd">			If a path is given, this is used. If a string like the (Default) &quot;result_figures&quot; is given, </span>
<span class="sd">			then a subfolder of this name will be used (an generated if necessary) </span>
<span class="sd">			relative to self.path. Use and empty string to use the self.path</span>
<span class="sd">			If set to None, the location of the plot_func will be used and</span>
<span class="sd">			a subfolder with title &quot;result_figures&quot; be generated here</span>
<span class="sd">		</span>
<span class="sd">		savetype : str or iterable (of str), optional </span>
<span class="sd">			matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">			typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;.  </span>
<span class="sd">			</span>
<span class="sd">		evaluation_style : bool, optional</span>
<span class="sd">			True (Default = False) adds a lot of extra information in the plot</span>
<span class="sd">		</span>
<span class="sd">		title : None or str, optional</span>
<span class="sd">		   &quot;title=None&quot; is in general the filename that was loaded. Setting a</span>
<span class="sd">		   specific title will be used in all plots. To remove the title all</span>
<span class="sd">		   together set an empty string with title=&quot;&quot;</span>
<span class="sd">		   </span>
<span class="sd">		scale_type : str, optional</span>
<span class="sd">		   refers to the time-axis and takes, &quot;symlog&quot; (Default)(linear around zero and logarithmic otherwise)</span>
<span class="sd">		   and &quot;lin&quot; for linear and  &quot;log&quot; for logarithmic, switching all the time axis to this type</span>
<span class="sd">		</span>
<span class="sd">		patches : bool, optional</span>
<span class="sd">			If False (Default) the names &quot;measured&quot; &quot;fitted&quot; &quot;difference&quot; will be placed above the images.</span>
<span class="sd">			If True, then they will be included into the image (denser)</span>

<span class="sd">		filename : str, optional</span>
<span class="sd">			offers to replace the base-name used for all plots (to e.g.specify what sample was used). </span>
<span class="sd">			if (Default) None is used, the self.filename is used as a base name. The filename plays only a </span>
<span class="sd">			role during saving, as does the path and savetype	</span>
<span class="sd">			</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.		</span>
<span class="sd">		</span>
<span class="sd">		print_click_position : bool, optional</span>
<span class="sd">			if True then the click position is printed for the spectral plots </span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		------------</span>
<span class="sd">		</span>
<span class="sd">		Typically one would call this function empty for an overview:</span>
<span class="sd">		After the minimum fit</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta=pf.TA(&#39;testfile.SIA&#39;)</span>
<span class="sd">		&gt;&gt;&gt; ta.par=lmfit.Parameters()</span>
<span class="sd">		&gt;&gt;&gt; ta.par.add(&#39;k0&#39;,value=1/0.1,vary=True)</span>
<span class="sd">		&gt;&gt;&gt; ta.Fit_Global()</span>
<span class="sd">		</span>
<span class="sd">		One usually plots the an overview</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_fit_output()</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_fit_output(plotting=range(6)) #is the same as before</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_fit_output(2) #would plot only the kinetics</span>
<span class="sd">		&gt;&gt;&gt; ta.Plot_fit_output(plotting = 2) #would plot only the kinetics</span>
<span class="sd">				</span>

<span class="sd">		&#39;&#39;&#39;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">re</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;We need to have fitted something so that we can plot&#39;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">False</span>
		<span class="n">path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="n">path</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
		<span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">title</span><span class="o">=</span><span class="n">filename</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">plotting</span><span class="p">,</span><span class="s2">&quot;__iter__&quot;</span><span class="p">):</span><span class="n">plotting</span><span class="o">=</span><span class="p">[</span><span class="n">plotting</span><span class="p">]</span>
		<span class="n">plot_fit_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">plotting</span> <span class="o">=</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> 
						<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> 
						<span class="n">log_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_scale</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> 
						<span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
						<span class="n">error_matrix_amplification</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_matrix_amplification</span><span class="p">,</span> 
						<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">rel_wave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span><span class="p">,</span> 
						<span class="n">rel_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span><span class="p">,</span> <span class="n">save_figures_to_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">,</span> 
						<span class="n">log_fit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_fit</span><span class="p">,</span><span class="n">mod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="n">savetype</span><span class="p">,</span> 
						<span class="n">time_width_percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">evaluation_style</span> <span class="o">=</span> <span class="n">evaluation_style</span><span class="p">,</span> 
						<span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="p">,</span> <span class="n">lintresh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lintresh</span><span class="p">,</span>
						<span class="n">print_click_position</span> <span class="o">=</span> <span class="n">print_click_position</span><span class="p">,</span> <span class="n">ignore_time_region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">,</span>
						<span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_type</span><span class="p">,</span> <span class="n">plot_second_as_energy</span> <span class="o">=</span> <span class="n">plot_second_as_energy</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>



<div class="viewcode-block" id="TA.Save_data"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Save_data">[docs]</a>	<span class="k">def</span> <span class="nf">Save_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_RAW</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_Fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_slices</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_binned</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
					<span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">save_fit_results</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;Data_export&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)):</span>
		<span class="sd">&#39;&#39;&#39;handy function to save the data on disk as dat files.</span>
<span class="sd">		The RAW labeled files contain the chirp corrected values (self.ds)</span>
<span class="sd">		</span>
<span class="sd">		the save_slices switch turns on the dump of the separate sliced figures (time and spectral) </span>

<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		save_binned : bool, optional</span>
<span class="sd">			is also the re-binned matrix to be saved.</span>
<span class="sd">			</span>
<span class="sd">		save_slices : bool, optional</span>
<span class="sd">			save the kinetics and spectra from the fitted data (with the fits)</span>
<span class="sd">			</span>
<span class="sd">		sep : str, optional</span>
<span class="sd">			what symbol is used to separate different number. (typical either &#39;tab&#39; or comma</span>
<span class="sd">		</span>
<span class="sd">		save_RAW : bool, optional</span>
<span class="sd">			(Default) True then the first slide with the RAW data is created </span>
<span class="sd">		</span>
<span class="sd">		save_Fit : bool, optional</span>
<span class="sd">			(Default) True then the second slide with the Fitted data is created </span>
<span class="sd">		</span>
<span class="sd">		path : None, str or path, optional</span>
<span class="sd">			(Default) None, if left on None, then a folder &quot;result_figures&quot; is created in the folder </span>
<span class="sd">			of the data (self.path)</span>
<span class="sd">			</span>
<span class="sd">		save_fit_results : bool, optional</span>
<span class="sd">			if True (Default)  a neatly formated file with the fit results is created and stored with the data</span>
<span class="sd">			</span>
<span class="sd">		filename : str, optional</span>
<span class="sd">			(Default) None, Base name for all plots. If None, then self.filename will be used</span>
<span class="sd">			</span>
<span class="sd">		Examples</span>
<span class="sd">		---------</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_Data</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">save_RAW</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_chirp_corrected_raw_matrix.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">save_binned</span><span class="p">:</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
							<span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> 
							<span class="n">time_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_bin</span><span class="p">)</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
										<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_chirp_corrected_rebinned_matrix.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">save_slices</span><span class="p">:</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span><span class="p">)</span>
				<span class="c1">#sub.columns.name = &#39;wavelength [nm] in %.0f bins&#39;%self.wavelength_bin</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_chirp_corrected_RAW_kinetics.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span><span class="p">,</span> 
								<span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">)</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_chirp_corrected_RAW_Spectra.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">save_Fit</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;no fit in data&#39;</span><span class="p">)</span>
				<span class="n">save_Fit</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="n">save_Fit</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
								<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_matrix used as fit input.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
								<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_matrix calculated during fit.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
								<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_error_matrix calculated during fit.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">save_slices</span><span class="p">:</span>	
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span><span class="p">)</span>
				<span class="c1">#sub.columns.name = &#39;wavelenth [nm] in %.0f bins&#39;%self.wavelength_bin</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_fitted_kinetics.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">wavelength_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span><span class="p">)</span>
				<span class="c1">#sub.columns.name = &#39;wavelenth [nm] in %.0f bins&#39;%self.wavelength_bin</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_measured_kinetics.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span><span class="p">,</span> 
							<span class="n">time_width_percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">)</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_fitted_spectra.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
				<span class="n">sub</span> <span class="o">=</span> <span class="n">sub_ds</span><span class="p">(</span><span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span><span class="p">,</span> 
							<span class="n">time_width_percent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> 
							<span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">)</span>
				<span class="n">sub</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_measured_spectra.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> 
							<span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_DAS-SAS.dat&#39;</span><span class="p">),</span> <span class="n">sep</span> <span class="o">=</span> <span class="n">sep</span><span class="p">)</span>
		
			<span class="k">if</span> <span class="n">save_fit_results</span><span class="p">:</span>
				
				<span class="n">Result_string</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit Results:</span><span class="se">\n</span><span class="s1">&#39;</span>
				
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: External function</span><span class="se">\n\n</span><span class="s1">&#39;</span>
				
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;the time between </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> was excluded from the optimization</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>	
				<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum error is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
				<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum R2-value is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">])</span>
				
				<span class="k">if</span> <span class="s1">&#39;confidence&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates with confidence interval to level of </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">][</span><span class="s1">&#39;target-level&#39;</span><span class="p">]</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="s1"> with confidence interval to level of </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">][</span><span class="s1">&#39;target-level&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates</span><span class="se">\n</span><span class="s1">&#39;</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>

				<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;_fit_results_parameter.par&#39;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">text_file</span><span class="p">:</span>
					<span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Result_string</span><span class="p">)</span></div>

<div class="viewcode-block" id="TA.Save_Powerpoint"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Save_Powerpoint">[docs]</a>	<span class="k">def</span> <span class="nf">Save_Powerpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_RAW</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_Fit</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
						<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;result_figures&#39;</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span> <span class="p">,</span> <span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;pptx&#39;</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This function creates two power point slides. On the first it summarizes the RAW plots and on </span>
<span class="sd">		the second (if existent) it summarizes the fitted results</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		save_RAW : bool, optional</span>
<span class="sd">			(Default) True then the first slide with the RAW data is created </span>
<span class="sd">		</span>
<span class="sd">		save_Fit : bool, optional</span>
<span class="sd">			(Default) True then the second slide with the Fitted data is created </span>
<span class="sd">		</span>
<span class="sd">		path : None, str or path, optional</span>
<span class="sd">			(Default) None, if left on None, then a folder &quot;result_figures&quot; is created in the folder </span>
<span class="sd">			of the data (self.path)</span>
<span class="sd">		</span>
<span class="sd">		savetype : str or iterable (of str), optional </span>
<span class="sd">			triggers the additional creation of a composite file in this format.</span>
<span class="sd">			matplotlib allows the saving of figures in various formats. (Default) &quot;png&quot;, </span>
<span class="sd">			typical and recommendable options are &quot;svg&quot; and &quot;pdf&quot;.  </span>
<span class="sd">			</span>
<span class="sd">		title : None or str, optional</span>
<span class="sd">			(Default) None, Use this title on all plots. if None, use self.filename</span>
<span class="sd">			</span>
<span class="sd">		filename : str, optional</span>
<span class="sd">			(Default) None, Base name for all plots. If None, then self.filename will be used</span>
<span class="sd">			</span>
<span class="sd">		scale_type : str, optional</span>
<span class="sd">			&#39;symlog&#39; (Default), &#39;linear&#39;, &#39;log&#39; time axis</span>
<span class="sd">			</span>
<span class="sd">		patches : bool, optional</span>
<span class="sd">			For true use white patches to label things in the 2d matrixes, to safe</span>
<span class="sd">			space for publication</span>
<span class="sd">			</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		---------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_Powerpoint()</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_Powerpoint(patches = True)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>						 
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">savetype</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span><span class="n">savetype</span><span class="o">=</span><span class="p">[</span><span class="n">savetype</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">savetype</span><span class="p">,</span><span class="s2">&quot;__iter__&quot;</span><span class="p">):</span><span class="n">savetype</span><span class="o">=</span><span class="p">[</span><span class="n">savetype</span><span class="p">]</span>
		<span class="n">raw_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MAT&quot;</span><span class="p">,</span><span class="s2">&quot;SEL&quot;</span><span class="p">,</span><span class="s2">&quot;SPEK&quot;</span><span class="p">,</span><span class="s2">&quot;SVD&quot;</span><span class="p">]</span>
		<span class="n">raw_names</span><span class="o">=</span><span class="p">[</span><span class="n">check_folder</span><span class="p">(</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_RAW_&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">raw_names</span><span class="p">]</span>
		<span class="n">fit_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;FIG_MAT&quot;</span><span class="p">,</span><span class="s2">&quot;SPEC&quot;</span><span class="p">,</span><span class="s2">&quot;SEL&quot;</span><span class="p">,</span><span class="s2">&quot;SUM&quot;</span><span class="p">,</span><span class="s2">&quot;DAC&quot;</span><span class="p">]</span>
		<span class="n">fit_names</span><span class="o">=</span><span class="p">[</span><span class="n">check_folder</span><span class="p">(</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">fit_names</span><span class="p">]</span>
		<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
		<span class="n">origin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span>
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
			<span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">save_RAW</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="kc">True</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">Plot_RAW</span><span class="p">(</span><span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span>	
			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">save_Fit</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="kc">True</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">Plot_fit_output</span><span class="p">(</span><span class="n">savetype</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">patches</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span> <span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">)</span>
				<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="n">save_Fit</span> <span class="o">=</span> <span class="kc">False</span>
				<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;run into problems with adding the fit results. Have you fitted something?&#39;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">Result_string</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fit Results:</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">mod</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;Model Used: External function</span><span class="se">\n\n</span><span class="s1">&#39;</span>
				<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;the time between </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%.3f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> was excluded from the optimization</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ignore_time_region</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>	
				<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum error is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
				<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;The minimum R2-value is:</span><span class="si">{:.8e}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;r2&#39;</span><span class="p">])</span>
				<span class="k">if</span> <span class="s1">&#39;confidence&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates with confidence interval to level of </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">][</span><span class="s1">&#39;target-level&#39;</span><span class="p">]</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="se">\n</span><span class="s1"> with confidence interval to level of </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;confidence&#39;</span><span class="p">][</span><span class="s1">&#39;target-level&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;lower_limit&#39;</span><span class="p">,</span><span class="s1">&#39;upper_limit&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">In Rates</span><span class="se">\n</span><span class="s1">&#39;</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">The rates converted to times with unit </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span>
					<span class="n">Result_string</span><span class="o">+=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;init_value&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">])</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;pdf&#39;</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;png&#39;</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;svg&#39;</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">save_RAW</span><span class="p">:</span>
				<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
				<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
				<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
				<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
				<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
				<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="s2">&quot;pptx&quot;</span><span class="p">:</span><span class="k">continue</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
						<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_RAW-summary.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">entry</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;saving in&quot;</span> <span class="o">+</span> <span class="n">entry</span> <span class="o">+</span><span class="s2">&quot;failed&quot;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">save_Fit</span><span class="p">:</span>
				<span class="n">G</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
				<span class="n">fig1</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mf">7.5</span><span class="p">))</span>
				<span class="n">ax1</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">,:</span><span class="mi">6</span><span class="p">])</span>
				<span class="n">ax2</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">,:</span><span class="mi">6</span><span class="p">])</span>
				<span class="n">ax3</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">2</span><span class="p">,:</span><span class="mi">6</span><span class="p">])</span>
				<span class="n">ax4</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">3</span><span class="p">,:</span><span class="mi">6</span><span class="p">])</span>
				<span class="n">ax5</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">:])</span>
				<span class="n">ax6</span><span class="o">=</span><span class="n">fig1</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">G</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span><span class="mi">6</span><span class="p">:])</span>
				<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
				<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
				<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
				<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">4</span><span class="p">])))</span>
				<span class="n">ax5</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
				<span class="n">ax6</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Result_string</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">)</span>
				<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax5</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span><span class="n">ax6</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">entry</span> <span class="o">==</span> <span class="s2">&quot;pptx&quot;</span><span class="p">:</span> <span class="k">continue</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">fig1</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
						<span class="n">fig1</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_Fit-summary.</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">entry</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;saving in&quot;</span> <span class="o">+</span> <span class="n">entry</span> <span class="o">+</span><span class="s2">&quot;failed&quot;</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;pptx&#39;</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;ppt&#39;</span> <span class="ow">in</span> <span class="n">savetype</span><span class="p">):</span>
			<span class="n">left</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
			<span class="n">top</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
			<span class="n">prs</span> <span class="o">=</span> <span class="n">Presentation</span><span class="p">()</span>
			<span class="n">blank_slide_layout</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slide_layouts</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
			<span class="n">slide</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">blank_slide_layout</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">save_RAW</span><span class="p">:</span>
				<span class="n">left</span> <span class="o">=</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">),</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">))</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">))</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">))</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">pic</span> <span class="o">=</span> <span class="n">slide</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raw_names</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">),</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">3.4</span><span class="p">))</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">pass</span>
			<span class="k">if</span> <span class="n">save_Fit</span><span class="p">:</span>
				<span class="n">slide2</span> <span class="o">=</span> <span class="n">prs</span><span class="o">.</span><span class="n">slides</span><span class="o">.</span><span class="n">add_slide</span><span class="p">(</span><span class="n">blank_slide_layout</span><span class="p">)</span>
				<span class="n">left</span> <span class="o">=</span> <span class="n">top</span> <span class="o">=</span> <span class="n">Inches</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">5.5</span><span class="p">),</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">3.5</span><span class="p">))</span><span class="c1">#Matrix</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">3.9</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">1.4</span><span class="p">))</span>
				<span class="n">pic</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_picture</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fit_names</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">5.4</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
				
				<span class="n">text1</span> <span class="o">=</span> <span class="n">slide2</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">add_textbox</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">5.5</span><span class="p">),</span> <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="o">+</span><span class="n">Inches</span><span class="p">(</span><span class="mf">3.5</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mf">4.5</span><span class="p">),</span> <span class="n">height</span><span class="o">=</span><span class="n">Inches</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
				<span class="n">text1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">Result_string</span>
				<span class="n">text1</span><span class="o">.</span><span class="n">text_frame</span><span class="o">.</span><span class="n">fit_text</span><span class="p">(</span><span class="n">font_family</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">italic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

			<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="n">origin</span>
			<span class="n">prs</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.pptx&#39;</span><span class="p">))</span>
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All data was saved to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span></div>
		
	


<div class="viewcode-block" id="TA.Save_project"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Save_project">[docs]</a>	<span class="k">def</span> <span class="nf">Save_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;function to dump all the parameter of an analysis into an hdf5 file. </span>
<span class="sd">		This file contains the ds_ori and all the parameter, including fitting parameter</span>
<span class="sd">		and results.</span>
<span class="sd">		One limitation is the fitting model. If the model is build in, so the model is</span>
<span class="sd">		&#39;exponential&#39; or &#39;parallel&#39; then the safing works. If an external model is used then the </span>
<span class="sd">		dostring of the external function is stored, but not the function itself.</span>
<span class="sd">				</span>
<span class="sd">		Parameters</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		path : None, str or path, optional</span>
<span class="sd">			(Default) None, if left on None, then a folder &quot;Data&quot; is created in the folder </span>
<span class="sd">			of the project (self.path)</span>
<span class="sd">				</span>
<span class="sd">		filename : str, optional</span>
<span class="sd">			(Default) None, Base name for all plots. If None, then self.filename will be used</span>
<span class="sd">			</span>
<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Save_project()</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
		<span class="n">hdf5_name</span> <span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;.hdf5&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">hdf5_name</span><span class="p">):</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hdf5_name</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">hdf5_name</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
					<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">hdf5_name</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File exists but can not be deleted&#39;</span><span class="p">)</span>
		<span class="n">re_switch</span> <span class="o">=</span> <span class="kc">False</span>
		<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">hdf5_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;paral&#39;</span><span class="p">,</span><span class="s1">&#39;exponential&#39;</span><span class="p">,</span><span class="s1">&#39;consecutive&#39;</span><span class="p">,</span><span class="s1">&#39;full_consecutive&#39;</span><span class="p">]:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">docstring</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="vm">__doc__</span>
							<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">docstring</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span>
								<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">docstring</span><span class="p">)</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;external_function_without_docstring&#39;</span><span class="p">)</span>
				<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rel_wave&#39;</span><span class="p">,</span><span class="s1">&#39;rel_time&#39;</span><span class="p">]:</span><span class="c1">#need extra, as it is bypassed by the re-switch</span>
					<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
				<span class="k">elif</span> <span class="n">key</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;re&#39;</span> <span class="p">:</span>
					<span class="n">re_switch</span> <span class="o">=</span> <span class="kc">True</span>
					<span class="k">for</span> <span class="n">key2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]:</span>
						<span class="k">if</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;fit_output&#39;</span><span class="p">:</span><span class="k">continue</span>
						<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">key2</span><span class="p">]</span>
						<span class="k">if</span> <span class="n">key2</span> <span class="o">==</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;re_error&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saving of &#39;</span> <span class="o">+</span> <span class="n">key2</span> <span class="o">+</span> <span class="s1">&#39; failed&#39;</span> <span class="p">)</span>
						<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
							<span class="k">pass</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;re_&#39;</span> <span class="o">+</span> <span class="n">key2</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;saving of &#39;</span> <span class="o">+</span> <span class="n">key2</span> <span class="o">+</span> <span class="s1">&#39; failed&#39;</span> <span class="p">)</span>
				<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span>
					<span class="k">pass</span>
				<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;intensity_range&#39;</span><span class="p">:</span>
					<span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;intensity_range&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)):</span>
						<span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">data</span><span class="p">,</span><span class="n">data</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;intensity_range&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;intensity_range&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>	
				<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;background_par&#39;</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;back&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;background_par&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
				
				<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;par&#39;</span><span class="p">,</span><span class="s1">&#39;par_fit&#39;</span><span class="p">]:</span>
									 
					<span class="n">df</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="c1">#pandas has a bug and problems handling mixed type columns when saving. So we clean up.</span>
					<span class="k">for</span> <span class="n">sub_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">]:</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">df</span><span class="p">[</span><span class="n">sub_key</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">sub_key</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="k">pass</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;is_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;vary&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;vary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
					<span class="n">df</span><span class="p">[</span><span class="s1">&#39;expr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;expr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">x</span><span class="p">)</span>
					<span class="n">df</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hdf5_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
							<span class="k">pass</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;path&#39;</span><span class="p">:</span>
									<span class="k">pass</span>
								<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;figure_path&#39;</span><span class="p">:</span>
									<span class="k">pass</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;the saving of  </span><span class="si">%s</span><span class="s1">  failed&#39;</span><span class="o">%</span><span class="n">key</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;fitcoeff&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;fitcoeff&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitcoeff</span><span class="p">)</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chirp_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f2</span><span class="p">:</span>
							<span class="n">fitcoeff</span><span class="o">=</span><span class="n">f2</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
							<span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;fitcoeff&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">fitcoeff</span><span class="p">)</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="k">pass</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ds_ori</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hdf5_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;ds_ori&#39;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="c1">#save_raw_data</span>
		<span class="k">if</span> <span class="n">re_switch</span><span class="p">:</span>
			<span class="c1">#print(&#39;re-switched&#39;)</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;AC&#39;</span><span class="p">,</span> <span class="s1">&#39;AE&#39;</span><span class="p">,</span> <span class="s1">&#39;DAC&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hdf5_name</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;re_&#39;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		
		<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The project was saved to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span></div>


	<span class="k">def</span> <span class="nf">__read_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">saved_project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;function to re-read all the parameter of a previous analysis </span>
<span class="sd">		into an hdf5 file, current path is the path that the file should </span>
<span class="sd">		assume is its &quot;home directory&quot; after successful loading. If not </span>
<span class="sd">		set we take the filepath at which the file is currently stored as path&#39;&#39;&#39;</span>
		<span class="k">if</span> <span class="n">saved_project</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;We do need a project to import&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">current_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">current_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">saved_project</span><span class="p">))</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="kn">import</span> <span class="nn">h5py</span>
		<span class="k">except</span><span class="p">:</span>
		 
			<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;could not import hdf5, current version requires that this is installed. IF running Anaconda open Conda promt and type: conda install h5py&#39;</span><span class="p">)</span>
		<span class="n">data_frame_list</span><span class="o">=</span><span class="p">[]</span>

		<span class="c1"># we hav to handle the old and new type of saving</span>
		<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">saved_project</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="k">if</span> <span class="s1">&#39;re_final_setup_par&#39;</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span><span class="n">old_switch</span><span class="o">=</span><span class="kc">True</span>
					 
		
			<span class="k">else</span><span class="p">:</span><span class="n">old_switch</span><span class="o">=</span><span class="kc">False</span>
					   
		<span class="k">if</span> <span class="n">old_switch</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;we read an old style data_file and directly update it into the new file_type after loading&#39;</span><span class="p">)</span>
		<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">saved_project</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">if</span> <span class="s2">&quot;re_&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
						<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;re&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
							<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][()]</span>
					<span class="k">elif</span> <span class="s2">&quot;back&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
						<span class="n">rea</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][()]</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;background_par&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;background_par&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rea</span><span class="p">)</span>
					<span class="k">elif</span> <span class="s2">&quot;par&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
						<span class="k">if</span> <span class="n">old_switch</span><span class="p">:</span><span class="c1">#old type of saved data</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;temp_file.json&#39;</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="k">pass</span>
							<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp_file.json&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
								<span class="n">g</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][()])</span>
							<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp_file.json&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">=</span><span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
								<span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;temp_file.json&#39;</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="k">pass</span>
						<span class="k">else</span><span class="p">:</span><span class="c1">#new type of data</span>
							<span class="k">raise</span>		
					<span class="k">else</span><span class="p">:</span>
						<span class="n">read</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">][()]</span>
						<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read</span><span class="p">,</span><span class="nb">bytes</span><span class="p">):</span>
							<span class="n">read</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">asstr</span><span class="p">()[()]</span> 
						<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)):</span>
							<span class="k">if</span> <span class="n">read</span><span class="o">==</span><span class="s1">&#39;None&#39;</span><span class="p">:</span>
								<span class="n">read</span><span class="o">=</span><span class="kc">None</span>
						<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bordercut&#39;</span><span class="p">,</span><span class="s1">&#39;timelimits&#39;</span><span class="p">,</span><span class="s1">&#39;fitcoeff&#39;</span><span class="p">,</span><span class="s1">&#39;scattercut&#39;</span><span class="p">]:</span>
							<span class="n">read</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">read</span><span class="p">]</span>
						<span class="k">elif</span> <span class="n">key</span> <span class="o">==</span><span class="s1">&#39;intensity_range&#39;</span><span class="p">:</span>
							<span class="n">read</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">read</span><span class="p">]</span>
						<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rel_time&#39;</span><span class="p">,</span><span class="s1">&#39;rel_wave&#39;</span><span class="p">]:</span>
							<span class="n">read</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">read</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
						<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scattercut&#39;</span><span class="p">]:</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">read</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">read</span><span class="p">]</span>
							<span class="k">except</span><span class="p">:</span><span class="c1">#maybe we have  a list of scattercuts</span>
								<span class="k">try</span><span class="p">:</span>
									<span class="n">out_listen</span><span class="o">=</span><span class="p">[]</span>
									<span class="k">for</span> <span class="n">listen</span> <span class="ow">in</span> <span class="n">read</span><span class="p">:</span>
										<span class="n">outlisten</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">listen</span><span class="p">])</span>
								<span class="k">except</span><span class="p">:</span><span class="c1">#no idea lets see what happens</span>
									<span class="k">pass</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">read</span>
				<span class="k">except</span><span class="p">:</span><span class="c1">#we&#39;ll get an exception every time there is an dataframe</span>
					<span class="c1">#print(&#39;Frame:&#39;+key)</span>
					<span class="n">data_frame_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_frame_list</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="s2">&quot;re_&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">[:</span><span class="mi">3</span><span class="p">]:</span>
					<span class="c1">#print(&#39;re in list&#39;)</span>
					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">:]]</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">saved_project</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">data_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ds_ori&#39;</span><span class="p">,</span><span class="s1">&#39;par_fit&#39;</span><span class="p">,</span><span class="s1">&#39;par&#39;</span><span class="p">]:</span>
					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">saved_project</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">data_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;missing key:&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;par&#39;</span> <span class="ow">and</span> <span class="n">old_switch</span><span class="p">:</span><span class="k">pass</span> <span class="c1"># we have read it before already and the error is ok</span>
		 
				<span class="k">else</span><span class="p">:</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;error in key:&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">)</span>
		
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;par_fit&#39;</span><span class="p">]</span>
			<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf_to_timedf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">])</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
		
		<span class="c1">#the par conversion function failed, quickfix</span>
		<span class="k">for</span> <span class="n">over_key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;par_fit&#39;</span><span class="p">,</span><span class="s1">&#39;par&#39;</span><span class="p">]:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">par_df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">over_key</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">,</span><span class="s1">&#39;expr&#39;</span><span class="p">]]</span>
				<span class="n">par</span><span class="o">=</span><span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">par_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
					<span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;vary&#39;</span><span class="p">],</span> <span class="nb">min</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">],</span> <span class="nb">max</span><span class="o">=</span><span class="n">par_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">])</span>
															  
				<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">over_key</span><span class="p">]</span><span class="o">=</span><span class="n">par</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="k">if</span> <span class="n">old_switch</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="s1">&#39;fit_results_rates&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">)</span>
				<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="s1">&#39;fit_results_times&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pardf_to_timedf</span><span class="p">(</span><span class="n">par_to_pardf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">par</span><span class="p">))</span>
				<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;par_fit&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">par</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">pass</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="o">=</span><span class="kc">False</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">current_path</span>
		<span class="k">if</span> <span class="n">old_switch</span><span class="p">:</span><span class="c1">#convert project into new type</span>
			<span class="c1">#clean old files that were read wrong</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;re_final_int_par&#39;</span><span class="p">,</span><span class="s1">&#39;re_final_setup_par&#39;</span><span class="p">,</span><span class="s1">&#39;re_final_time_par&#39;</span><span class="p">,</span><span class="s1">&#39;re_int_error&#39;</span><span class="p">]:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> is not in the dictionary&#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;final_int_par&#39;</span><span class="p">,</span><span class="s1">&#39;final_setup_par&#39;</span><span class="p">,</span><span class="s1">&#39;final_time_par&#39;</span><span class="p">,</span><span class="s1">&#39;int_error&#39;</span><span class="p">]:</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s1">&#39;re&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
				<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Key </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> is not in the dictionary&#39;</span><span class="p">)</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">save_project</span><span class="p">()</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project converted into new data type and saved again&quot;</span><span class="p">)</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;project converted ibut could not be saved&quot;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">=</span><span class="n">current_path</span>
		<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time_bin&#39;</span><span class="p">,</span><span class="s1">&#39;rel_wave&#39;</span><span class="p">,</span><span class="s1">&#39;rel_time&#39;</span><span class="p">,</span><span class="s1">&#39;scattercut&#39;</span><span class="p">,</span><span class="s1">&#39;bordercut&#39;</span><span class="p">,</span><span class="s1">&#39;timelimits&#39;</span><span class="p">,</span><span class="s1">&#39;intensity_range&#39;</span><span class="p">,</span><span class="s1">&#39;wave_nm_bin&#39;</span><span class="p">,</span><span class="s1">&#39;wavelength_bin&#39;</span><span class="p">,</span><span class="s1">&#39;ignore_time_region&#39;</span><span class="p">]:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">bytes</span><span class="p">):</span>
					<span class="c1">#print(key + &#39; set to None&#39;)</span>
					<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
				<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="nb">str</span><span class="p">):</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;None&#39;</span><span class="p">:</span>
						<span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="k">continue</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="p">)</span>
			<span class="k">if</span> <span class="s1">&#39;None&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="kc">None</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>

<div class="viewcode-block" id="TA.Copy"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Copy">[docs]</a>	<span class="k">def</span> <span class="nf">Copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;returns a deep copy of the object.</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		&gt;&gt;&gt;ta=plot_func.TA(&#39;testfile.hdf5&#39;) #open a project</span>
<span class="sd">		&gt;&gt;&gt;ta1=ta.Copy() #make a copy for some tests or a differnet fit</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span> 
		<span class="kn">import</span> <span class="nn">copy</span>
		<span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="TA.Compare_at_time"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Compare_at_time">[docs]</a>	<span class="k">def</span> <span class="nf">Compare_at_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">norm_window</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
						<span class="n">time_width_percent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spectra</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_and_fit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> 
						<span class="n">print_click_position</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This function plots multiple spectra into the same figure at a given rel_time (timepoints) and </span>
<span class="sd">		allows for normalization. Very useful to compare the spectra for different solvents or quenchers, or</span>
<span class="sd">		e.g. different fits. The ta.time_width_percent parameter defines if this is a</span>
<span class="sd">		single time (if time_width_percent = 0) or an integrated window.</span>
<span class="sd">		Only &quot;rel_time&quot; is a mandatory, the rest can be taken from the original project (ta).</span>
<span class="sd">		</span>
<span class="sd">		The normalization is realized by giving a norm_window </span>
<span class="sd">		at which the intensity in the triggering object is integrated (in ta.Compare_at_time(other..) </span>
<span class="sd">		&quot;ta&quot; is the triggering object. The in each of the other curves the same window is</span>
<span class="sd">		integrated and the curve scaled by this value. Important to note is that this window</span>
<span class="sd">		does not need to be in the plot. e.g. the normalization can be done at a different time.</span>
<span class="sd">		</span>
<span class="sd">		Very often one would like to compare the measured spectra at a certain</span>
<span class="sd">		time to an external spectrum (e.g. spectro-electro-chemistry or steady</span>
<span class="sd">		state absorption). This can be done by loading a specific spectrum into</span>
<span class="sd">		a DataFrame and handing this data Frame to the comparision function. The</span>
<span class="sd">		function can also be used to plot e.g. the measured spectra vs. an</span>
<span class="sd">		external spectrum without giving any &quot;other&quot; Projects. (very useful for</span>
<span class="sd">		comparisions).</span>
<span class="sd">		 </span>
<span class="sd">		Parameters</span>
<span class="sd">		-------------</span>
<span class="sd">		</span>
<span class="sd">		rel_time : float or list/vector (of floats)</span>
<span class="sd">			Specify the times where to plot, single value or list/vector of values. </span>
<span class="sd">			For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">			If time_width_percent=0 (Default) the nearest measured </span>
<span class="sd">			timepoint is chosen. For other values see parameter &quot;time_width_percent&quot;.</span>
<span class="sd">			</span>
<span class="sd">		other : TA object or list of those, optional </span>
<span class="sd">			should be ta.plot_func objects (loaded or copied) and is what </span>
<span class="sd">			is plotted against the data use a list [ta1,ta2,... ] or generate this</span>
<span class="sd">			list using the Gui function. See section :ref:`Opening multiple files` in </span>
<span class="sd">			the documentation</span>
<span class="sd">		</span>
<span class="sd">		fitted : bool, optional</span>
<span class="sd">			True/False (Default) - use fitted data instead of raw data. </span>
<span class="sd">			If True, the fitted datapoints (without interpolation) are used. </span>
<span class="sd">			This is intended for comparing e.g. different fits</span>
<span class="sd">		</span>
<span class="sd">		norm_window : None or list/vector (with 4 floats), optional</span>
<span class="sd">			norm_window Give a list/tupel/vector with 4 entries in the order </span>
<span class="sd">			[Start - time, End - time, Start - wavelength, End - Wavelength], </span>
<span class="sd">			see section  :ref:`Normalization and Scaling`  in the documentation.</span>
<span class="sd">			If None (Default) no normalization is done.</span>
<span class="sd">		</span>
<span class="sd">		linewidth : float, optional</span>
<span class="sd">			linewidth to be used for plotting		</span>
<span class="sd">		</span>
<span class="sd">		time_width_percent : None or float, optional</span>
<span class="sd">			&quot;rel_time&quot; and &quot;time_width_percent&quot; work together for creating spectral plots at </span>
<span class="sd">			specific timepoints. For each entry in rel_time a spectrum is plotted. </span>
<span class="sd">			If however e.g. time_width_percent=10 the region between the timepoint closest </span>
<span class="sd">			to :math:`timepoint+0.1xtimepoint and :math:`timepoint-0.1xtimepoint` is averaged and shown </span>
<span class="sd">			(and the legend adjusted accordingly). If None (Default) is given, the value is </span>
<span class="sd">			taken from the triggering object (self.time_width_percent) This is particularly useful for the densly</span>
<span class="sd">			sampled region close to t=0. Typically for a logarithmic recorded kinetics, the </span>
<span class="sd">			timepoints at later times will be further appart than 10 percent of the value, </span>
<span class="sd">			but this allows to elegantly combine values around time=0 for better statistics. </span>
<span class="sd">			This averaging is only applied for the plotting function and not for the fits.</span>
<span class="sd">		</span>
<span class="sd">		spectra : None or DataFrame, optional</span>
<span class="sd">			If an DataFrame with the wavelength as index is provided, Then the spectra of each column</span>
<span class="sd">			is plotted into the differential spectra 1-1 and the column names are used in the legend</span>
<span class="sd">			Prior scaling is highly suggested. These spectra are not (in general) scaled with the </span>
<span class="sd">			norm window. (see examples).</span>
<span class="sd">		</span>
<span class="sd">		data_and_fit : bool, optional</span>
<span class="sd">			True or False (Default), choose if for the Fitted plot the raw data of the </span>
<span class="sd">			other projects is to be plotting in addition to the fitted line. For False (Default)</span>
<span class="sd">			Only the fit is plotted. </span>
<span class="sd">		</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>

<span class="sd">		print_click_position : bool, optional</span>
<span class="sd">			if True then the click position is printed for the spectral plots </span>

<span class="sd">		Examples</span>
<span class="sd">		----------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf</span>
<span class="sd">		&gt;&gt;&gt; ta = pf.TA(&quot;test1.hdf5&quot;) #open the original project</span>
<span class="sd">		</span>
<span class="sd">		Now open a bunch of other porjects to comare against</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; other_projects = pf.GUI_open(project_list = [&quot;file1.SIA&quot;, &quot;file2.SIA&quot;])</span>
<span class="sd">		</span>
<span class="sd">		Typical use is compare the raw data without normalization at 1ps and 6ps.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_time(rel_time = [1,6], others = other_project)</span>
<span class="sd">		</span>
<span class="sd">		Compare the fit withput normalization at 1ps and 6ps.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_time(rel_time = [1,6], others = other_project, fitted = True)</span>
<span class="sd">		</span>
<span class="sd">		Compare with normalization window between 1ps and 2ps and 400nm and 450nm.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; norm_window=[1,2,400,450]</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_time(rel_time = [1,6], others = other_project, norm_window = norm_window)</span>
<span class="sd">		</span>
<span class="sd">		Compare the spectrum at 1ps and 6ps with an external spectrum.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ext_spec = pd.read_csv(&quot;Ascii_spectrum.dat&quot;, sep = &quot;,&quot;)</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_time(rel_time = [1,6], spectra = ext_spec)</span>

<span class="sd">		Use example -  Often there are a lot of different measurements to </span>
<span class="sd">		compare at multiple time. The normlization is performed at the ground state bleach</span>
<span class="sd">		460 nm and early in time. Then it is better to make a new plot for each </span>
<span class="sd">		timepoint. The normalization window stays fixed.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; plt.close(&quot;all&quot;) #make some space</span>
<span class="sd">		&gt;&gt;&gt; norm_window=[0.3,0.5,450,470] #define window in ground state bleach</span>
<span class="sd">		&gt;&gt;&gt; for t in [0.3,0.5,1,3,10,30]: #iterate over the wavelength </span>
<span class="sd">		&gt;&gt;&gt; 	ta.Compare_at_time(rel_time = t, others = other_project, norm_window = norm_window)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;result_figures&#39;</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">time_width_percent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">time_width_percent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">time_width_percent</span>
		<span class="k">if</span> <span class="n">rel_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">rel_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_time</span>
		<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">other</span><span class="o">=</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">rel_time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rel_time</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">rel_time</span><span class="o">=</span><span class="p">[</span><span class="n">rel_time</span><span class="p">]</span>		
		<span class="k">else</span><span class="p">:</span>
			<span class="n">rel_time</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">fitted</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">re</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fitted results present&quot;</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">False</span>
			<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ref_scale</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
			<span class="n">objects</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
			<span class="n">colors</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">objects</span><span class="p">))</span>
			<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> 
						<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)],</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">subplot</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
			<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> 
						<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)],</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
			<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
			<span class="n">lab</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">]</span>
			<span class="n">han</span><span class="o">=</span><span class="n">handles</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
				<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> fit&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
			<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">re</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">re</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> has no fitted results&#39;</span><span class="o">%</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
						<span class="k">continue</span>
					<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">rel_scale</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">scaling</span><span class="o">=</span><span class="p">(</span><span class="n">rel_scale</span><span class="o">/</span><span class="n">ref_scale</span><span class="p">)</span>
							<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
										<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> 
										<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
							<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
							<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
								<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> fit&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
							<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
								<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
							
							<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
								<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
											<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> 
											<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
											<span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
								<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
								<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
									<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
								<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
									<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
							<span class="n">norm_failed</span> <span class="o">=</span> <span class="kc">False</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scaling Failed!&#39;</span><span class="p">)</span>
							<span class="n">norm_failed</span> <span class="o">=</span> <span class="kc">True</span>
					<span class="k">else</span><span class="p">:</span> <span class="n">norm_failed</span><span class="o">=</span><span class="kc">True</span>	
					<span class="k">if</span> <span class="n">norm_failed</span><span class="p">:</span>
						<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
										<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> 
										<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
						<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
						<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
							<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> fit&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
						<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
							<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
						
						<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
							<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
										<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> 
										<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
										<span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
							<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
							<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
								<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
							<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
								<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">norm_failed</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and fitted data at given times</span><span class="se">\n</span><span class="s1"> scaled to t=</span><span class="si">%g</span><span class="s1"> ps : </span><span class="si">%g</span><span class="s1"> ps , wl= </span><span class="si">%g</span><span class="s1"> nm: </span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and fitted data at given times&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">han</span><span class="p">,</span> <span class="n">lab</span> <span class="p">,</span><span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ref_scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">objects</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
			<span class="n">colors</span><span class="o">=</span><span class="n">colm</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">objects</span><span class="p">))</span>
			<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
			<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> 
						<span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> 
						<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">baseunit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>
			<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">_</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> <span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> 
							<span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span><span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span>
			<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
			<span class="n">lab</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">]</span>
			<span class="n">han</span><span class="o">=</span><span class="n">handles</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)]</span>
			<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">rel_scale</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
						<span class="k">try</span><span class="p">:</span>
							<span class="n">scaling</span> <span class="o">=</span> <span class="p">(</span><span class="n">rel_scale</span><span class="o">/</span><span class="n">ref_scale</span><span class="p">)</span>
							<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
										<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> 
										<span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> 
										<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
							<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
							<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
								<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
							<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
								<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

							<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
								<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
										<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> 
										<span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> 
										<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
							<span class="n">scaling_failed</span><span class="o">=</span><span class="kc">False</span>
						<span class="k">except</span><span class="p">:</span>
							<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scaling Failed!&#39;</span><span class="p">)</span>
							<span class="n">scaling_failed</span><span class="o">=</span><span class="kc">True</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">scaling_failed</span><span class="o">=</span><span class="kc">True</span>
					<span class="k">if</span> <span class="n">scaling_failed</span><span class="p">:</span>
						<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
									<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> 
									<span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> 
									<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
						<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
						<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">:</span>
							<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ent</span><span class="p">,</span><span class="n">o</span><span class="o">.</span><span class="n">baseunit</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
						<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">):]:</span>
							<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
							<span class="n">ax</span><span class="o">=</span><span class="n">plot_time</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rel_time</span> <span class="o">=</span> <span class="n">rel_time</span><span class="p">,</span> 
									<span class="n">time_width_percent</span> <span class="o">=</span> <span class="n">time_width_percent</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> 
									<span class="n">scattercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">,</span> 
									<span class="n">wave_nm_bin</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">wave_nm_bin</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rel_time</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
									
			<span class="k">if</span> <span class="ow">not</span> <span class="n">scaling_failed</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and smoothed data at given times</span><span class="se">\n</span><span class="s1"> scaled to t=</span><span class="si">%g</span><span class="s1"> ps : </span><span class="si">%g</span><span class="s1"> ps , wl= </span><span class="si">%g</span><span class="s1"> nm: </span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and smoothed data at given times&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">han</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">spectra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">spectra</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
			<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
			<span class="n">han</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">han</span><span class="p">,</span> <span class="n">lab</span> <span class="p">,</span><span class="n">labelspacing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">columnspacing</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">handlelength</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;compare_at_time_</span><span class="si">%s</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_time</span><span class="p">])),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>
						  

<div class="viewcode-block" id="TA.Compare_at_wave"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Compare_at_wave">[docs]</a>	<span class="k">def</span> <span class="nf">Compare_at_wave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_wave</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">fitted</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">norm_window</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
						<span class="n">width</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">data_and_fit</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scale_type</span> <span class="o">=</span> <span class="s1">&#39;symlog&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This function plots multiple kinetics into the same figure at one or</span>
<span class="sd">		multiple given wavelength (rel_wave) and  allows for </span>
<span class="sd">		:ref:`Normalization and Scaling` Very useful to compare the </span>
<span class="sd">		kinetics for different quencher concentrations or pump powers, </span>
<span class="sd">		or e.g. different fits. The parameter width or the general self.wavelength_bin</span>
<span class="sd">		which is used if width is None (Default) defines the width of</span>
<span class="sd">		the spectral window that is integrated and shown.</span>

<span class="sd">		A normalization window can be given at which all the plotted curves are normalized to. </span>
<span class="sd">		This window does not have to be in the plotted region. See :ref:`Normalization and Scaling`</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		--------------</span>
<span class="sd">		</span>
<span class="sd">		rel_wave : float or list/vector (of floats)</span>
<span class="sd">			Specify the wavelength where to plot the kinetics, single value or</span>
<span class="sd">			list/vector of values (only mandatory entry) For each entry in </span>
<span class="sd">			rel_wave a kinetic is plotted. &#39;rel_wave&#39; and &#39;width&#39; </span>
<span class="sd">			(in the object called &#39;wavelength_bin&#39; work together for the creation </span>
<span class="sd">			of kinetic plots. At each selected wavelength the data between </span>
<span class="sd">			wavelength+width/2 and wavelength-width/2 is averaged </span>
<span class="sd">			for each timepoint</span>
<span class="sd">			</span>
<span class="sd">		other : TA object or list of those, optional </span>
<span class="sd">			should be ta.plot_func objects (loaded or copied) and is what </span>
<span class="sd">			is plotted against the data use a list [ta1,ta2,... ] or generate this</span>
<span class="sd">			list using the Gui function. See section :ref:`Opening multiple files` in </span>
<span class="sd">			the documentation</span>

<span class="sd">		fitted : bool, optional</span>
<span class="sd">			True/False (Default) - use fitted data instead of raw data. </span>
<span class="sd">			If True, the fitted datapoints (without interpolation) are used. </span>
<span class="sd">			This is intended for comparing e.g. different fits</span>

<span class="sd">		norm_window : None or list/vector (with 4 floats), optional</span>
<span class="sd">			norm_window Give a list/tupel/vector with 4 entries in the order </span>
<span class="sd">			[Start - time, End - time, Start - wavelength, End - Wavelength], </span>
<span class="sd">			see section :ref:`Normalization and Scaling` in the documentation.</span>
<span class="sd">			If None (Default) no normalization is done.</span>

<span class="sd">		width</span>
<span class="sd">		   Specify the width above and below the given wavelength that is</span>
<span class="sd">		   integrated as window. If left to (Default) &quot;None&quot; the value from ta is</span>
<span class="sd">		   used.</span>

<span class="sd">		data_and_fit : bool, optional</span>
<span class="sd">			True or False (Default), choose if for the Fitted plot the raw data of the </span>
<span class="sd">			other projects is to be plotting in addition to the fitted line. For False (Default)</span>
<span class="sd">			Only the fit is plotted.</span>
<span class="sd">			</span>
<span class="sd">		linewidth : float, optional</span>
<span class="sd">			linewidth to be used for plotting</span>
<span class="sd">				</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		</span>
<span class="sd">		Scale_type : None or str</span>
<span class="sd">			is a general setting that can influences what time axis will be used for the plots. </span>
<span class="sd">			&quot;symlog&quot; (linear around zero and logarithmic otherwise) &quot;lin&quot; and &quot;log&quot; are valid options.	</span>
<span class="sd">					</span>
<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf</span>
<span class="sd">		&gt;&gt;&gt; ta = pf.TA(&#39;test1.hdf5&#39;) #open the original project</span>
<span class="sd">		</span>
<span class="sd">		Now open a bunch of other projects to compare against</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; other_projects = pf.GUI_open(project_list = [&#39;file1.SIA&#39;, &#39;file2.SIA&#39;])</span>
<span class="sd">		</span>
<span class="sd">		Typical use:</span>
<span class="sd">		Compare the raw data without normalization at 400 nm and 500 nm</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_wave(rel_wave = [400, 500], others = other_project)</span>
<span class="sd">		</span>
<span class="sd">		Compare the quality of the fit data without normalization at 400 nm and 500 nm</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_wave(rel_wave = [400, 500], others = other_project, fitted = True)</span>
<span class="sd">		</span>
<span class="sd">		Compare with normalization window between 1ps and 2ps and 400nm and 450nm</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; norm_window=[1,2,400,450]</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_at_wave(rel_wave = [400, 500], others = other_project, norm_window = norm_window)</span>
<span class="sd">		</span>
<span class="sd">		Use example: Often there are a lot of different measurements to </span>
<span class="sd">		compare at multiple wavelength. The normlization is performed at the ground state bleach</span>
<span class="sd">		460 nm and early in time. Then it is better to make a new plot for each </span>
<span class="sd">		wavelength. The normalization window stays fixed.</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; plt.close(&#39;all&#39;) #make some space</span>
<span class="sd">		&gt;&gt;&gt; norm_window=[0.3,0.5,450,470] #define window in ground state bleach</span>
<span class="sd">		&gt;&gt;&gt; for wave in [300,400,500,600,700]: #iterate over the wavelength </span>
<span class="sd">		&gt;&gt;&gt; 	ta.Compare_at_wave(rel_wave = wave, others = other_project, norm_window = norm_window)</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>	
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="o">=</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;result_figures&#39;</span><span class="p">,</span><span class="n">current_path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelength_bin</span>
		<span class="k">if</span> <span class="n">rel_wave</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">rel_wave</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rel_wave</span>
		<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">other</span><span class="o">=</span><span class="p">[</span><span class="n">other</span><span class="p">]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span>
			<span class="n">rel_wave</span><span class="o">=</span><span class="p">[</span><span class="n">rel_wave</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">fitted</span><span class="p">:</span>
			<span class="k">try</span><span class="p">:</span>
				<span class="n">re</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">re</span>
			<span class="k">except</span><span class="p">:</span>
				<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fitted results present&quot;</span><span class="p">)</span>
				<span class="k">return</span> <span class="kc">False</span>
			<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ref_scale</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))))</span>
			<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> 
						<span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> 
						<span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="c1">#ax = plot1d(re[&#39;AC&#39;], ax = ax, wavelength = rel_wave, width = width, lines_are = &#39;fitted&#39;, </span>
			<span class="c1">#			cmap = colors, color_offset = len(rel_wave), title = &#39;&#39;, subplot = True, plot_type = scale_type)</span>
			<span class="n">hand</span><span class="p">,</span>  <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
			<span class="n">lab</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">a</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">]</span>
			<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">:</span>
				<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">ent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
			
			<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
					<span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
					<span class="n">color_offset</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">)</span>
					<span class="k">try</span><span class="p">:</span>
						<span class="n">re</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">re</span>
					<span class="k">except</span><span class="p">:</span>
						<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> has no fitted results&#39;</span><span class="o">%</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
						<span class="k">continue</span>
					<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
						<span class="n">rel_scale</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
													 
						<span class="k">try</span><span class="p">:</span>
							<span class="n">scaling</span><span class="o">=</span><span class="p">(</span><span class="n">rel_scale</span> <span class="o">/</span> <span class="n">ref_scale</span><span class="p">)</span>
							<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
											<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span>
											<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
							<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
										<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
										<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
																					 
						<span class="k">except</span><span class="p">:</span>
							<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scaling Failed!&#39;</span><span class="p">)</span>
							<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> 
												<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
												<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
							<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> 
											<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span> 
					<span class="k">else</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
							<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> 
											<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
						<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">],</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> 
										<span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
										<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
					<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
							<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">ent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
						<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">ent</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
					<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
					<span class="k">if</span> <span class="n">data_and_fit</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">):]:</span>
							<span class="n">hand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">):]:</span>
							<span class="n">hand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				 
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and fitted data at given wavelength </span><span class="se">\n</span><span class="s1"> scaled to t=</span><span class="si">%g</span><span class="s1"> ps : </span><span class="si">%g</span><span class="s1"> ps , wl= </span><span class="si">%g</span><span class="s1"> nm: </span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and fitted data at given wavelength&#39;</span><span class="p">)</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
			<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">hand</span><span class="p">,</span><span class="n">lab</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))))</span>
			<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
				<span class="n">ref_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
			<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
						<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> 
						<span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> 
						<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> 
						<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> 
						<span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> 
						<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
			<span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
				<span class="n">lab</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">a</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">]</span>
				<span class="n">hand</span><span class="o">=</span><span class="n">handles</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">):]</span>
				<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
						<span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
						<span class="n">color_offset</span><span class="o">=</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
							<span class="n">rel_scale</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
							<span class="k">try</span><span class="p">:</span>
								<span class="n">scaling</span><span class="o">=</span><span class="p">(</span><span class="n">rel_scale</span><span class="o">/</span><span class="n">ref_scale</span><span class="p">)</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
											<span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span>
											<span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span>
											<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="o">/</span><span class="n">scaling</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
											<span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span>
											<span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span>
											<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
							<span class="k">except</span><span class="p">:</span>
								<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;scaling failed&#39;</span><span class="p">)</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
											<span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span>
											<span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span>
											<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span>
											<span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span>
											<span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span> <span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span>
											<span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> 
											<span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> <span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
										<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span>
										<span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
										<span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> 
										<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
							<span class="n">ax</span> <span class="o">=</span> <span class="n">plot1d</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">ds</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">colors</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span> <span class="n">wavelength</span> <span class="o">=</span> <span class="n">rel_wave</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span>
										<span class="n">baseunit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baseunit</span><span class="p">,</span> <span class="n">timelimits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timelimits</span><span class="p">,</span> <span class="n">lines_are</span> <span class="o">=</span> <span class="s1">&#39;smoothed&#39;</span><span class="p">,</span>
										<span class="n">scattercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">,</span> <span class="n">bordercut</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bordercut</span><span class="p">,</span> <span class="n">subplot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
										<span class="n">color_offset</span> <span class="o">=</span> <span class="n">color_offset</span><span class="p">,</span> <span class="n">intensity_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensity_range</span><span class="p">,</span> 
										<span class="n">plot_type</span> <span class="o">=</span> <span class="n">scale_type</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">linewidth</span><span class="p">)</span>
						<span class="k">for</span> <span class="n">ent</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="n">a</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">]:</span>
							<span class="n">lab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ent</span><span class="p">)</span>
						<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
						<span class="k">for</span> <span class="n">ha</span> <span class="ow">in</span> <span class="n">handles</span><span class="p">[</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">rel_wave</span><span class="p">):]:</span>
							<span class="n">hand</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ha</span><span class="p">)</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and smoothed data at given wavelength&#39;</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">norm_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
					<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;compare measured and smoothed data at given wavelength </span><span class="se">\n</span><span class="s1"> scaled to t=</span><span class="si">%g</span><span class="s1"> ps : </span><span class="si">%g</span><span class="s1"> ps , wl= </span><span class="si">%g</span><span class="s1"> nm: </span><span class="si">%g</span><span class="s1"> nm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">norm_window</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
				<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">hand</span><span class="p">,</span><span class="n">lab</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>  
			<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;compare_at_wave_</span><span class="si">%s</span><span class="s1">.png&#39;</span><span class="o">%</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rel_wave</span><span class="p">])),</span>
			<span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="TA.Compare_DAC"><a class="viewcode-back" href="../plot_func.html#plot_func.TA.Compare_DAC">[docs]</a>	<span class="k">def</span> <span class="nf">Compare_DAC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">spectra</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">separate_plots</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
		<span class="sd">&#39;&#39;&#39;This is a convenience function to plot multiple extracted spectra </span>
<span class="sd">		(DAS or species associated) into the same figure or into a separate figure</span>
<span class="sd">		each. Other should be ta.plot_func objects (loaded or copied). By</span>
<span class="sd">		standard it plots all into the same window. If all project have the same</span>
<span class="sd">		number of components one can activate &quot;separate_plots&quot; and have each</span>
<span class="sd">		separated (in the order created in the projects).</span>

<span class="sd">		The &quot;Spectra&quot; parameter allows as before the inclusion of an external</span>
<span class="sd">		spectrum. Others is optional and I use this function often to compare</span>
<span class="sd">		species associated spectra with one or multiple steady state spectra.</span>
<span class="sd">		</span>
<span class="sd">		Parameters</span>
<span class="sd">		--------------</span>
<span class="sd">			</span>
<span class="sd">		other : TA object or list of those, optional </span>
<span class="sd">			should be ta.plot_func objects (loaded or copied) and is what </span>
<span class="sd">			is plotted against the data use a list [ta1,ta2,... ] or generate this</span>
<span class="sd">			list using the Gui function. See section :ref:`Opening multiple files` in </span>
<span class="sd">			the documentation</span>

<span class="sd">		spectra : None or DataFrame, optional</span>
<span class="sd">			If an DataFrame with the wavelength as index is provided, Then the spectra of each column</span>
<span class="sd">			is plotted into the differential spectra 1:1 and the column names are used in the legend</span>
<span class="sd">			Prior scaling is highly suggested. These spectra are not (in general) scaled with the </span>
<span class="sd">			norm window. (see examples)</span>

<span class="sd">		separate_plots : bool, optional</span>
<span class="sd">			True or False (Default), separate plots is the switch that decides if a axis or </span>
<span class="sd">			multiple axis are used. This option will result in a crash unless all objects have the</span>
<span class="sd">			same number of DAS/SAS components</span>
<span class="sd">				</span>
<span class="sd">		cmap : None or matplotlib color map, optional</span>
<span class="sd">			is a powerfull variable that chooses the colour map applied for all plots. If set to </span>
<span class="sd">			None (Default) then the self.cmap is used.</span>
<span class="sd">			As standard I use the color map &quot;jet&quot; from matplotlib. There are a variety of colormaps </span>
<span class="sd">			available that are very usefull. Beside &quot;jet&quot;, &quot;viridis&quot; is a good choice as it is well </span>
<span class="sd">			visible under red-green blindness. Other useful maps are &quot;prism&quot; for high fluctuations </span>
<span class="sd">			or diverging color maps like &quot;seismic&quot;. </span>
<span class="sd">			See https://matplotlib.org/3.1.0/tutorials/colors/colormaps.html for a comprehensive </span>
<span class="sd">			selection. In the code the colormaps are imported so if plot_func is imported as pf then </span>
<span class="sd">			self.cmap=pf.cm.viridis sets viridis as the map to use. Internally the colors are chosen </span>
<span class="sd">			with the &quot;colm&quot; function. The 2d plots require a continuous color map so if something </span>
<span class="sd">			else is give 2d plots are shown automatically with &quot;jet&quot;. For all of the 1d plots however </span>
<span class="sd">			I first select a number of colors before each plot. If cmap is a continous map then these</span>
<span class="sd">			are sampled evenly over the colourmap. Manual iterables of colours </span>
<span class="sd">			cmap=[(1,0,0),(0,1,0),(0,0,1),...] are also accepted, as are vectors or dataframes that </span>
<span class="sd">			contain as rows the colors. There must be of course sufficient colors present for </span>
<span class="sd">			the numbers of lines that will be plotted. So I recommend to provide at least 10 colours </span>
<span class="sd">			(e.g.~your university colors). colours are always given as a, list or tuple with RGA or RGBA</span>
<span class="sd">			(with the last A beeing the Alpha=transparency. All numbers are between 0 and 1. </span>
<span class="sd">			If a list/vector/DataFrame is given for the colours they will be used in the order provided.</span>
<span class="sd">		</span>
<span class="sd">		Examples</span>
<span class="sd">		--------</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; import plot_func as pf</span>
<span class="sd">		&gt;&gt;&gt; ta = pf.TA(&#39;test1.hdf5&#39;) #open the original project, </span>
<span class="sd">		&gt;&gt;&gt; this MUST contain a fit, otherwise this will raise an error</span>
<span class="sd">		</span>
<span class="sd">		Now open a bunch of other projects to compare against,</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; #compare in a single window</span>
<span class="sd">		&gt;&gt;&gt; other_projects = pf.GUI_open(project_list = [&#39;file1.hdf5&#39;, &#39;file2.hdf5&#39;])</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_DAC(others = other_project)</span>
<span class="sd">		&gt;&gt;&gt; #comprare in separate windows, </span>
<span class="sd">		&gt;&gt;&gt; #the other projects must have the same number of components</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_DAC(others = other_project, separate_plots = True)</span>
<span class="sd">		</span>
<span class="sd">		Compare the DAC to an external spectrum</span>
<span class="sd">		</span>
<span class="sd">		&gt;&gt;&gt; ext_spec = pd.read_csv(&#39;Ascii_spectrum.dat&#39;, sep = &#39;,&#39;)</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_DAC(spectra = ext_spec) #compare just the current solution</span>
<span class="sd">		&gt;&gt;&gt; ta.Compare_DAC(spectra = ext_spec, others = other_project) #compare multiple</span>
<span class="sd">		</span>
<span class="sd">		&#39;&#39;&#39;</span>
		
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span> <span class="o">=</span> <span class="n">check_folder</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;result_figures&#39;</span><span class="p">,</span> <span class="n">current_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">other</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span><span class="p">]</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No fitted results present&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">False</span>
		<span class="k">if</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span><span class="n">cmap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap</span>
		<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
			<span class="n">col</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
			<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">separate_plots</span><span class="p">:</span>
				<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">colors</span> <span class="o">=</span> <span class="n">colm</span><span class="p">(</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
		<span class="n">DAC</span> <span class="o">=</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">separate_plots</span><span class="p">:</span>
			<span class="n">n_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
			<span class="n">col</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>	
				<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
									<span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
				<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> 
													<span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
				<span class="n">a</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
				<span class="n">DAC_cut</span><span class="o">=</span><span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span>
				<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">am</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DAC_cut</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
					<span class="n">DAC_cut</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">scattercut</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
						<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> 
														<span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
						<span class="n">a</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">am</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
							<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">am</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
							<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>	
				<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
				<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
				<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,</span>  <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">scattercut</span>  <span class="o">=</span>  <span class="n">flatten</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">i</span>  <span class="o">==</span>  <span class="mi">0</span><span class="p">:</span>
						<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
						<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span>  <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">ax</span>  <span class="o">=</span>  <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,</span>  <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">subplots</span> <span class="o">=</span> <span class="n">separate_plots</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
 
		<span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">re</span><span class="o">=</span><span class="n">o</span><span class="o">.</span><span class="n">re</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
				<span class="k">except</span><span class="p">:</span>
					<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> has no fitted results&#39;</span><span class="o">%</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
					<span class="k">continue</span>
				<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
				<span class="k">if</span> <span class="n">separate_plots</span><span class="p">:</span>				
					<span class="n">col</span><span class="o">=</span><span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">))]</span>
					<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">am</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
						<span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>	
							<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
						<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
							<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
							<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
						<span class="k">else</span><span class="p">:</span>
							<span class="n">scattercut</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
							<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
								<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
									<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
								<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
									<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
								<span class="k">else</span><span class="p">:</span>
									<span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;_nolegend_&#39;</span><span class="p">)</span>
						<span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength in nm&#39;</span><span class="p">)</span>				
						<span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral strength in arb. units&#39;</span><span class="p">)</span>
						<span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

				<span class="k">else</span><span class="p">:</span>
					<span class="n">dacs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
					<span class="n">col</span><span class="o">=</span><span class="n">colors</span><span class="p">[(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">dacs</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dacs</span><span class="p">]</span>	
					<span class="n">DAC</span><span class="o">=</span><span class="n">re</span><span class="p">[</span><span class="s1">&#39;DAC&#39;</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">scattercut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>	
						<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
					<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
						<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
						<span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
					<span class="k">else</span><span class="p">:</span>
						<span class="n">scattercut</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">scattercut</span><span class="p">)</span>
						<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
							<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
							<span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scattercut</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span><span class="n">scattercut</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
							<span class="k">else</span><span class="p">:</span>
								<span class="n">ax</span> <span class="o">=</span> <span class="n">DAC</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scattercut</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:,</span> <span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
					<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Wavelength in nm&#39;</span><span class="p">)</span>				
					<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spectral strength in arb. units&#39;</span><span class="p">)</span>
					<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">):</span><span class="n">ax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">ax</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">spectra</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
				<span class="n">spectra</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">subplots</span><span class="o">=</span><span class="n">separate_plots</span><span class="p">)</span>				
		<span class="n">fig</span><span class="o">=</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
		<span class="k">if</span> <span class="n">separate_plots</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
		<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_figures_to_folder</span><span class="p">:</span>
			<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">check_folder</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">figure_path</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;compare_DAC.png&#39;</span><span class="p">),</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div></div>



</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Jens Uhlig.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>